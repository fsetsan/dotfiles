/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={9236:(e,t,r)=>{"use strict";var n=r(1394)("%Object.defineProperty%",!0)||!1;if(n)try{n({},"a",{value:1})}catch(e){n=!1}e.exports=n},1394:(e,t,r)=>{"use strict";var n,o=r(5936),i=r(2154),a=r(4442),s=r(8529),c=r(7449),l=r(8533),u=r(642),d=Function,h=function(e){try{return d('"use strict"; return ('+e+").constructor;")()}catch(e){}},p=Object.getOwnPropertyDescriptor;if(p)try{p({},"")}catch(e){p=null}var f=function(){throw new l},y=p?function(){try{return f}catch(e){try{return p(arguments,"callee").get}catch(e){return f}}}():f,m=r(4573)(),g=r(8912)(),b=Object.getPrototypeOf||(g?function(e){return e.__proto__}:null),v={},w="undefined"!=typeof Uint8Array&&b?b(Uint8Array):n,_={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":m&&b?b([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":o,"%eval%":eval,"%EvalError%":i,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&b?b(b([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&b?b((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":s,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&b?b((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&b?b(""[Symbol.iterator]()):n,"%Symbol%":m?Symbol:n,"%SyntaxError%":c,"%ThrowTypeError%":y,"%TypedArray%":w,"%TypeError%":l,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(b)try{null.error}catch(e){var A=b(b(e));_["%Error.prototype%"]=A}var x=function e(t){var r;if("%AsyncFunction%"===t)r=h("async function () {}");else if("%GeneratorFunction%"===t)r=h("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=h("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&b&&(r=b(o.prototype))}return _[t]=r,r},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},k=r(4672),P=r(2907),F=k.call(Function.call,Array.prototype.concat),E=k.call(Function.apply,Array.prototype.splice),O=k.call(Function.call,String.prototype.replace),R=k.call(Function.call,String.prototype.slice),I=k.call(Function.call,RegExp.prototype.exec),j=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,T=function(e,t){var r,n=e;if(P(S,n)&&(n="%"+(r=S[n])[0]+"%"),P(_,n)){var o=_[n];if(o===v&&(o=x(n)),void 0===o&&!t)throw new l("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new l('"allowMissing" argument must be a boolean');if(null===I(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=R(e,0,1),r=R(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var n=[];return O(e,j,(function(e,t,r,o){n[n.length]=r?O(o,C,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",o=T("%"+n+"%",t),i=o.name,a=o.value,s=!1,u=o.alias;u&&(n=u[0],E(r,F([0,1],u)));for(var d=1,h=!0;d<r.length;d+=1){var f=r[d],y=R(f,0,1),m=R(f,-1);if(('"'===y||"'"===y||"`"===y||'"'===m||"'"===m||"`"===m)&&y!==m)throw new c("property names with quotes must have matching quotes");if("constructor"!==f&&h||(s=!0),P(_,i="%"+(n+="."+f)+"%"))a=_[i];else if(null!=a){if(!(f in a)){if(!t)throw new l("base intrinsic for "+e+" exists, but the property is not available.");return}if(p&&d+1>=r.length){var g=p(a,f);a=(h=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:a[f]}else h=P(a,f),a=a[f];h&&!s&&(_[i]=a)}}return a}},2154:e=>{"use strict";e.exports=EvalError},5936:e=>{"use strict";e.exports=Error},4442:e=>{"use strict";e.exports=RangeError},8529:e=>{"use strict";e.exports=ReferenceError},7449:e=>{"use strict";e.exports=SyntaxError},8533:e=>{"use strict";e.exports=TypeError},642:e=>{"use strict";e.exports=URIError},3351:e=>{"use strict";var t=Object.prototype.toString,r=Math.max,n=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var o=0;o<t.length;o+=1)r[o+e.length]=t[o];return r};e.exports=function(e){var o=this;if("function"!=typeof o||"[object Function]"!==t.apply(o))throw new TypeError("Function.prototype.bind called on incompatible "+o);for(var i,a=function(e,t){for(var r=[],n=1,o=0;n<e.length;n+=1,o+=1)r[o]=e[n];return r}(arguments),s=r(0,o.length-a.length),c=[],l=0;l<s;l++)c[l]="$"+l;if(i=Function("binder","return function ("+function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=",");return r}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var t=o.apply(this,n(a,arguments));return Object(t)===t?t:this}return o.apply(e,n(a,arguments))})),o.prototype){var u=function(){};u.prototype=o.prototype,i.prototype=new u,u.prototype=null}return i}},4672:(e,t,r)=>{"use strict";var n=r(3351);e.exports=Function.prototype.bind||n},4663:(e,t,r)=>{"use strict";var n,o=SyntaxError,i=Function,a=TypeError,s=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new a},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,d=r(4573)(),h=r(8912)(),p=Object.getPrototypeOf||(h?function(e){return e.__proto__}:null),f={},y="undefined"!=typeof Uint8Array&&p?p(Uint8Array):n,m={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d&&p?p([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&p?p(p([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d&&p?p((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d&&p?p((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&p?p(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":u,"%TypedArray%":y,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(p)try{null.error}catch(e){var g=p(p(e));m["%Error.prototype%"]=g}var b=function e(t){var r;if("%AsyncFunction%"===t)r=s("async function () {}");else if("%GeneratorFunction%"===t)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=s("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&p&&(r=p(o.prototype))}return m[t]=r,r},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=r(4672),_=r(2907),A=w.call(Function.call,Array.prototype.concat),x=w.call(Function.apply,Array.prototype.splice),S=w.call(Function.call,String.prototype.replace),k=w.call(Function.call,String.prototype.slice),P=w.call(Function.call,RegExp.prototype.exec),F=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g,O=function(e,t){var r,n=e;if(_(v,n)&&(n="%"+(r=v[n])[0]+"%"),_(m,n)){var i=m[n];if(i===f&&(i=b(n)),void 0===i&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===P(/^%?[^%]*%?$/,e))throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=k(e,0,1),r=k(e,-1);if("%"===t&&"%"!==r)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var n=[];return S(e,F,(function(e,t,r,o){n[n.length]=r?S(o,E,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",i=O("%"+n+"%",t),s=i.name,l=i.value,u=!1,d=i.alias;d&&(n=d[0],x(r,A([0,1],d)));for(var h=1,p=!0;h<r.length;h+=1){var f=r[h],y=k(f,0,1),g=k(f,-1);if(('"'===y||"'"===y||"`"===y||'"'===g||"'"===g||"`"===g)&&y!==g)throw new o("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),_(m,s="%"+(n+="."+f)+"%"))l=m[s];else if(null!=l){if(!(f in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&h+1>=r.length){var b=c(l,f);l=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:l[f]}else p=_(l,f),l=l[f];p&&!u&&(m[s]=l)}}return l}},8337:(e,t,r)=>{"use strict";var n=r(4663)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},8912:e=>{"use strict";var t={foo:{}},r=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof r)}},4573:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,o=r(4283);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&o()}},4283:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},2907:(e,t,r)=>{"use strict";var n=Function.prototype.call,o=Object.prototype.hasOwnProperty,i=r(4672);e.exports=i.call(n,o)},9427:(e,t,r)=>{"use strict";var n=r(1020),o=n.ValidatorResult,i=n.SchemaError,a={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0}},s=a.validators={};function c(e,t,r,n,o){var i=t.throwError,a=t.throwAll;t.throwError=!1,t.throwAll=!1;var s=this.validateSchema(e,o,t,r);return t.throwError=i,t.throwAll=a,!s.valid&&n instanceof Function&&n(s),s.valid}function l(e,t){if(Object.hasOwnProperty.call(e,t))return e[t];if(t in e)for(;e=Object.getPrototypeOf(e);)if(Object.propertyIsEnumerable.call(e,t))return e[t]}function u(e,t,r,n,o,i){if(this.types.object(e)&&(!t.properties||void 0===t.properties[o]))if(!1===t.additionalProperties)i.addError({name:"additionalProperties",argument:o,message:"is not allowed to have the additional property "+JSON.stringify(o)});else{var a=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,o,a,r,n);var s=this.validateSchema(e[o],a,r,n.makeChild(a,o));s.instance!==i.instance[o]&&(i.instance[o]=s.instance),i.importErrors(s)}}s.type=function(e,t,r,n){if(void 0===e)return null;var i=new o(e,t,r,n),a=Array.isArray(t.type)?t.type:[t.type];if(!a.some(this.testType.bind(this,e,t,r,n))){var s=a.map((function(e){if(e){var t=e.$id||e.id;return t?"<"+t+">":e+""}}));i.addError({name:"type",argument:s,message:"is not of a type(s) "+s})}return i},s.anyOf=function(e,t,r,n){if(void 0===e)return null;var a=new o(e,t,r,n),s=new o(e,t,r,n);if(!Array.isArray(t.anyOf))throw new i("anyOf must be an array");if(!t.anyOf.some(c.bind(this,e,r,n,(function(e){s.importErrors(e)})))){var l=t.anyOf.map((function(e,t){var r=e.$id||e.id;return r?"<"+r+">":e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));r.nestedErrors&&a.importErrors(s),a.addError({name:"anyOf",argument:l,message:"is not any of "+l.join(",")})}return a},s.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new i("allOf must be an array");var a=new o(e,t,r,n),s=this;return t.allOf.forEach((function(t,o){var i=s.validateSchema(e,t,r,n);if(!i.valid){var c=t.$id||t.id||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+o+"]";a.addError({name:"allOf",argument:{id:c,length:i.errors.length,valid:i},message:"does not match allOf schema "+c+" with "+i.errors.length+" error[s]:"}),a.importErrors(i)}})),a},s.oneOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new i("oneOf must be an array");var a=new o(e,t,r,n),s=new o(e,t,r,n),l=t.oneOf.filter(c.bind(this,e,r,n,(function(e){s.importErrors(e)}))).length,u=t.oneOf.map((function(e,t){return e.$id||e.id||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));return 1!==l&&(r.nestedErrors&&a.importErrors(s),a.addError({name:"oneOf",argument:u,message:"is not exactly one from "+u.join(",")})),a},s.if=function(e,t,r,i){if(void 0===e)return null;if(!n.isSchema(t.if))throw new Error('Expected "if" keyword to be a schema');var a,s=c.call(this,e,r,i,null,t.if),l=new o(e,t,r,i);if(s){if(void 0===t.then)return;if(!n.isSchema(t.then))throw new Error('Expected "then" keyword to be a schema');a=this.validateSchema(e,t.then,r,i.makeChild(t.then)),l.importErrors(a)}else{if(void 0===t.else)return;if(!n.isSchema(t.else))throw new Error('Expected "else" keyword to be a schema');a=this.validateSchema(e,t.else,r,i.makeChild(t.else)),l.importErrors(a)}return l},s.propertyNames=function(e,t,r,a){if(this.types.object(e)){var s=new o(e,t,r,a),c=void 0!==t.propertyNames?t.propertyNames:{};if(!n.isSchema(c))throw new i('Expected "propertyNames" to be a schema (object or boolean)');for(var u in e)if(void 0!==l(e,u)){var d=this.validateSchema(u,c,r,a.makeChild(c));s.importErrors(d)}return s}},s.properties=function(e,t,r,n){if(this.types.object(e)){var a=new o(e,t,r,n),s=t.properties||{};for(var c in s){var u=s[c];if(void 0!==u){if(null===u)throw new i('Unexpected null, expected schema in "properties"');"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,u,r,n);var d=l(e,c),h=this.validateSchema(d,u,r,n.makeChild(u,c));h.instance!==a.instance[c]&&(a.instance[c]=h.instance),a.importErrors(h)}}return a}},s.patternProperties=function(e,t,r,n){if(this.types.object(e)){var a=new o(e,t,r,n),s=t.patternProperties||{};for(var c in e){var l=!0;for(var d in s){var h=s[d];if(void 0!==h){if(null===h)throw new i('Unexpected null, expected schema in "patternProperties"');try{var p=new RegExp(d,"u")}catch(e){p=new RegExp(d)}if(p.test(c)){l=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,h,r,n);var f=this.validateSchema(e[c],h,r,n.makeChild(h,c));f.instance!==a.instance[c]&&(a.instance[c]=f.instance),a.importErrors(f)}}}l&&u.call(this,e,t,r,n,c,a)}return a}},s.additionalProperties=function(e,t,r,n){if(this.types.object(e)){if(t.patternProperties)return null;var i=new o(e,t,r,n);for(var a in e)u.call(this,e,t,r,n,a,i);return i}},s.minProperties=function(e,t,r,n){if(this.types.object(e)){var i=new o(e,t,r,n);return Object.keys(e).length>=t.minProperties||i.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),i}},s.maxProperties=function(e,t,r,n){if(this.types.object(e)){var i=new o(e,t,r,n);return Object.keys(e).length<=t.maxProperties||i.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),i}},s.items=function(e,t,r,n){var i=this;if(this.types.array(e)&&void 0!==t.items){var a=new o(e,t,r,n);return e.every((function(e,o){if(Array.isArray(t.items))var s=void 0===t.items[o]?t.additionalItems:t.items[o];else s=t.items;if(void 0===s)return!0;if(!1===s)return a.addError({name:"items",message:"additionalItems not permitted"}),!1;var c=i.validateSchema(e,s,r,n.makeChild(s,o));return c.instance!==a.instance[o]&&(a.instance[o]=c.instance),a.importErrors(c),!0})),a}},s.contains=function(e,t,r,i){var a=this;if(this.types.array(e)&&void 0!==t.contains){if(!n.isSchema(t.contains))throw new Error('Expected "contains" keyword to be a schema');var s=new o(e,t,r,i);return!1===e.some((function(e,n){return 0===a.validateSchema(e,t.contains,r,i.makeChild(t.contains,n)).errors.length}))&&s.addError({name:"contains",argument:t.contains,message:"must contain an item matching given schema"}),s}},s.minimum=function(e,t,r,n){if(this.types.number(e)){var i=new o(e,t,r,n);return t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum||i.addError({name:"minimum",argument:t.minimum,message:"must be greater than "+t.minimum}):e>=t.minimum||i.addError({name:"minimum",argument:t.minimum,message:"must be greater than or equal to "+t.minimum}),i}},s.maximum=function(e,t,r,n){if(this.types.number(e)){var i=new o(e,t,r,n);return t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum||i.addError({name:"maximum",argument:t.maximum,message:"must be less than "+t.maximum}):e<=t.maximum||i.addError({name:"maximum",argument:t.maximum,message:"must be less than or equal to "+t.maximum}),i}},s.exclusiveMinimum=function(e,t,r,n){if("boolean"!=typeof t.exclusiveMinimum&&this.types.number(e)){var i=new o(e,t,r,n);return e>t.exclusiveMinimum||i.addError({name:"exclusiveMinimum",argument:t.exclusiveMinimum,message:"must be strictly greater than "+t.exclusiveMinimum}),i}},s.exclusiveMaximum=function(e,t,r,n){if("boolean"!=typeof t.exclusiveMaximum&&this.types.number(e)){var i=new o(e,t,r,n);return e<t.exclusiveMaximum||i.addError({name:"exclusiveMaximum",argument:t.exclusiveMaximum,message:"must be strictly less than "+t.exclusiveMaximum}),i}};var d=function(e,t,r,a,s,c){if(this.types.number(e)){var l=t[s];if(0==l)throw new i(s+" cannot be zero");var u=new o(e,t,r,a),d=n.getDecimalPlaces(e),h=n.getDecimalPlaces(l),p=Math.max(d,h),f=Math.pow(10,p);return Math.round(e*f)%Math.round(l*f)!=0&&u.addError({name:s,argument:l,message:c+JSON.stringify(l)}),u}};function h(e,t,r){var o,i=r.length;for(o=t+1;o<i;o++)if(n.deepCompareStrict(e,r[o]))return!1;return!0}s.multipleOf=function(e,t,r,n){return d.call(this,e,t,r,n,"multipleOf","is not a multiple of (divisible by) ")},s.divisibleBy=function(e,t,r,n){return d.call(this,e,t,r,n,"divisibleBy","is not divisible by (multiple of) ")},s.required=function(e,t,r,n){var i=new o(e,t,r,n);return void 0===e&&!0===t.required?i.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach((function(t){void 0===l(e,t)&&i.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})})),i},s.pattern=function(e,t,r,n){if(this.types.string(e)){var i=new o(e,t,r,n),a=t.pattern;try{var s=new RegExp(a,"u")}catch(e){s=new RegExp(a)}return e.match(s)||i.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),i}},s.format=function(e,t,r,i){if(void 0!==e){var a=new o(e,t,r,i);return a.disableFormat||n.isFormat(e,t.format,this)||a.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),a}},s.minLength=function(e,t,r,n){if(this.types.string(e)){var i=new o(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)>=t.minLength||i.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),i}},s.maxLength=function(e,t,r,n){if(this.types.string(e)){var i=new o(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)<=t.maxLength||i.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),i}},s.minItems=function(e,t,r,n){if(this.types.array(e)){var i=new o(e,t,r,n);return e.length>=t.minItems||i.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),i}},s.maxItems=function(e,t,r,n){if(this.types.array(e)){var i=new o(e,t,r,n);return e.length<=t.maxItems||i.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),i}},s.uniqueItems=function(e,t,r,n){if(!0===t.uniqueItems&&this.types.array(e)){var i=new o(e,t,r,n);return e.every(h)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i}},s.dependencies=function(e,t,r,n){if(this.types.object(e)){var i=new o(e,t,r,n);for(var a in t.dependencies)if(void 0!==e[a]){var s=t.dependencies[a],c=n.makeChild(s,a);if("string"==typeof s&&(s=[s]),Array.isArray(s))s.forEach((function(t){void 0===e[t]&&i.addError({name:"dependencies",argument:c.propertyPath,message:"property "+t+" not found, required by "+c.propertyPath})}));else{var l=this.validateSchema(e,s,r,c);i.instance!==l.instance&&(i.instance=l.instance),l&&l.errors.length&&(i.addError({name:"dependencies",argument:c.propertyPath,message:"does not meet dependency required by "+c.propertyPath}),i.importErrors(l))}}return i}},s.enum=function(e,t,r,a){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new i("enum expects an array",t);var s=new o(e,t,r,a);return t.enum.some(n.deepCompareStrict.bind(null,e))||s.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),s},s.const=function(e,t,r,i){if(void 0===e)return null;var a=new o(e,t,r,i);return n.deepCompareStrict(t.const,e)||a.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),a},s.not=s.disallow=function(e,t,r,n){var i=this;if(void 0===e)return null;var a=new o(e,t,r,n),s=t.not||t.disallow;return s?(Array.isArray(s)||(s=[s]),s.forEach((function(o){if(i.testType(e,t,r,n,o)){var s=o&&(o.$id||o.id)||o;a.addError({name:"not",argument:s,message:"is of prohibited type "+s})}})),a):null},e.exports=a},1020:(e,t,r)=>{"use strict";var n=r(8526),o=t.ValidationError=function(e,t,r,n,o,i){if(Array.isArray(n)?(this.path=n,this.property=n.reduce((function(e,t){return e+d(t)}),"instance")):void 0!==n&&(this.property=n),e&&(this.message=e),r){var a=r.$id||r.id;this.schema=a||r}void 0!==t&&(this.instance=t),this.name=o,this.argument=i,this.stack=this.toString()};o.prototype.toString=function(){return this.property+" "+this.message};var i=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.options=r,this.path=n.path,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.throwFirst=r&&r.throwFirst,this.throwAll=r&&r.throwAll,this.disableFormat=r&&!0===r.disableFormat};function a(e,t){return t+": "+e.toString()+"\n"}function s(e){Error.captureStackTrace&&Error.captureStackTrace(this,s),this.instance=e.instance,this.schema=e.schema,this.options=e.options,this.errors=e.errors}i.prototype.addError=function(e){var t;if("string"==typeof e)t=new o(e,this.instance,this.schema,this.path);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new o(e.message,this.instance,this.schema,this.path,e.name,e.argument)}if(this.errors.push(t),this.throwFirst)throw new s(this);if(this.throwError)throw t;return t},i.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&(this.errors=this.errors.concat(e.errors))},i.prototype.toString=function(e){return this.errors.map(a).join("")},Object.defineProperty(i.prototype,"valid",{get:function(){return!this.errors.length}}),e.exports.ValidatorResultError=s,s.prototype=new Error,s.prototype.constructor=s,s.prototype.name="Validation Error";var c=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};c.prototype=Object.create(Error.prototype,{constructor:{value:c,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var l=t.SchemaContext=function(e,t,r,n,o){this.schema=e,this.options=t,Array.isArray(r)?(this.path=r,this.propertyPath=r.reduce((function(e,t){return e+d(t)}),"instance")):this.propertyPath=r,this.base=n,this.schemas=o};l.prototype.resolve=function(e){return n.resolve(this.base,e)},l.prototype.makeChild=function(e,t){var r=void 0===t?this.path:this.path.concat([t]),o=e.$id||e.id,i=n.resolve(this.base,o||""),a=new l(e,this.options,r,i,Object.create(this.schemas));return o&&!a.schemas[i]&&(a.schemas[i]=e),a};var u=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};u.regexp=u.regex,u.pattern=u.regex,u.ipv4=u["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==u[t]){if(u[t]instanceof RegExp)return u[t].test(e);if("function"==typeof u[t])return u[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var d=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function h(e,t,r,n){"object"==typeof r?t[n]=y(e[n],r):-1===e.indexOf(r)&&t.push(r)}function p(e,t,r){t[r]=e[r]}function f(e,t,r,n){"object"==typeof t[n]&&t[n]&&e[n]?r[n]=y(e[n],t[n]):r[n]=t[n]}function y(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(h.bind(null,e,n))):(e&&"object"==typeof e&&Object.keys(e).forEach(p.bind(null,e,n)),Object.keys(t).forEach(f.bind(null,e,t,n))),n}function m(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,r){if(typeof t!=typeof r)return!1;if(Array.isArray(t))return!!Array.isArray(r)&&t.length===r.length&&t.every((function(n,o){return e(t[o],r[o])}));if("object"==typeof t){if(!t||!r)return t===r;var n=Object.keys(t),o=Object.keys(r);return n.length===o.length&&n.every((function(n){return e(t[n],r[n])}))}return t===r},e.exports.deepMerge=y,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var o=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(o in e))return;e=e[o]}return e},t.encodePath=function(e){return e.map(m).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var n=r[0].split(".");return 2===n.length&&(t+=n[1].length),t},t.isSchema=function(e){return"object"==typeof e&&e||"boolean"==typeof e}},4445:(e,t,r)=>{"use strict";r(6719);r(1020).ValidatorResult,r(1020).ValidatorResultError,r(1020).ValidationError,r(1020).SchemaError,r(3107),r(3107).R},3107:(e,t,r)=>{"use strict";var n=r(8526),o=r(1020);function i(e,t){this.id=e,this.ref=t}e.exports.R=function(e,t){function r(e,t){if(t&&"object"==typeof t)if(t.$ref){var i=n.resolve(e,t.$ref);l[i]=l[i]?l[i]+1:0}else{var u=t.$id||t.id,d=u?n.resolve(e,u):e;if(d){if(d.indexOf("#")<0&&(d+="#"),c[d]){if(!o.deepCompareStrict(c[d],t))throw new Error("Schema <"+d+"> already exists with different definition");return c[d]}c[d]=t,"#"==d[d.length-1]&&(c[d.substring(0,d.length-1)]=t)}a(d+"/items",Array.isArray(t.items)?t.items:[t.items]),a(d+"/extends",Array.isArray(t.extends)?t.extends:[t.extends]),r(d+"/additionalItems",t.additionalItems),s(d+"/properties",t.properties),r(d+"/additionalProperties",t.additionalProperties),s(d+"/definitions",t.definitions),s(d+"/patternProperties",t.patternProperties),s(d+"/dependencies",t.dependencies),a(d+"/disallow",t.disallow),a(d+"/allOf",t.allOf),a(d+"/anyOf",t.anyOf),a(d+"/oneOf",t.oneOf),r(d+"/not",t.not)}}function a(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)r(e+"/"+n,t[n])}function s(e,t){if(t&&"object"==typeof t)for(var n in t)r(e+"/"+n,t[n])}var c={},l={};return r(e,t),new i(c,l)}},6719:(e,t,r)=>{"use strict";var n=r(8526),o=r(9427),i=r(1020),a=r(3107).R,s=i.ValidatorResult,c=i.ValidatorResultError,l=i.SchemaError,u=i.SchemaContext,d=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(p),this.attributes=Object.create(o.validators)};function h(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}d.prototype.customFormats={},d.prototype.schemas=null,d.prototype.types=null,d.prototype.attributes=null,d.prototype.unresolvedRefs=null,d.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var n=a(t||"/",e),o=t||e.$id||e.id;for(var i in n.id)this.schemas[i]=n.id[i];for(var i in n.ref)this.unresolvedRefs.push(i);return this.unresolvedRefs=this.unresolvedRefs.filter((function(e){return void 0===r.schemas[e]})),this.schemas[o]},d.prototype.addSubSchemaArray=function(e,t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},d.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},d.prototype.setSchemas=function(e){this.schemas=e},d.prototype.getSchema=function(e){return this.schemas[e]},d.prototype.validate=function(e,t,r,o){if("boolean"!=typeof t&&"object"!=typeof t||null===t)throw new l("Expected `schema` to be an object or boolean");r||(r={});var i,d=t.$id||t.id,h=n.resolve(r.base||"/",d||"");if(!o){(o=new u(t,r,[],h,Object.create(this.schemas))).schemas[h]||(o.schemas[h]=t);var p=a(h,t);for(var f in p.id){var y=p.id[f];o.schemas[f]=y}}if(r.required&&void 0===e)return(i=new s(e,t,r,o)).addError("is required, but is undefined"),i;if(!(i=this.validateSchema(e,t,r,o)))throw new Error("Result undefined");if(r.throwAll&&i.errors.length)throw new c(i);return i},d.prototype.validateSchema=function(e,t,r,n){var a=new s(e,t,r,n);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var c={schema:t,ctx:n};t.extends.forEach(this.schemaTraverser.bind(this,c)),t=c.schema,c.schema=null,c.ctx=null,c=null}else t=i.deepMerge(t,this.superResolve(t.extends,n));var d=h(t);if(d){var p=this.resolve(t,d,n),f=new u(p.subschema,r,n.path,p.switchSchema,n.schemas);return this.validateSchema(e,p.subschema,r,f)}var y=r&&r.skipAttributes||[];for(var m in t)if(!o.ignoreProperties[m]&&y.indexOf(m)<0){var g=null,b=this.attributes[m];if(b)g=b.call(this,e,t,r,n);else if(!1===r.allowUnknownAttributes)throw new l("Unsupported attribute: "+m,t);g&&a.importErrors(g)}if("function"==typeof r.rewrite){var v=r.rewrite.call(this,e,t,r,n);a.instance=v}return a},d.prototype.schemaTraverser=function(e,t){e.schema=i.deepMerge(e.schema,this.superResolve(t,e.ctx))},d.prototype.superResolve=function(e,t){var r=h(e);return r?this.resolve(e,r,t).subschema:e},d.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var o=n.parse(t),a=o&&o.hash,s=a&&a.length&&t.substr(0,t.length-a.length);if(!s||!r.schemas[s])throw new l("no such schema <"+t+">",e);var c=i.objectGetPath(r.schemas[s],a.substr(1));if(void 0===c)throw new l("no such schema "+a+" located in <"+s+">",e);return{subschema:c,switchSchema:t}},d.prototype.testType=function(e,t,r,n,o){if(void 0!==o){if(null===o)throw new l('Unexpected null in "type" keyword');if("function"==typeof this.types[o])return this.types[o].call(this,e);if(o&&"object"==typeof o){var i=this.validateSchema(e,o,r,n);return void 0===i||!(i&&i.errors.length)}return!0}};var p=d.prototype.types={};p.string=function(e){return"string"==typeof e},p.number=function(e){return"number"==typeof e&&isFinite(e)},p.integer=function(e){return"number"==typeof e&&e%1==0},p.boolean=function(e){return"boolean"==typeof e},p.array=function(e){return Array.isArray(e)},p.null=function(e){return null===e},p.date=function(e){return e instanceof Date},p.any=function(e){return!0},p.object=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)},e.exports=d},201:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=n&&o&&"function"==typeof o.get?o.get:null,a=n&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=s&&c&&"function"==typeof c.get?c.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,y=Object.prototype.toString,m=Function.prototype.toString,g=String.prototype.match,b=String.prototype.slice,v=String.prototype.replace,w=String.prototype.toUpperCase,_=String.prototype.toLowerCase,A=RegExp.prototype.test,x=Array.prototype.concat,S=Array.prototype.join,k=Array.prototype.slice,P=Math.floor,F="function"==typeof BigInt?BigInt.prototype.valueOf:null,E=Object.getOwnPropertySymbols,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,R="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,j=Object.prototype.propertyIsEnumerable,C=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function T(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||A.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-P(-e):P(e);if(n!==e){var o=String(n),i=b.call(t,o.length+1);return v.call(o,r,"$&_")+"."+v.call(v.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,r,"$&_")}var M=r(6553),D=M.custom,B=z(D)?D:null;function N(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function U(e){return v.call(String(e),/"/g,"&quot;")}function $(e){return!("[object Array]"!==V(e)||I&&"object"==typeof e&&I in e)}function K(e){return!("[object RegExp]"!==V(e)||I&&"object"==typeof e&&I in e)}function z(e){if(R)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,o,s){var c=n||{};if(L(c,"quoteStyle")&&"single"!==c.quoteStyle&&"double"!==c.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(L(c,"maxStringLength")&&("number"==typeof c.maxStringLength?c.maxStringLength<0&&c.maxStringLength!==1/0:null!==c.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var y=!L(c,"customInspect")||c.customInspect;if("boolean"!=typeof y&&"symbol"!==y)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(L(c,"indent")&&null!==c.indent&&"\t"!==c.indent&&!(parseInt(c.indent,10)===c.indent&&c.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(L(c,"numericSeparator")&&"boolean"!=typeof c.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var w=c.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Z(t,c);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var A=String(t);return w?T(t,A):A}if("bigint"==typeof t){var P=String(t)+"n";return w?T(t,P):P}var E=void 0===c.depth?5:c.depth;if(void 0===o&&(o=0),o>=E&&E>0&&"object"==typeof t)return $(t)?"[Array]":"[Object]";var D,q=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=S.call(Array(e.indent+1)," ")}return{base:r,prev:S.call(Array(t+1),r)}}(c,o);if(void 0===s)s=[];else if(W(s,t)>=0)return"[Circular]";function H(t,r,n){if(r&&(s=k.call(s)).push(r),n){var i={depth:c.depth};return L(c,"quoteStyle")&&(i.quoteStyle=c.quoteStyle),e(t,i,o+1,s)}return e(t,c,o+1,s)}if("function"==typeof t&&!K(t)){var ee=function(e){if(e.name)return e.name;var t=g.call(m.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=X(t,H);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+S.call(te,", ")+" }":"")}if(z(t)){var re=R?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):O.call(t);return"object"!=typeof t||R?re:G(re)}if((D=t)&&"object"==typeof D&&("undefined"!=typeof HTMLElement&&D instanceof HTMLElement||"string"==typeof D.nodeName&&"function"==typeof D.getAttribute)){for(var ne="<"+_.call(String(t.nodeName)),oe=t.attributes||[],ie=0;ie<oe.length;ie++)ne+=" "+oe[ie].name+"="+N(U(oe[ie].value),"double",c);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+"</"+_.call(String(t.nodeName))+">"}if($(t)){if(0===t.length)return"[]";var ae=X(t,H);return q&&!function(e){for(var t=0;t<e.length;t++)if(W(e[t],"\n")>=0)return!1;return!0}(ae)?"["+Y(ae,q)+"]":"[ "+S.call(ae,", ")+" ]"}if(function(e){return!("[object Error]"!==V(e)||I&&"object"==typeof e&&I in e)}(t)){var se=X(t,H);return"cause"in Error.prototype||!("cause"in t)||j.call(t,"cause")?0===se.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(se,", ")+" }":"{ ["+String(t)+"] "+S.call(x.call("[cause]: "+H(t.cause),se),", ")+" }"}if("object"==typeof t&&y){if(B&&"function"==typeof t[B]&&M)return M(t,{depth:E-o});if("symbol"!==y&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ce=[];return a&&a.call(t,(function(e,r){ce.push(H(r,t,!0)+" => "+H(e,t))})),Q("Map",i.call(t),ce,q)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return u&&u.call(t,(function(e){le.push(H(e,t))})),Q("Set",l.call(t),le,q)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return J("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return J("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return J("WeakRef");if(function(e){return!("[object Number]"!==V(e)||I&&"object"==typeof e&&I in e)}(t))return G(H(Number(t)));if(function(e){if(!e||"object"!=typeof e||!F)return!1;try{return F.call(e),!0}catch(e){}return!1}(t))return G(H(F.call(t)));if(function(e){return!("[object Boolean]"!==V(e)||I&&"object"==typeof e&&I in e)}(t))return G(f.call(t));if(function(e){return!("[object String]"!==V(e)||I&&"object"==typeof e&&I in e)}(t))return G(H(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===r.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==V(e)||I&&"object"==typeof e&&I in e)}(t)&&!K(t)){var ue=X(t,H),de=C?C(t)===Object.prototype:t instanceof Object||t.constructor===Object,he=t instanceof Object?"":"null prototype",pe=!de&&I&&Object(t)===t&&I in t?b.call(V(t),8,-1):he?"Object":"",fe=(de||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||he?"["+S.call(x.call([],pe||[],he||[]),": ")+"] ":"");return 0===ue.length?fe+"{}":q?fe+"{"+Y(ue,q)+"}":fe+"{ "+S.call(ue,", ")+" }"}return String(t)};var q=Object.prototype.hasOwnProperty||function(e){return e in this};function L(e,t){return q.call(e,t)}function V(e){return y.call(e)}function W(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function Z(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return Z(b.call(e,0,t.maxStringLength),t)+n}return N(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,H),"single",t)}function H(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+w.call(t.toString(16))}function G(e){return"Object("+e+")"}function J(e){return e+" { ? }"}function Q(e,t,r,n){return e+" ("+t+") {"+(n?Y(r,n):S.call(r,", "))+"}"}function Y(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+S.call(e,","+r)+"\n"+t.prev}function X(e,t){var r=$(e),n=[];if(r){n.length=e.length;for(var o=0;o<e.length;o++)n[o]=L(e,o)?t(e[o],e):""}var i,a="function"==typeof E?E(e):[];if(R){i={};for(var s=0;s<a.length;s++)i["$"+a[s]]=a[s]}for(var c in e)L(e,c)&&(r&&String(Number(c))===c&&c<e.length||R&&i["$"+c]instanceof Symbol||(A.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof E)for(var l=0;l<a.length;l++)j.call(e,a[l])&&n.push("["+t(a[l])+"]: "+t(e[a[l]],e));return n}},2565:(e,t,r)=>{"use strict";var n=r(3298),o=/[\/\?<>\\:\*\|"]/g,i=/[\x00-\x1f\x80-\x9f]/g,a=/^\.+$/,s=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!=typeof e)throw new Error("Input must be string");var r=e.replace(o,t).replace(i,t).replace(a,t).replace(s,t).replace(c,t);return n(r,255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=l(e,r);return""===r?n:l(n,"")}},3298:(e,t,r)=>{"use strict";var n=r(2815),o=r(2875);e.exports=n.bind(null,o)},2815:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,o){if("string"!=typeof n)throw new Error("Input must be string");for(var i,a,s=n.length,c=0,l=0;l<s;l+=1){if(i=n.charCodeAt(l),a=n[l],t(i)&&r(n.charCodeAt(l+1))&&(a+=n[l+=1]),(c+=e(a))===o)return n.slice(0,l+1);if(c>o)return n.slice(0,l-a.length+1)}return n}},4136:(e,t,r)=>{"use strict";var n=r(5043),o=r(2499),i=o(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&i(e,".prototype.")>-1?o(r):r}},2499:(e,t,r)=>{"use strict";var n=r(4672),o=r(5043),i=r(7539),a=r(8533),s=o("%Function.prototype.apply%"),c=o("%Function.prototype.call%"),l=o("%Reflect.apply%",!0)||n.call(c,s),u=r(9236),d=o("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new a("a function is required");var t=l(n,c,arguments);return i(t,1+d(0,e.length-(arguments.length-1)),!0)};var h=function(){return l(n,s,arguments)};u?u(e.exports,"apply",{value:h}):e.exports.apply=h},9185:(e,t,r)=>{"use strict";var n=r(9236),o=r(7449),i=r(8533),a=r(8337);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new i("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new i("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new i("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new i("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new i("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new i("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!a&&a(e,t);if(n)n(e,t,{configurable:null===l&&d?d.configurable:!l,enumerable:null===s&&d?d.enumerable:!s,value:r,writable:null===c&&d?d.writable:!c});else{if(!u&&(s||c||l))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},5043:(e,t,r)=>{"use strict";var n,o=r(5936),i=r(2154),a=r(4442),s=r(8529),c=r(7449),l=r(8533),u=r(642),d=Function,h=function(e){try{return d('"use strict"; return ('+e+").constructor;")()}catch(e){}},p=Object.getOwnPropertyDescriptor;if(p)try{p({},"")}catch(e){p=null}var f=function(){throw new l},y=p?function(){try{return f}catch(e){try{return p(arguments,"callee").get}catch(e){return f}}}():f,m=r(4573)(),g=r(8912)(),b=Object.getPrototypeOf||(g?function(e){return e.__proto__}:null),v={},w="undefined"!=typeof Uint8Array&&b?b(Uint8Array):n,_={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":m&&b?b([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":o,"%eval%":eval,"%EvalError%":i,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&b?b(b([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&b?b((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":a,"%ReferenceError%":s,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&b?b((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&b?b(""[Symbol.iterator]()):n,"%Symbol%":m?Symbol:n,"%SyntaxError%":c,"%ThrowTypeError%":y,"%TypedArray%":w,"%TypeError%":l,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(b)try{null.error}catch(e){var A=b(b(e));_["%Error.prototype%"]=A}var x=function e(t){var r;if("%AsyncFunction%"===t)r=h("async function () {}");else if("%GeneratorFunction%"===t)r=h("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=h("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&b&&(r=b(o.prototype))}return _[t]=r,r},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},k=r(4672),P=r(2907),F=k.call(Function.call,Array.prototype.concat),E=k.call(Function.apply,Array.prototype.splice),O=k.call(Function.call,String.prototype.replace),R=k.call(Function.call,String.prototype.slice),I=k.call(Function.call,RegExp.prototype.exec),j=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,T=function(e,t){var r,n=e;if(P(S,n)&&(n="%"+(r=S[n])[0]+"%"),P(_,n)){var o=_[n];if(o===v&&(o=x(n)),void 0===o&&!t)throw new l("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new l('"allowMissing" argument must be a boolean');if(null===I(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=R(e,0,1),r=R(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var n=[];return O(e,j,(function(e,t,r,o){n[n.length]=r?O(o,C,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",o=T("%"+n+"%",t),i=o.name,a=o.value,s=!1,u=o.alias;u&&(n=u[0],E(r,F([0,1],u)));for(var d=1,h=!0;d<r.length;d+=1){var f=r[d],y=R(f,0,1),m=R(f,-1);if(('"'===y||"'"===y||"`"===y||'"'===m||"'"===m||"`"===m)&&y!==m)throw new c("property names with quotes must have matching quotes");if("constructor"!==f&&h||(s=!0),P(_,i="%"+(n+="."+f)+"%"))a=_[i];else if(null!=a){if(!(f in a)){if(!t)throw new l("base intrinsic for "+e+" exists, but the property is not available.");return}if(p&&d+1>=r.length){var g=p(a,f);a=(h=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:a[f]}else h=P(a,f),a=a[f];h&&!s&&(_[i]=a)}}return a}},3892:(e,t,r)=>{"use strict";var n=r(9236),o=function(){return!!n};o.hasArrayLengthDefineBug=function(){if(!n)return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=o},9177:function(e,t,r){var n;e=r.nmd(e),function(o){t&&t.nodeType,e&&e.nodeType;var i="object"==typeof r.g&&r.g;i.global!==i&&i.window!==i&&i.self;var a,s=2147483647,c=36,l=26,u=38,d=700,h=/^xn--/,p=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=c-1,g=Math.floor,b=String.fromCharCode;function v(e){throw new RangeError(y[e])}function w(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function _(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+w((e=e.replace(f,".")).split("."),t).join(".")}function A(e){for(var t,r,n=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function x(e){return w(e,(function(e){var t="";return e>65535&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+b(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,r){var n=0;for(e=r?g(e/d):e>>1,e+=g(e/t);e>m*l>>1;n+=c)e=g(e/m);return g(n+(m+1)*e/(e+u))}function P(e){var t,r,n,o,i,a,u,d,h,p,f,y=[],m=e.length,b=0,w=128,_=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&v("not-basic"),y.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<m;){for(i=b,a=1,u=c;o>=m&&v("invalid-input"),((d=(f=e.charCodeAt(o++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c)>=c||d>g((s-b)/a))&&v("overflow"),b+=d*a,!(d<(h=u<=_?1:u>=_+l?l:u-_));u+=c)a>g(s/(p=c-h))&&v("overflow"),a*=p;_=k(b-i,t=y.length+1,0==i),g(b/t)>s-w&&v("overflow"),w+=g(b/t),b%=t,y.splice(b++,0,w)}return x(y)}function F(e){var t,r,n,o,i,a,u,d,h,p,f,y,m,w,_,x=[];for(y=(e=A(e)).length,t=128,r=0,i=72,a=0;a<y;++a)(f=e[a])<128&&x.push(b(f));for(n=o=x.length,o&&x.push("-");n<y;){for(u=s,a=0;a<y;++a)(f=e[a])>=t&&f<u&&(u=f);for(u-t>g((s-r)/(m=n+1))&&v("overflow"),r+=(u-t)*m,t=u,a=0;a<y;++a)if((f=e[a])<t&&++r>s&&v("overflow"),f==t){for(d=r,h=c;!(d<(p=h<=i?1:h>=i+l?l:h-i));h+=c)_=d-p,w=c-p,x.push(b(S(p+_%w,0))),d=g(_/w);x.push(b(S(d,0))),i=k(r,m,n==o),r=0,++n}++r,++t}return x.join("")}a={version:"1.4.1",ucs2:{decode:A,encode:x},decode:P,encode:F,toASCII:function(e){return _(e,(function(e){return p.test(e)?"xn--"+F(e):e}))},toUnicode:function(e){return _(e,(function(e){return h.test(e)?P(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return a}.call(t,r,t,e))||(e.exports=n)}()},7032:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},3184:(e,t,r)=>{"use strict";var n=r(1645),o=r(5610),i=r(7032);e.exports={formats:i,parse:o,stringify:n}},5610:(e,t,r)=>{"use strict";var n=r(8206),o=Object.prototype.hasOwnProperty,i=Array.isArray,a={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(i),l=s?i.slice(0,s.index):i,u=[];if(l){if(!r.plainObjects&&o.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var d=0;r.depth>0&&null!==(s=a.exec(i))&&d<r.depth;){if(d+=1,!r.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(s[1])}if(s){if(!0===r.strictDepth)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+i.slice(s.index)+"]")}return function(e,t,r,n){for(var o=n?t:c(t,r),i=e.length-1;i>=0;--i){var a,s=e[i];if("[]"===s&&r.parseArrays)a=r.allowEmptyArrays&&(""===o||r.strictNullHandling&&null===o)?[]:[].concat(o);else{a=r.plainObjects?Object.create(null):{};var l="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=r.decodeDotInKeys?l.replace(/%2E/g,"."):l,d=parseInt(u,10);r.parseArrays||""!==u?!isNaN(d)&&s!==u&&String(d)===u&&d>=0&&r.parseArrays&&d<=r.arrayLimit?(a=[])[d]=o:"__proto__"!==u&&(a[u]=o):a={0:o}}o=a}return o}(u,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return a;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset,r=void 0===e.duplicates?a.duplicates:e.duplicates;if("combine"!==r&&"first"!==r&&"last"!==r)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||a.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:a.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:a.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,duplicates:r,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:a.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var r={__proto__:null},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var u,d=t.parameterLimit===1/0?void 0:t.parameterLimit,h=l.split(t.delimiter,d),p=-1,f=t.charset;if(t.charsetSentinel)for(u=0;u<h.length;++u)0===h[u].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[u]?f="utf-8":"utf8=%26%2310003%3B"===h[u]&&(f="iso-8859-1"),p=u,u=h.length);for(u=0;u<h.length;++u)if(u!==p){var y,m,g=h[u],b=g.indexOf("]="),v=-1===b?g.indexOf("="):b+1;-1===v?(y=t.decoder(g,a.decoder,f,"key"),m=t.strictNullHandling?null:""):(y=t.decoder(g.slice(0,v),a.decoder,f,"key"),m=n.maybeMap(c(g.slice(v+1),t),(function(e){return t.decoder(e,a.decoder,f,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===f&&(m=s(m)),g.indexOf("[]=")>-1&&(m=i(m)?[m]:m);var w=o.call(r,y);w&&"combine"===t.duplicates?r[y]=n.combine(r[y],m):w&&"last"!==t.duplicates||(r[y]=m)}return r}(e,r):e,d=r.plainObjects?Object.create(null):{},h=Object.keys(u),p=0;p<h.length;++p){var f=h[p],y=l(f,u[f],r,"string"==typeof e);d=n.merge(d,y,r)}return!0===r.allowSparse?d:n.compact(d)}},1645:(e,t,r)=>{"use strict";var n=r(8541),o=r(8206),i=r(7032),a=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=Array.prototype.push,u=function(e,t){l.apply(e,c(t)?t:[t])},d=Date.prototype.toISOString,h=i.default,p={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:i.formatters[h],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},f={},y=function e(t,r,i,a,s,l,d,h,y,m,g,b,v,w,_,A,x,S){for(var k,P=t,F=S,E=0,O=!1;void 0!==(F=F.get(f))&&!O;){var R=F.get(t);if(E+=1,void 0!==R){if(R===E)throw new RangeError("Cyclic object value");O=!0}void 0===F.get(f)&&(E=0)}if("function"==typeof m?P=m(r,P):P instanceof Date?P=v(P):"comma"===i&&c(P)&&(P=o.maybeMap(P,(function(e){return e instanceof Date?v(e):e}))),null===P){if(l)return y&&!A?y(r,p.encoder,x,"key",w):r;P=""}if("string"==typeof(k=P)||"number"==typeof k||"boolean"==typeof k||"symbol"==typeof k||"bigint"==typeof k||o.isBuffer(P))return y?[_(A?r:y(r,p.encoder,x,"key",w))+"="+_(y(P,p.encoder,x,"value",w))]:[_(r)+"="+_(String(P))];var I,j=[];if(void 0===P)return j;if("comma"===i&&c(P))A&&y&&(P=o.maybeMap(P,y)),I=[{value:P.length>0?P.join(",")||null:void 0}];else if(c(m))I=m;else{var C=Object.keys(P);I=g?C.sort(g):C}var T=h?r.replace(/\./g,"%2E"):r,M=a&&c(P)&&1===P.length?T+"[]":T;if(s&&c(P)&&0===P.length)return M+"[]";for(var D=0;D<I.length;++D){var B=I[D],N="object"==typeof B&&void 0!==B.value?B.value:P[B];if(!d||null!==N){var U=b&&h?B.replace(/\./g,"%2E"):B,$=c(P)?"function"==typeof i?i(M,U):M:M+(b?"."+U:"["+U+"]");S.set(t,E);var K=n();K.set(f,S),u(j,e(N,$,i,a,s,l,d,h,"comma"===i&&A&&c(P)?null:y,m,g,b,v,w,_,A,x,K))}}return j};e.exports=function(e,t){var r,o=e,l=function(e){if(!e)return p;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=i.default;if(void 0!==e.format){if(!a.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n,o=i.formatters[r],l=p.filter;if(("function"==typeof e.filter||c(e.filter))&&(l=e.filter),n=e.arrayFormat in s?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":p.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===e.allowDots?!0===e.encodeDotInKeys||p.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:p.allowEmptyArrays,arrayFormat:n,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:p.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:l,format:r,formatter:o,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof l.filter?o=(0,l.filter)("",o):c(l.filter)&&(r=l.filter);var d=[];if("object"!=typeof o||null===o)return"";var h=s[l.arrayFormat],f="comma"===h&&l.commaRoundTrip;r||(r=Object.keys(o)),l.sort&&r.sort(l.sort);for(var m=n(),g=0;g<r.length;++g){var b=r[g];l.skipNulls&&null===o[b]||u(d,y(o[b],b,h,f,l.allowEmptyArrays,l.strictNullHandling,l.skipNulls,l.encodeDotInKeys,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,m))}var v=d.join(l.delimiter),w=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),v.length>0?w+v:""}},8206:(e,t,r)=>{"use strict";var n=r(7032),o=Object.prototype.hasOwnProperty,i=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},c=1024;e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],a=o.obj[o.prop],s=Object.keys(a),c=0;c<s.length;++c){var l=s[c],u=a[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:a,prop:l}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(i(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,o,i){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",u=0;u<s.length;u+=c){for(var d=s.length>=c?s.slice(u,u+c):s,h=[],p=0;p<d.length;++p){var f=d.charCodeAt(p);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||i===n.RFC1738&&(40===f||41===f)?h[h.length]=d.charAt(p):f<128?h[h.length]=a[f]:f<2048?h[h.length]=a[192|f>>6]+a[128|63&f]:f<55296||f>=57344?h[h.length]=a[224|f>>12]+a[128|f>>6&63]+a[128|63&f]:(p+=1,f=65536+((1023&f)<<10|1023&d.charCodeAt(p)),h[h.length]=a[240|f>>18]+a[128|f>>12&63]+a[128|f>>6&63]+a[128|63&f])}l+=h.join("")}return l},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(i(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!o.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var a=t;return i(t)&&!i(r)&&(a=s(t,n)),i(t)&&i(r)?(r.forEach((function(r,i){if(o.call(t,i)){var a=t[i];a&&"object"==typeof a&&r&&"object"==typeof r?t[i]=e(a,r,n):t.push(r)}else t[i]=r})),t):Object.keys(r).reduce((function(t,i){var a=r[i];return o.call(t,i)?t[i]=e(t[i],a,n):t[i]=a,t}),a)}}},7539:(e,t,r)=>{"use strict";var n=r(5043),o=r(9185),i=r(3892)(),a=r(8337),s=r(8533),c=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new s("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new s("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,l=!0;if("length"in e&&a){var u=a(e,"length");u&&!u.configurable&&(n=!1),u&&!u.writable&&(l=!1)}return(n||l||!r)&&(i?o(e,"length",t,!0,!0):o(e,"length",t)),e}},8541:(e,t,r)=>{"use strict";var n=r(5043),o=r(4136),i=r(201),a=r(8533),s=n("%WeakMap%",!0),c=n("%Map%",!0),l=o("WeakMap.prototype.get",!0),u=o("WeakMap.prototype.set",!0),d=o("WeakMap.prototype.has",!0),h=o("Map.prototype.get",!0),p=o("Map.prototype.set",!0),f=o("Map.prototype.has",!0),y=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new a("Side channel does not contain "+i(e))},get:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(c){if(t)return h(t,n)}else if(r)return function(e,t){var r=y(e,t);return r&&r.value}(r,n)},has:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return d(e,n)}else if(c){if(t)return f(t,n)}else if(r)return function(e,t){return!!y(e,t)}(r,n);return!1},set:function(n,o){s&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new s),u(e,n,o)):c?(t||(t=new c),p(t,n,o)):(r||(r={key:{},next:null}),function(e,t,r){var n=y(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,n,o))}};return n}},8526:(e,t,r)=>{"use strict";var n=r(9177);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var i=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),u=["%","/","?",";","#"].concat(l),d=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=r(3184);function b(e,t,r){if(e&&"object"==typeof e&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!r&&1===e.split("#").length){var v=s.exec(b);if(v)return this.path=b,this.href=b,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?g.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=i.exec(b);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,b=b.substr(w.length)}if(r||w||b.match(/^\/\/[^@/]+@[^@/]+/)){var A="//"===b.substr(0,2);!A||w&&y[w]||(b=b.substr(2),this.slashes=!0)}if(!y[w]&&(A||w&&!m[w])){for(var x,S,k=-1,P=0;P<d.length;P++)-1!==(F=b.indexOf(d[P]))&&(-1===k||F<k)&&(k=F);for(-1!==(S=-1===k?b.lastIndexOf("@"):b.lastIndexOf("@",k))&&(x=b.slice(0,S),b=b.slice(S+1),this.auth=decodeURIComponent(x)),k=-1,P=0;P<u.length;P++){var F;-1!==(F=b.indexOf(u[P]))&&(-1===k||F<k)&&(k=F)}-1===k&&(k=b.length),this.host=b.slice(0,k),b=b.slice(k),this.parseHost(),this.hostname=this.hostname||"";var E="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!E)for(var O=this.hostname.split(/\./),R=(P=0,O.length);P<R;P++){var I=O[P];if(I&&!I.match(h)){for(var j="",C=0,T=I.length;C<T;C++)I.charCodeAt(C)>127?j+="x":j+=I[C];if(!j.match(h)){var M=O.slice(0,P),D=O.slice(P+1),B=I.match(p);B&&(M.push(B[1]),D.unshift(B[2])),D.length&&(b="/"+D.join(".")+b),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+N,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!f[_])for(P=0,R=l.length;P<R;P++){var $=l[P];if(-1!==b.indexOf($)){var K=encodeURIComponent($);K===$&&(K=escape($)),b=b.split($).join(K)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var q=b.indexOf("?");if(-1!==q?(this.search=b.substr(q),this.query=b.substr(q+1),t&&(this.query=g.parse(this.query)),b=b.slice(0,q)):t&&(this.search="",this.query={}),b&&(this.pathname=b),m[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var L=this.search||"";this.path=N+L}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(i=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||m[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if("string"==typeof e){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),i=0;i<n.length;i++){var a=n[i];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),c=0;c<s.length;c++){var l=s[c];"protocol"!==l&&(r[l]=e[l])}return m[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!m[e.protocol]){for(var u=Object.keys(e),d=0;d<u.length;d++){var h=u[d];r[h]=e[h]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||y[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",g=r.search||"";r.path=f+g}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var b=r.pathname&&"/"===r.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=v||b||r.host&&e.pathname,_=w,A=r.pathname&&r.pathname.split("/")||[],x=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!m[r.protocol]);if(x&&(r.hostname="",r.port=null,r.host&&(""===A[0]?A[0]=r.host:A.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===A[0])),v)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,A=p;else if(p.length)A||(A=[]),A.pop(),A=A.concat(p),r.search=e.search,r.query=e.query;else if(null!=e.search)return x&&(r.host=A.shift(),r.hostname=r.host,(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.hostname=E.shift(),r.host=r.hostname)),r.search=e.search,r.query=e.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!A.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=A.slice(-1)[0],k=(r.host||e.host||A.length>1)&&("."===S||".."===S)||""===S,P=0,F=A.length;F>=0;F--)"."===(S=A[F])?A.splice(F,1):".."===S?(A.splice(F,1),P++):P&&(A.splice(F,1),P--);if(!w&&!_)for(;P--;P)A.unshift("..");!w||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),k&&"/"!==A.join("/").substr(-1)&&A.push("");var E,O=""===A[0]||A[0]&&"/"===A[0].charAt(0);return x&&(r.hostname=O?"":A.length?A.shift():"",r.host=r.hostname,(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.hostname=E.shift(),r.host=r.hostname)),(w=w||r.host&&A.length)&&!O&&A.unshift(""),A.length>0?r.pathname=A.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){return"string"==typeof e&&(e=b(e)),e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o},2875:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var n=e.length,o=0,i=null,a=null,s=0;s<n;s++)r(i=e.charCodeAt(s))?null!=a&&t(a)?o+=1:o+=3:i<=127?o+=1:i>=128&&i<=2047?o+=2:i>=2048&&i<=65535&&(o+=3),a=i;return o}},6553:()=>{}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";const e=async e=>{const t=await chrome.tabs.get(e);return await chrome.tabs.captureVisibleTab(t.windowId,{format:"jpeg",quality:100})};var t,n,o,i,a,s,c,l;!function(e){e[e.captureFailed=1]="captureFailed",e[e.fileLinkLost=2]="fileLinkLost"}(t||(t={})),function(e){e[e.drmProtected=1]="drmProtected",e[e.fileLinkLost=2]="fileLinkLost"}(n||(n={})),function(e){e[e.miningCommand=1]="miningCommand",e[e.failedToAutoLoadPreferredTrack=2]="failedToAutoLoadPreferredTrack",e[e.userRequested=3]="userRequested"}(o||(o={})),function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard",e[e.exportCard=3]="exportCard"}(i||(i={})),function(e){e[e.remember=0]="remember",e[e.play=1]="play",e[e.pause=2]="pause"}(a||(a={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(s||(s={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause",e[e.fastForward=4]="fastForward",e[e.repeat=5]="repeat"}(c||(c={})),function(e){e[e.timeDisplay=0]="timeDisplay",e[e.subtitleOffset=1]="subtitleOffset",e[e.playbackRate=2]="playbackRate"}(l||(l={}));var u,d=r(2565),h=r.n(d);function p(e,t=!1){const r=Math.floor(e/1e3);let n;n=t?Math.round(e/1e3%60*10)/10:r%60;const o=Math.floor(r/60)%60,i=Math.floor(r/3600);return i>0?i+"h"+String(o).padStart(2,"0")+"m"+String(n).padStart(2,"0")+"s":o+"m"+String(n).padStart(2,"0")+"s"}function f(e,t,r){if(0===t.length)return e.text;const n=[e.start,e.end];return o=t.filter((e=>function(e,t){const r=Math.max(0,e.end-e.start);if(0===r)return!1;const n=Math.max(e.start,t[0]);return Math.min(e.end,t[1])-n>=r/2}(e,n))).filter((e=>void 0===r||e.track===r)),o.filter((e=>""!==e.text.trim())).map((e=>e.text)).join("\n");var o}function y(e,t){const r=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=h()(t),n.click(),URL.revokeObjectURL(r),n.remove()}!function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(u||(u={}));const m={},g=e=>e in m,b=(e,t)=>`${e.replaceAll(" ","_").substring(0,Math.min(e.length,24))}_${Math.floor(t)}`;class v{constructor(e,t,r,n,o){this._name=e,this._timestamp=t,this._base64=r,this._extension=n,this._error=o}get name(){return this._name}get timestamp(){return this._timestamp}get extension(){return this._extension}get error(){return this._error}atTimestamp(e){return this}get canChangeTimestamp(){return!1}async base64(){return this._base64}async blob(){return await this._blob()}async _blob(){return this.cachedBlob||(this.cachedBlob=await(await fetch(this._dataUrl())).blob()),this.cachedBlob}async dataUrl(){return this._dataUrl()}_dataUrl(){return"data:image/"+this.extension+";base64,"+this._base64}dispose(){}}class w extends Error{}class _{constructor(e,t,r,n,o,i){this._file=e,this._name=`${b(e.name,t)}.jpeg`,this._timestamp=t,this._maxWidth=r,this._maxHeight=n,this._video=o,this._canvas=i}get name(){return this._name}get timestamp(){return this._timestamp}get extension(){return"jpeg"}get error(){if(this._file.blobUrl)return g(this._file.blobUrl)?void 0:t.fileLinkLost}atTimestamp(e){return e===this._timestamp?this:(this._canvasPromiseReject?.(new w),new _(this._file,e,this._maxWidth,this._maxHeight,this._video,this._canvas))}get canChangeTimestamp(){return!0}async base64(){return new Promise(((e,t)=>{this._getCanvas().then((t=>{const r=t.toDataURL("image/jpeg");e(r.substring(r.indexOf(",")+1))})).catch(t)}))}async blob(){return new Promise(((e,t)=>{this._getCanvas().then((r=>{r.toBlob((r=>{null===r?t(new Error("Could not obtain blob")):e(r)}),"image/jpeg")})).catch(t)}))}async dataUrl(){return(await this._getCanvas()).toDataURL()}async _getCanvas(){return this._canvasPromise||(this._canvasPromise=new Promise((async(e,t)=>{this._canvasPromiseReject=t;const r=this._videoElement(this._file),n=()=>Math.max(0,Math.min(r.duration,this._timestamp/1e3));Number.isFinite(r.duration)?r.currentTime=n():r.onloadedmetadata=()=>{r.currentTime=n(),r.onloadedmetadata=null},r.onseeked=async t=>{this._canvasPromiseReject=void 0,this._canvas||(this._canvas=document.createElement("canvas"));const n=this._canvas;n.width=r.videoWidth,n.height=r.videoHeight;const o=n.getContext("2d");o.drawImage(r,0,0,n.width,n.height),r.onseeked=null,this._maxWidth>0||this._maxHeight>0?(await((e,t,r,n)=>new Promise(((o,i)=>{const a=r<=0?1:r/e.width,s=n<=0?1:n/e.height,c=Math.min(1,Math.min(a,s));if(c<1){const r=e.width*c,n=e.height*c;createImageBitmap(e,{resizeWidth:r,resizeHeight:n,resizeQuality:"high"}).then((i=>{e.width=r,e.height=n,t.drawImage(i,0,0),o(e)})).catch((e=>i(e)))}else o(e)})))(n,o,this._maxWidth,this._maxHeight),e(n)):e(n)},r.onerror=()=>{t(r.error?.message??"Could not load video to obtain screenshot")}}))),this._canvasPromise}_videoElement(e){if(this._video)return this._video;const t=document.createElement("video");return t.src=e.blobUrl,t.preload="metadata",t.autoplay=!1,t.volume=0,t.controls=!1,t.pause(),this._video=t,t}dispose(){this._video&&(this._video.removeAttribute("src"),this._video.load(),this._video.remove(),this._video=void 0,this._canvas?.remove())}}class A{constructor(e){this.data=e}static fromCard(e,t,r){return e.image?A.fromBase64(e.subtitleFileName,e.subtitle.start,e.image.base64,e.image.extension,e.image.error):e.file?A.fromFile(e.file,e.mediaTimestamp??e.subtitle.start,t,r):void 0}static fromBase64(e,t,r,n,o){const i=e.substring(0,e.lastIndexOf(".")),a=`${b(i,t)}.${n}`;return new A(new v(a,t,r,n,o))}static fromFile(e,t,r,n){return new A(new _(e,t,r,n))}get name(){return this.data.name}get timestamp(){return this.data.timestamp}get extension(){return this.data.extension}get error(){return this.data.error}async base64(){return await this.data.base64()}async dataUrl(){return await this.data.dataUrl()}async blob(){return await this.data.blob()}async pngBlob(){return new Promise((async(e,t)=>{try{createImageBitmap(await this.blob()).then((r=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),n.toBlob((r=>{r?e(r):t("Failed to convert to PNG")}),"image/png")}))}catch(e){t(e)}}))}atTimestamp(e){return new A(this.data.atTimestamp(e))}get canChangeTimestamp(){return this.data.canChangeTimestamp}dispose(){return this.data.dispose()}async download(){y(await this.data.blob(),this.data.name)}}var x,S,k;!function(e){e[e.noActiveTabPermission=1]="noActiveTabPermission",e[e.drmProtected=2]="drmProtected",e[e.other=3]="other"}(x||(x={})),function(e){e[e.timedAudioRecordingInProgress=1]="timedAudioRecordingInProgress",e[e.other=2]="other"}(S||(S={}));class P{async fetch(e,t){const r=await fetch(e,{method:"POST",body:JSON.stringify(t)});return await r.json()}}var F=new Uint8Array(16);function E(){if(!k&&!(k="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(F)}const O=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var R=[],I=0;I<256;++I)R.push((I+256).toString(16).substr(1));const j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(R[e[t+0]]+R[e[t+1]]+R[e[t+2]]+R[e[t+3]]+"-"+R[e[t+4]]+R[e[t+5]]+"-"+R[e[t+6]]+R[e[t+7]]+"-"+R[e[t+8]]+R[e[t+9]]+"-"+R[e[t+10]]+R[e[t+11]]+R[e[t+12]]+R[e[t+13]]+R[e[t+14]]+R[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&O.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r},C=function(e,t,r){var n=(e=e||{}).random||(e.rng||E)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return j(n)};class T extends Error{}class M extends Error{}const D=["version","action","params"],B=["guiAddCards","deckNames","modelNames","modelFieldNames","findNotes","guiBrowse","requestPermission","findNotes","notesInfo","updateNoteFields","addNote","storeMediaFile","version","addTags"];var N;!function(e){e[e.disabled=0]="disabled",e[e.inAndOut=1]="inAndOut",e[e.inNotOut=2]="inNotOut"}(N||(N={}));const U=Object.keys({ankiConnectUrl:!0,deck:!0,noteType:!0,sentenceField:!0,definitionField:!0,audioField:!0,imageField:!0,wordField:!0,sourceField:!0,urlField:!0,track1Field:!0,track2Field:!0,track3Field:!0,customAnkiFields:!0,tags:!0,recordWithAudioPlayback:!0,preferMp3:!0,audioPaddingStart:!0,audioPaddingEnd:!0,maxImageWidth:!0,maxImageHeight:!0,surroundingSubtitlesCountRadius:!0,surroundingSubtitlesTimeRadius:!0,ankiFieldSettings:!0,customAnkiFieldSettings:!0});var $;Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0,subtitleAlignment:!0}),Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0,imageBasedSubtitleScaleFactor:!0,subtitlePositionOffset:!0,topSubtitlePositionOffset:!0,subtitleAlignment:!0,subtitleTracksV2:!0,subtitlesWidth:!0}),function(e){e.noSubtitleList="noSubtitleList",e.app="app"}($||($={}));const K=(navigator.userAgentData?.platform??navigator.platform)?.toUpperCase()?.indexOf("MAC")>-1,z={ankiConnectUrl:"http://127.0.0.1:8765",deck:"",noteType:"",sentenceField:"",definitionField:"",audioField:"",imageField:"",wordField:"",sourceField:"",urlField:"",track1Field:"",track2Field:"",track3Field:"",ankiFieldSettings:{sentence:{order:1,display:!0},definition:{order:2,display:!0},word:{order:3,display:!0},audio:{order:4,display:!0},image:{order:5,display:!0},source:{order:6,display:!0},url:{order:7,display:!0},track1:{order:8,display:!1},track2:{order:9,display:!1},track3:{order:10,display:!1}},customAnkiFieldSettings:{},subtitleSize:36,subtitleColor:"#ffffff",subtitleThickness:700,subtitleOutlineThickness:0,subtitleOutlineColor:"#000000",subtitleShadowThickness:3,subtitleShadowColor:"#000000",subtitleBackgroundColor:"#000000",subtitleBackgroundOpacity:0,subtitleFontFamily:"",subtitlePreview:"アあ安Aa",subtitleCustomStyles:[],subtitleBlur:!1,subtitlePositionOffset:75,topSubtitlePositionOffset:75,subtitleAlignment:"bottom",subtitleTracksV2:[],subtitlesWidth:-1,audioPaddingStart:0,audioPaddingEnd:500,maxImageWidth:0,maxImageHeight:0,surroundingSubtitlesCountRadius:2,surroundingSubtitlesTimeRadius:1e4,autoPausePreference:s.atEnd,speedChangeStep:.1,fastForwardModePlaybackRate:2.7,keyBindSet:{togglePlay:{keys:"space"},toggleAutoPause:{keys:K?"⇧+P":"shift+P"},toggleCondensedPlayback:{keys:K?"⇧+O":"shift+O"},toggleFastForwardPlayback:{keys:K?"⇧+F":"shift+F"},toggleSubtitles:{keys:"down"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleVideoSubtitleTrack3:{keys:"3"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},toggleAsbplayerSubtitleTrack3:{keys:"W+3"},unblurAsbplayerTrack1:{keys:"B+1"},unblurAsbplayerTrack2:{keys:"B+2"},unblurAsbplayerTrack3:{keys:"B+3"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"up"},adjustOffsetToPreviousSubtitle:{keys:K?"⇧+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:K?"⇧+right":"ctrl+right"},decreaseOffset:{keys:K?"⇧+⌃+right":"ctrl+shift+right"},increaseOffset:{keys:K?"⇧+⌃+left":"ctrl+shift+left"},resetOffset:{keys:K?"⇧+⌃+down":"ctrl+shift+down"},copySubtitle:{keys:K?"⇧+⌃+Z":"ctrl+shift+Z"},ankiExport:{keys:K?"⇧+⌃+X":"ctrl+shift+X"},updateLastCard:{keys:K?"⇧+⌃+U":"ctrl+shift+U"},takeScreenshot:{keys:K?"⇧+⌃+V":"ctrl+shift+V"},toggleRecording:{keys:K?"⇧+⌃+R":"ctrl+shift+R"},decreasePlaybackRate:{keys:K?"⇧+⌃+[":"ctrl+shift+["},increasePlaybackRate:{keys:K?"⇧+⌃+]":"ctrl+shift+]"},toggleSidePanel:{keys:"`"},toggleRepeat:{keys:K?"⇧+R":"shift+R"}},recordWithAudioPlayback:!0,preferMp3:!0,tabName:"asbplayer",miningHistoryStorageLimit:25,preCacheSubtitleDom:!0,clickToMineDefaultAction:i.showAnkiDialog,postMiningPlaybackState:a.remember,themeType:"dark",copyToClipboardOnMine:!1,rememberSubtitleOffset:!0,lastSubtitleOffset:0,autoCopyCurrentSubtitle:!1,alwaysPlayOnSubtitleRepeat:!0,subtitleRegexFilter:"",subtitleRegexFilterTextReplacement:"",language:"en",customAnkiFields:{},tags:[],imageBasedSubtitleScaleFactor:1,streamingAppUrl:"https://killergerbah.github.io/asbplayer",streamingDisplaySubtitles:!0,streamingRecordMedia:!0,streamingTakeScreenshot:!0,streamingCleanScreenshot:!0,streamingCropScreenshot:!0,streamingSubsDragAndDrop:!0,streamingAutoSync:!1,streamingLastLanguagesSynced:{},streamingCondensedPlaybackMinimumSkipIntervalMs:1e3,streamingScreenshotDelay:1e3,streamingSubtitleListPreference:$.noSubtitleList,streamingEnableOverlay:!0,webSocketClientEnabled:!1,webSocketServerUrl:"ws://127.0.0.1:8766/ws",pauseOnHoverMode:0,lastSelectedAnkiExportMode:"default"},q=(Object.fromEntries(Object.entries(z).map((([e,t])=>{if("string"==typeof t)return[e,e=>e];if("boolean"==typeof t)return[e,e=>"true"===e];if("number"==typeof t)return[e,e=>Number(e)];if("object"==typeof t)return[e,e=>JSON.parse(e)];throw new Error("Could not determine deserializer for setting")}))),(e,t)=>{if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;const r=Object.keys(e),n=Object.keys(t);if(e.length!==t.length)return!1;for(const n of r)if(!q(e[n],t[n]))return!1;for(const r of n)if(!q(e[r],t[r]))return!1;return!0}),L=Object.fromEntries(Object.keys(z).filter((e=>"object"==typeof z[e])).map((e=>[e,!0])));class V{constructor(e){this._complexValues={},this._storage=e}async getAll(){return this.get(Object.keys(z))}async getSingle(e){return(await this.get([e]))[e]}async get(e){let t={};for(const r of e)t[r]=z[r];const r=await this._storage.get(t),n={};for(const e in t){const t=r[e]??z[e];if(L[e]){const r=this._complexValues[e];void 0!==r&&q(r,t)?n[e]=r:(this._complexValues[e]=t,n[e]=t)}else n[e]=t}return this._ensureConsistencyOnRead(n)}_ensureConsistencyOnRead(e){let t=!1,r={},n=!1,o={};if(void 0!==e.keyBindSet){const n=e.keyBindSet;for(const e of Object.keys(z.keyBindSet)){const o=e;void 0===n[o]?(r[o]=z.keyBindSet[o],t=!0):r[o]=n[o]}}if(void 0!==e.ankiFieldSettings){const t=e.ankiFieldSettings;for(const e of Object.keys(z.ankiFieldSettings)){const r=e;void 0===t[r]?(o[r]=z.ankiFieldSettings[r],n=!0):o[r]=t[r]}}return n||t?{...e,ankiFieldSettings:o,keyBindSet:r}:e}async set(e){await this._storage.set(await this._ensureConsistencyOnWrite(e))}async _ensureConsistencyOnWrite(e){if(void 0===e.customAnkiFields)return e;const t=e.customAnkiFieldSettings??(await this._storage.get({customAnkiFieldSettings:z.customAnkiFieldSettings})).customAnkiFieldSettings;let r=!1;for(const n of Object.keys(t))n in e.customAnkiFields||(delete t[n],r=!0);return r?{...e,customAnkiFieldSettings:t}:e}async activeProfile(){return await this._storage.activeProfile()}async setActiveProfile(e){await this._storage.setActiveProfile(e)}async profiles(){return await this._storage.profiles()}async addProfile(e){await this._storage.addProfile(e)}async removeProfile(e){await this._storage.removeProfile(e)}}const W=(e,t)=>`${(e=>`_prof_${e}_`)(t)}${e}`,Z=(e,t)=>e.substring(t.length+7),H=(e,t)=>{const r={};for(const n of Object.keys(e))r[W(n,t)]=e[n];return r};r(4445);const G=["en","es","de","ja","pl","pt_BR","zh_CN","ru"],J="activeSettingsProfile",Q="settingsProfiles";class Y{constructor(e){this._storage=e??chrome.storage.local}async get(e){const t=await this.activeProfile();return void 0===t?await this._storage.get(e):((e,t)=>{const r={};for(const n of Object.keys(e))r[Z(n,t)]=e[n];return r})(await this._storage.get(H(e,t.name)),t.name)}async set(e){const t=await this.activeProfile();void 0===t?await this._storage.set(e):await this._storage.set(H(e,t.name))}async activeProfile(){const e=(await this._storage.get(J))[J];if(void 0!==e)return(await this.profiles()).find((t=>t.name===e))}async setActiveProfile(e){if(void 0===e)await this._storage.remove(J);else{const t=void 0!==(await this.profiles()).find((t=>t.name===e));if(!t)throw new Error(`Cannot set active profile to non-existant profile ${e}`);await this._storage.set({[J]:e})}}async profiles(){return(await this._storage.get({[Q]:[]}))[Q]??[]}async addProfile(e){const t=await this.profiles(),r=t.find((t=>t.name===e));void 0===r&&t.push({name:e}),await this._storage.set({[Q]:t});const n=await this._storage.get(Object.keys(z));await this._storage.set(H(n,e))}async removeProfile(e){const t=await this.profiles(),r=await this.activeProfile();if(e===r?.name)throw new Error("Cannot remove active profile");const n=t.filter((t=>t.name!==e)),o=Object.keys(H(z,e));await this._storage.remove(o),await this._storage.set({[Q]:n})}async clear(){await this._storage.clear()}}const X=new V(new Y),ee=chrome.storage.session,te=async(e=!1)=>{if(!e){const e=(await ee.get(["config"])).config;if("-"===e)return;if(void 0!==e&&("number"!=typeof e.ttl||Date.now()<e.ttl))return e}try{const e=`${await X.getSingle("streamingAppUrl")}/extension.json`,t=await(await fetch(e)).json();if(re(t))return await ee.set({config:t}),t}catch(e){console.error(e)}},re=e=>void 0!==e&&ne(e.latest)&&oe(e.languages),ne=e=>"string"==typeof e.version&&"string"==typeof e.url,oe=e=>{if(void 0===e||"object"!=typeof e||!Array.isArray(e))return!1;for(const t of e)if("string"!=typeof t.code||"string"!=typeof t.url||"number"!=typeof t.version)return!1;return!0},ie=e=>`locVersion-${e}`,ae=new V(new Y),se=async e=>{try{let t=await te();if(void 0===t)return;const r=t.languages.find((t=>t.code===e))??(await te(!0))?.languages.find((t=>t.code===e));if(void 0===r)return;const n=ie(e),o=(await chrome.storage.local.get(n))[n];(void 0===o||o<r.version)&&await ce(r)}catch(e){console.error(e)}},ce=async({code:e,url:t,version:r})=>{const n=await ae.getSingle("streamingAppUrl"),o=t.startsWith("http://")||t.startsWith("https://")?t:`${n}/${t}`;try{const t=await(await fetch(o)).json();if("object"==typeof t){const n=ie(e),o=`locStrings-${e}`;await chrome.storage.local.set({[o]:t,[n]:r})}}catch(e){console.error(e)}};class le{constructor(){this._pongReceived=!1,this._pingPromises=[]}get socket(){return this._socket}async bind(e){this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=setInterval((()=>{if(void 0===this._lastPingTimestampMs||this._pongReceived)this.ping().catch(console.info);else{console.log("Did not receive pong - reconnecting");for(const e of this._pingPromises)e.reject("Timed out");this._pingPromises=[],this._connect(e)}}),1e4),await this._connect(e)}async _connect(e){if(this._disconnect(),!e)throw new Error("Invalid URL");return new Promise(((t,r)=>{this._connectPromise={resolve:t,reject:r};const n=new WebSocket(e);n.onmessage=async e=>{if("PONG"===e.data){this._pongReceived=!0;for(const e of this._pingPromises)e.resolve(void 0);this._pingPromises=[]}else{const t=JSON.parse(e.data);if("mine-subtitle"===t.command){const e={command:"response",messageId:t.messageId,body:{published:await(this.onMineSubtitle?.(t))??!1}};this._socket?.send(JSON.stringify(e))}else if("load-subtitles"===t.command){const e=t.messageId;await(this.onLoadSubtitles?.(t));const r={command:"response",messageId:e,body:{}};this._socket?.send(JSON.stringify(r))}}},n.onclose=e=>{console.log(`Socket closed - reason: ${e.reason}`),this._connectPromise?.reject("Socket closed"),this._connectPromise=void 0},n.onerror=()=>{console.log("Socket error"),this._connectPromise?.reject("Socket error"),this._connectPromise=void 0},n.onopen=()=>{this.ping().catch(console.error),this._connectPromise?.resolve(void 0),this._connectPromise=void 0},this._socket=n}))}async ping(){return new Promise(((e,t)=>{this._socket&&this._socket.readyState===this._socket.OPEN?(this._socket.send("PING"),this._lastPingTimestampMs=Date.now(),this._pongReceived=!1,this._pingPromises.push({resolve:e,reject:t})):t("Not connected")}))}_disconnect(){this._socket&&(this._socket.readyState!==this._socket.CLOSED&&this._socket.readyState!==this._socket.CLOSING&&this._socket.close(),this._socket=void 0)}unbind(){this._disconnect(),void 0!==this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=void 0);for(const e of this._pingPromises)e.reject("Disconnecting");this._pingPromises=[],this._lastPingTimestampMs=void 0,this._pongReceived=!1,this._connectPromise?.reject("Disconnecting"),this._connectPromise=void 0,this.onMineSubtitle=void 0}}let ue;const de=async(e,t)=>{ue?.unbind();const r=await e.getSingle("webSocketServerUrl");r&&(ue=new le,ue.bind(r),ue.onMineSubtitle=async({body:{fields:r,postMineAction:n}})=>new Promise(((o,a)=>{chrome.tabs.query({active:!0,currentWindow:!0},(async a=>{const s=await e.get(U),c=r??{},l=c[s.wordField]||void 0,u=c[s.definitionField]||void 0,d=c[s.sentenceField]||void 0,h=Object.fromEntries(Object.entries(s.customAnkiFields).map((([e,t])=>{const r=c[t];if(void 0!==r)return[e,r]})).filter((e=>void 0!==e))),p=n??i.showAnkiDialog;let f=!1;const y=t.publishCommandToVideoElements((e=>{if(e.loadedSubtitles&&void 0!==a.find((t=>t.id===e.tab.id)))return f=!0,{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",word:l,definition:u,text:d,postMineAction:p,customFieldValues:h},src:e.src}})),m=await t.publishCommandToAsbplayers({commandFactory:e=>{if(!e.sidePanel&&e.loadedSubtitles)return f=!0,{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle-with-additional-fields",word:l,definition:u,text:d,postMineAction:p,customFieldValues:h},asbplayerId:e.id}}});await y,await m,o(f)}))})),ue.onLoadSubtitles=async e=>{const{files:r}=e.body,n={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select",subtitleFiles:r}};t.publishCommandToVideoElementTabs((e=>n))})},he=()=>{ue?.unbind()},pe="tabRequestingActiveTabPermission";class fe{static async encode(e,t){return new Promise((async(r,n)=>{var o=new FileReader;o.onload=async e=>{try{const o=new AudioContext;if(null===e.target)return void n(new Error("Could not obtain buffer to encode"));const i=await o.decodeAudioData(e.target.result),a=[];for(let e=0;e<i.numberOfChannels;++e)a.push(i.getChannelData(e));const s=t(),c=s instanceof Worker?s:await s;c.postMessage({command:"encode",audioBuffer:{channels:a,numberOfChannels:i.numberOfChannels,length:i.length,sampleRate:i.sampleRate}}),c.onmessage=e=>{r(new Blob(e.data.buffer,{type:"audio/mp3"})),c.terminate()},c.onerror=e=>{const t=e?.error??new Error("MP3 encoding failed: "+e?.message);n(t),c.terminate()}}catch(e){n(e)}},o.readAsArrayBuffer(e)}))}}const ye=e=>new Promise((async(t,r)=>{try{var n=new FileReader;n.readAsDataURL(e),n.onloadend=()=>{const e=n.result,r=e.substring(e.indexOf(",")+1);t(r)}}catch(e){r(e)}})),me=navigator.userAgent.toLowerCase().includes("firefox"),ge=(e,t)=>`${e.replaceAll(" ","_").substring(0,Math.min(e.length,24))}_${Math.floor(t)}`,be=(e,t)=>{for(let r=e.length-1;r>=0;--r)if(t===e[r]){e.splice(r,1);break}},ve=(e,t)=>{for(const r of t[e])r()};class we{constructor(e,t,r,n,o,i,a){this._callbacks={play:[],pause:[]},this._name=ge(e,t),this._start=t,this._end=r,this.playbackRate=n,this._base64=o,this._extension=i,this._error=a}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return this._base64}async blob(){return await this._blob()}get playing(){return void 0!==this.playingAudio}onEvent(e,t){return this._callbacks[e].push(t),()=>{be(this._callbacks[e],t)}}async play(){if(this.playingAudio)return this.stop(),void ve("pause",this._callbacks);const e=await this._blob(),t=new Audio;t.src=URL.createObjectURL(e),t.preload="metadata",this.playingAudio=t,await t.play(),ve("play",this._callbacks),this.stopAudioTimeout=setTimeout((()=>{this.stopAudio(t),this.playingAudio=void 0,this.stopAudioTimeout=void 0,ve("pause",this._callbacks)}),(this._end-this._start)/this.playbackRate+100)}stop(){this.playingAudio&&(this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0,ve("pause",this._callbacks))}stopAudio(e){e.pause();const t=e.src;e.removeAttribute("src"),e.load(),URL.revokeObjectURL(t)}async _blob(){return this.cachedBlob||(this.cachedBlob=((e,t)=>{const r=atob(e),n=new Uint8Array(r.length);for(let e=0;e<n.length;++e)n[e]=r.charCodeAt(e);return new Blob([n.buffer],{type:t})})(this._base64,`audio/${this.extension}`)),this.cachedBlob}slice(e,t){return this}isSliceable(){return!1}get error(){return this._error}}class _e extends Error{}class Ae{constructor(e,t,r,n,o,i,a){this._file=e,this._start=t,this._end=r,this._playbackRate=n,this._recorderMimeType=o,this._callbacks=i,this._trackId=a}latestBlobPromise(){return this._blobPromise}get isPlayingAudibly(){return!me&&void 0!==this._clippingAudioElement&&!0===this._clippingAudibly||void 0!==this._playingAudioElement}get isRecordingSilently(){return void 0!==this._clippingAudioElement&&!1===this._clippingAudibly}get finishedRecording(){return void 0!==this._blob}async play(){if(this._playingAudioElement)return this._stopPlayingAudio(),void ve("pause",this._callbacks);if(this._blob){const e=await this._audioElement(URL.createObjectURL(this._blob),!1);e.currentTime=0,await e.play(),ve("play",this._callbacks),this._playingAudioElement=e}else{const e=await this._audioElement(this._file.blobUrl,!0);e.oncanplay=async t=>{e.play(),ve("play",this._callbacks),e.oncanplay=null},this._playingAudioElement=e}this._stopAudioTimeout=setTimeout((()=>{void 0!==this._playingAudioElement&&(this._stopAudio(this._playingAudioElement,!0),ve("pause",this._callbacks),this._playingAudioElement=void 0),this._stopAudioTimeout=void 0}),(this._end-this._start)/this._playbackRate+100)}async clip(e){return this._stopClippingAudio(),this._clippingAudibly=e,this._blobPromise=new Promise((async(t,r)=>{try{const n=await this._audioElement(this._file.blobUrl,!0);n.oncanplay=async o=>{if(n.oncanplay=null,!e){const e=new AudioContext,t=e.createMediaStreamDestination();e.createMediaElementSource(n).connect(t)}await n.play(),e&&ve("play",this._callbacks);const i=this._captureStream(n),a=new MediaRecorder(i,{mimeType:this._recorderMimeType}),s=[];a.ondataavailable=e=>{s.push(e.data)};let c=!1;a.onstop=e=>{c&&(this._blob=new Blob(s,{type:this._recorderMimeType}),t(this._blob))},a.start(),this._clippingAudioReject=r,this._clippingAudioElement=n,this._stopClippingTimeout=setTimeout((()=>{this._stopAudio(n,!1),this._clippingAudioElement=void 0,this._stopClippingTimeout=void 0,this._clippingAudioReject=void 0,c=!0,a.stop();for(const e of i.getAudioTracks())e.stop()}),(this._end-this._start)/this._playbackRate+100)}}catch(e){r(e)}})),this._blobPromise}stop(){this._playingAudioElement&&(this._stopPlayingAudio(),ve("pause",this._callbacks)),this._clippingAudioElement&&(this._stopClippingAudio(),ve("pause",this._callbacks))}_stopClippingAudio(){this._clippingAudioElement&&(this._stopAudio(this._clippingAudioElement,!1),clearTimeout(this._stopClippingTimeout),this._clippingAudioReject?.(new _e),this._clippingAudioElement=void 0,this._stopClippingTimeout=void 0,this._clippingAudioReject=void 0,this._blobPromise=void 0)}_stopPlayingAudio(){this._playingAudioElement&&(this._stopAudio(this._playingAudioElement,!0),clearTimeout(this._stopAudioTimeout),this._playingAudioElement=void 0,this._stopAudioTimeout=void 0)}_audioElement(e,t){const r=new Audio;return r.preload="metadata",r.src=e,new Promise(((e,n)=>{r.onloadedmetadata=()=>{if(t&&this._trackId&&r.audioTracks&&r.audioTracks.length>0)for(const e of r.audioTracks)e.enabled=this._trackId===e.id;r.currentTime=this._start/1e3,r.playbackRate=this._playbackRate,e(r)},r.onerror=()=>{n(r.error?.message??"Could not load audio")}}))}_stopAudio(e,t){e.pause();const r=e.src;e.removeAttribute("src"),e.load(),t&&URL.revokeObjectURL(r)}_captureStream(e){let t;if("function"==typeof e.captureStream&&(t=e.captureStream()),"function"==typeof e.mozCaptureStream&&(t=e.mozCaptureStream()),void 0===t)throw new Error("Unable to capture stream from audio");const r=new MediaStream;for(const e of t.getVideoTracks())e.stop();for(const e of t.getAudioTracks())e.enabled&&r.addTrack(e);return r}}class xe{constructor(e,t,r,n,o,i,a){const[s,c]=function(){const e={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(e).filter(MediaRecorder.isTypeSupported).map((t=>[t,e[t]]))[0]}();this._recorderMimeType=s,this._file=e,this._name=ge(e.name,t),this._start=t,this._end=r,this._playbackRate=n,this._recordAudibly=o,this._trackId=i,this._callbacks=a??{play:[],pause:[]},this._extension=c,this._blobClipper=new Ae(e,t,r,n,s,this._callbacks,i)}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return new Promise((async(e,t)=>{var r=new FileReader;const n=await this.blob();r.readAsDataURL(n),r.onloadend=()=>{const t=r.result,n=t.substring(t.indexOf(",")+1);e(n)}}))}get playing(){return this._playClipper?.isPlayingAudibly??!1}onEvent(e,t){return this._callbacks[e].push(t),()=>{be(this._callbacks[e],t)}}async play(){this._blobClipper.isPlayingAudibly?(this._blobClipper.stop(),ve("pause",this._callbacks)):this._playClipper?.isPlayingAudibly?(this._playClipper.stop(),ve("pause",this._callbacks)):this._blobClipper.isRecordingSilently?(this._playClipper=this._playClipper??new Ae(this._file,this._start,this._end,this._playbackRate,this._recorderMimeType,this._callbacks,this._trackId),this._playClipper.play(),ve("play",this._callbacks)):this._blobClipper.finishedRecording?(this._blobClipper.play(),ve("play",this._callbacks),this._playClipper=void 0):(this._blobClipper.clip(!0).then((()=>{ve("pause",this._callbacks)})).catch((e=>{e instanceof _e||console.error(e)})),ve("play",this._callbacks))}stop(){this._blobClipper.stop(),this._playClipper?.stop(),ve("pause",this._callbacks)}async blob(){return this._blobClipper.latestBlobPromise()??this._blobClipper.clip(this._recordAudibly)}slice(e,t){return new xe(this._file,e,t,this._playbackRate,this._recordAudibly,this._trackId)}isSliceable(){return!0}get error(){if(this._file.blobUrl)return g(this._file.blobUrl)?void 0:n.fileLinkLost}}class Se{constructor(e,t){this.data=e,this.workerFactory=t}get name(){return this.data.name}get extension(){return"mp3"}get start(){return this.data.start}get end(){return this.data.end}async base64(){return ye(await this.blob())}async play(){await this.data.play()}get playing(){return this.data.playing}onEvent(e,t){return this.onEvent(e,t)}stop(){this.data.stop()}async blob(){return this._blob||(this._blob=await fe.encode(await this.data.blob(),this.workerFactory)),this._blob}slice(e,t){return new Se(this.data.slice(e,t),this.workerFactory)}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}}class ke{constructor(e,t,r){this._data=e,this._encoder=t,this._extension=r}get name(){return this._data.name}get extension(){return"mp3"}get start(){return this._data.start}get end(){return this._data.end}async base64(){return ye(await this.blob())}async play(){await this._data.play()}get playing(){return this._data.playing}onEvent(e,t){return this._data.onEvent(e,t)}stop(){this._data.stop()}async blob(){return void 0===this._blob&&(this._blob=await this._encoder(await this._data.blob(),this._data.extension)),this._blob}slice(e,t){return new ke(this._data.slice(e,t),this._encoder,this._extension)}isSliceable(){return this._data.isSliceable()}get error(){return this._data.error}}class Pe{constructor(e){this.data=e}static fromCard(e,t,r,n){if(e.audio){const t=e.audio.start??e.subtitle.start,r=e.audio.end??e.subtitle.end;return Pe.fromBase64(e.subtitleFileName,Math.max(0,t-(e.audio.paddingStart??0)),r+(e.audio.paddingEnd??0),e.audio.playbackRate??1,e.audio.base64,e.audio.extension,e.audio.error)}if(e.file)return Pe.fromFile(e.file,Math.max(0,e.subtitle.start-t),e.subtitle.end+r,e.file?.playbackRate??1,n,e.file?.audioTrack)}static fromBase64(e,t,r,n,o,i,a){return new Pe(new we(e.substring(0,e.lastIndexOf(".")),t,r,n,o,i,a))}static fromFile(e,t,r,n,o,i){return new Pe(new xe(e,t,r,n,o,i))}get start(){return this.data.start}get end(){return this.data.end}get name(){return this.data.name+"."+this.data.extension}get extension(){return this.data.extension}async play(){await this.data.play()}get playing(){return this.data.playing}onEvent(e,t){return this.data.onEvent(e,t)}stop(){this.data.stop()}async base64(){return await this.data.base64()}async blob(){return await this.data.blob()}async download(){y(await this.data.blob(),this.name)}toMp3(e){return this.data instanceof Se||"mp3"===this.data.extension?this:new Pe(new Se(this.data,e))}toEncoded(e,t){return new Pe(new ke(this.data,e,t))}slice(e,t){return new Pe(this.data.slice(e,t))}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}get errorLocKey(){if(void 0!==this.data.error)switch(this.data.error){case n.drmProtected:return"audioCaptureFailed.message";case n.fileLinkLost:return"ankiDialog.audioFileLinkLost"}}}const Fe=['"',"*","_","\\",":"],Ee=e=>{const t=/(.*)\.(.*)/.exec(e);if(null===t||t.length<3)return e;const r=t[1],n=t[2];return`${r}_${(()=>{let e="";for(let t=0;t<8;++t)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e})()}.${n}`},Oe="<([^/ >])*[^>]*>(.*?)</\\1>",Re=e=>{const t=new RegExp(Oe);let r=e,n=[e];for(;;){const e=t.exec(r);if(null===e||e.length<3)break;r=e[2],n.push(r)}return n};async function Ie(e,t,r){const n=new je(t),o=(i=e.subtitleFileName,0===(a=e.mediaTimestamp)?i:`${i} (${p(a)})`);var i,a;let s=void 0===e.audio?void 0:Pe.fromBase64(o,e.subtitle.start,e.subtitle.end,e.audio.playbackRate??1,e.audio.base64,e.audio.extension,e.audio.error);return await n.export({text:e.text??f(e.subtitle,e.surroundingSubtitles),track1:f(e.subtitle,e.surroundingSubtitles,0),track2:f(e.subtitle,e.surroundingSubtitles,1),track3:f(e.subtitle,e.surroundingSubtitles,2),definition:e.definition,audioClip:s,image:void 0===e.image?void 0:A.fromBase64(o,e.subtitle.start,e.image.base64,e.image.extension,e.image.error),word:e.word,source:o,url:e.url,customFieldValues:e.customFieldValues??{},tags:t.tags,mode:r})}class je{constructor(e,t=new P){this.settingsProvider=e,this.fetcher=t}async deckNames(e){return(await this._executeAction("deckNames",null,e)).result}async modelNames(e){return(await this._executeAction("modelNames",null,e)).result}async modelFieldNames(e,t){return(await this._executeAction("modelFieldNames",{modelName:e},t)).result}async findNotesWithWord(e,t){return(await this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(e)},t)).result}async findNotesWithWordGui(e,t){return(await this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(e)},t)).result}_escapeQuery(e){let t="";for(let r=0;r<e.length;++r){const n=e[r];Fe.includes(n)?t+=`\\${n}`:t+=n}return`"${t}"`}async requestPermission(e){return(await this._executeAction("requestPermission",null,e)).result}async version(e){return(await this._executeAction("version",null,e)).result}async export({text:e,track1:t,track2:r,track3:n,definition:o,audioClip:i,image:a,word:s,source:c,url:l,customFieldValues:u,tags:d,mode:h,ankiConnectUrl:p}){const f={};if(this._appendField(f,this.settingsProvider.sentenceField,e,!0),this._appendField(f,this.settingsProvider.track1Field,t,!0),this._appendField(f,this.settingsProvider.track2Field,r,!0),this._appendField(f,this.settingsProvider.track3Field,n,!0),this._appendField(f,this.settingsProvider.definitionField,o,!0),this._appendField(f,this.settingsProvider.wordField,s,!1),this._appendField(f,this.settingsProvider.sourceField,c,!1),this._appendField(f,this.settingsProvider.urlField,l,!1),u)for(const e of Object.keys(u))this._appendField(f,this.settingsProvider.customAnkiFields[e],u[e],!0);const y={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:d,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},m="gui"===h,g="updateLast"===h;if(this.settingsProvider.audioField&&i&&void 0===i.error){const e=this._sanitizeFileName(i.name),t=await i.base64();if(t)if(m||g){const r=(await this._storeMediaFile(e,t,p)).result;this._appendField(f,this.settingsProvider.audioField,`[sound:${r}]`,!1)}else y.note.audio={filename:e,data:t,fields:[this.settingsProvider.audioField]}}if(this.settingsProvider.imageField&&a&&void 0===a.error){const e=this._sanitizeFileName(a.name),t=await a.base64();if(t)if(m||g){const r=(await this._storeMediaFile(e,t,p)).result;this._appendField(f,this.settingsProvider.imageField,`<img src="${r}">`,!1)}else y.note.picture={filename:e,data:t,fields:[this.settingsProvider.imageField]}}switch(y.note.fields=f,h){case"gui":return(await this._executeAction("guiAddCards",y,p)).result;case"updateLast":const e=(await this._executeAction("findNotes",{query:"added:1"},p)).result.sort();if(0===e.length)throw new Error("Could not find note to update");const t=e[e.length-1];y.note.id=t;const r=await this._executeAction("notesInfo",{notes:[t]});if(r.result.length>0&&r.result[0].noteId===t){const e=r.result[0];if(this._inheritHtmlMarkupFromField("sentenceField",e,y),this._inheritHtmlMarkupFromField("track1Field",e,y),this._inheritHtmlMarkupFromField("track2Field",e,y),this._inheritHtmlMarkupFromField("track3Field",e,y),await this._executeAction("updateNoteFields",y,p),d.length>0&&await this._executeAction("addTags",{notes:[t],tags:d.join(" ")},p),!this.settingsProvider.wordField||!e.fields)return e.noteId;const n=e.fields[this.settingsProvider.wordField];return n&&n.value?n.value:e.noteId}throw new Error("Could not update last card because the card info could not be fetched");case"default":return(await this._executeAction("addNote",y,p)).result;default:throw new Error("Unknown export mode: "+h)}}_appendField(e,t,r,n){if(!t||!r)return;let o=n?r.split("\n").join("<br>"):r;const i=e[t];i&&(o=i+"<br>"+o),e[t]=o}_sanitizeFileName(e){return"function"==typeof e.toWellFormed&&(e=e.toWellFormed()),h()(e,{replacement:"_"})}async _storeMediaFile(e,t,r){return this._executeAction("storeMediaFile",{filename:Ee(e),data:t,deleteExisting:!1},r)}_inheritHtmlMarkupFromField(e,t,r){const n=this.settingsProvider[e];n&&t.fields&&"string"==typeof t.fields[n]?.value&&"string"==typeof r.note.fields[n]&&(r.note.fields[n]=((e,t)=>{const r=new RegExp(Oe,"ig"),n=t.replaceAll("<br>","");let o=e;for(;;){const e=r.exec(n);if(null===e||e.length<3)break;let t=o;if(!o.includes(e[0])){const r=Re(e[2]);for(const n of r)if(t=o.replace(n,e[0]),t!==o)break}o=t}return o})(r.note.fields[n],t.fields[n].value))}async _executeAction(e,t,r){const n={action:e,version:6};t&&(n.params=t);const o=await this.fetcher.fetch(r||this.settingsProvider.ankiConnectUrl,n);if(o.error)throw new Error(o.error);return o}}const Ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Te=Object.keys,Me=Array.isArray;function De(e,t){return"object"!=typeof t||Te(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||Ce.Promise||(Ce.Promise=Promise);const Be=Object.getPrototypeOf,Ne={}.hasOwnProperty;function Ue(e,t){return Ne.call(e,t)}function $e(e,t){"function"==typeof t&&(t=t(Be(e))),("undefined"==typeof Reflect?Te:Reflect.ownKeys)(t).forEach((r=>{ze(e,r,t[r])}))}const Ke=Object.defineProperty;function ze(e,t,r,n){Ke(e,t,De(r&&Ue(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function qe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ze(e.prototype,"constructor",e),{extend:$e.bind(null,e.prototype)}}}}const Le=Object.getOwnPropertyDescriptor;function Ve(e,t){let r;return Le(e,t)||(r=Be(e))&&Ve(r,t)}const We=[].slice;function Ze(e,t,r){return We.call(e,t,r)}function He(e,t){return t(e)}function Ge(e){if(!e)throw new Error("Assertion Failed")}function Je(e){Ce.setImmediate?setImmediate(e):setTimeout(e,0)}function Qe(e,t){return e.reduce(((e,r,n)=>{var o=t(r,n);return o&&(e[o[0]]=o[1]),e}),{})}function Ye(e,t){if(Ue(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,o=t.length;n<o;++n){var i=Ye(e,t[n]);r.push(i)}return r}var a=t.indexOf(".");if(-1!==a){var s=e[t.substr(0,a)];return void 0===s?void 0:Ye(s,t.substr(a+1))}}function Xe(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){Ge("string"!=typeof r&&"length"in r);for(var n=0,o=t.length;n<o;++n)Xe(e,t[n],r[n])}else{var i=t.indexOf(".");if(-1!==i){var a=t.substr(0,i),s=t.substr(i+1);if(""===s)void 0===r?Me(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=r;else{var c=e[a];c&&Ue(e,a)||(c=e[a]={}),Xe(c,s,r)}}else void 0===r?Me(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function et(e){var t={};for(var r in e)Ue(e,r)&&(t[r]=e[r]);return t}const tt=[].concat;function rt(e){return tt.apply([],e)}const nt="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(rt([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>Ce[e])),ot=nt.map((e=>Ce[e]));Qe(nt,(e=>[e,!0]));let it=null;function at(e){it="undefined"!=typeof WeakMap&&new WeakMap;const t=st(e);return it=null,t}function st(e){if(!e||"object"!=typeof e)return e;let t=it&&it.get(e);if(t)return t;if(Me(e)){t=[],it&&it.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(st(e[r]))}else if(ot.indexOf(e.constructor)>=0)t=e;else{const r=Be(e);for(var o in t=r===Object.prototype?{}:Object.create(r),it&&it.set(e,t),e)Ue(e,o)&&(t[o]=st(e[o]))}return t}const{toString:ct}={};function lt(e){return ct.call(e).slice(8,-1)}const ut="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",dt="symbol"==typeof ut?function(e){var t;return null!=e&&(t=e[ut])&&t.apply(e)}:function(){return null},ht={};function pt(e){var t,r,n,o;if(1===arguments.length){if(Me(e))return e.slice();if(this===ht&&"string"==typeof e)return[e];if(o=dt(e)){for(r=[];!(n=o.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const ft="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var yt="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function mt(e,t){yt=e,gt=t}var gt=()=>!0;const bt=!new Error("").stack;function vt(){if(bt)try{throw vt.arguments,new Error}catch(e){return e}return new Error}function wt(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(gt).map((e=>"\n"+e)).join("")):""}var _t=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],At=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(_t),xt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function St(e,t){this._e=vt(),this.name=e,this.message=t}function kt(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,r)=>r.indexOf(e)===t)).join("\n")}function Pt(e,t,r,n){this._e=vt(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=kt(e,t)}function Ft(e,t){this._e=vt(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=kt(e,t)}qe(St).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+wt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),qe(Pt).from(St),qe(Ft).from(St);var Et=At.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Ot=St;var Rt=At.reduce(((e,t)=>{var r=t+"Error";function n(e,n){this._e=vt(),this.name=r,e?"string"==typeof e?(this.message=`${e}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=xt[t]||r,this.inner=null)}return qe(n).from(Ot),e[t]=n,e}),{});Rt.Syntax=SyntaxError,Rt.Type=TypeError,Rt.Range=RangeError;var It=_t.reduce(((e,t)=>(e[t+"Error"]=Rt[t],e)),{}),jt=At.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Rt[t]),e)),{});function Ct(){}function Tt(e){return e}function Mt(e,t){return null==e||e===Tt?t:function(r){return t(e(r))}}function Dt(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Bt(e,t){return e===Ct?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Dt(n,this.onsuccess):n),o&&(this.onerror=this.onerror?Dt(o,this.onerror):o),void 0!==i?i:r}}function Nt(e,t){return e===Ct?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Dt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Dt(n,this.onerror):n)}}function Ut(e,t){return e===Ct?t:function(r){var n=e.apply(this,arguments);De(r,n);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?Dt(o,this.onsuccess):o),i&&(this.onerror=this.onerror?Dt(i,this.onerror):i),void 0===n?void 0===a?void 0:a:De(n,a)}}function $t(e,t){return e===Ct?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Kt(e,t){return e===Ct?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return r.then((function(){return t.apply(n,i)}))}return t.apply(this,arguments)}}jt.ModifyError=Pt,jt.DexieError=St,jt.BulkError=Ft;var zt={};const[qt,Lt,Vt]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,Be(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Be(t),e]})(),Wt=Lt&&Lt.then,Zt=qt&&qt.constructor,Ht=!!Vt;var Gt=!1,Jt=Vt?()=>{Vt.then(vr)}:Ce.setImmediate?setImmediate.bind(null,vr):Ce.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{vr(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(vr,0)},Qt=function(e,t){ar.push([e,t]),Xt&&(Jt(),Xt=!1)},Yt=!0,Xt=!0,er=[],tr=[],rr=null,nr=Tt,or={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{qr(e[0],e[1])}catch(e){}}))}},ir=or,ar=[],sr=0,cr=[];function lr(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Ct,this._lib=!1;var t=this._PSD=ir;if(yt&&(this._stackHolder=vt(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==zt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&pr(this,this._value))}this._state=null,this._value=null,++t.ref,hr(this,e)}const ur={get:function(){var e=ir,t=Or;function r(r,n){var o=!e.global&&(e!==ir||t!==Or);const i=o&&!Cr();var a=new lr(((t,a)=>{yr(this,new dr(Kr(r,e,o,i),Kr(n,e,o,i),t,a,e))}));return yt&&br(a,this),a}return r.prototype=zt,r},set:function(e){ze(this,"then",e&&e.prototype===zt?ur:{get:function(){return e},set:ur.set})}};function dr(e,t,r,n,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=o}function hr(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&wr();t&&"function"==typeof t.then?hr(e,((e,r)=>{t instanceof lr?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,fr(e)),r&&_r()}}),pr.bind(null,e))}catch(t){pr(e,t)}}function pr(e,t){if(tr.push(t),null===e._state){var r=e._lib&&wr();t=nr(t),e._state=!1,e._value=t,yt&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,void 0)}catch(e){}}((()=>{var r=Ve(t,"stack");t._promise=e,ze(t,"stack",{get:()=>Gt?r&&(r.get?r.get.apply(t):r.value):e.stack})})),function(e){er.some((t=>t._value===e._value))||er.push(e)}(e),fr(e),r&&_r()}}function fr(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)yr(e,t[r]);var o=e._PSD;--o.ref||o.finalize(),0===sr&&(++sr,Qt((()=>{0==--sr&&Ar()}),[]))}function yr(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++sr,Qt(mr,[r,e,t])}else e._listeners.push(t)}function mr(e,t,r){try{rr=t;var n,o=t._value;t._state?n=e(o):(tr.length&&(tr=[]),n=e(o),-1===tr.indexOf(o)&&function(e){for(var t=er.length;t;)if(er[--t]._value===e._value)return void er.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{rr=null,0==--sr&&Ar(),--r.psd.ref||r.psd.finalize()}}function gr(e,t,r){if(t.length===r)return t;var n="";if(!1===e._state){var o,i,a=e._value;null!=a?(o=a.name||"Error",i=a.message||a,n=wt(a,0)):(o=a,i=""),t.push(o+(i?": "+i:"")+n)}return yt&&((n=wt(e._stackHolder,2))&&-1===t.indexOf(n)&&t.push(n),e._prev&&gr(e._prev,t,r)),t}function br(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function vr(){wr()&&_r()}function wr(){var e=Yt;return Yt=!1,Xt=!1,e}function _r(){var e,t,r;do{for(;ar.length>0;)for(e=ar,ar=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(ar.length>0);Yt=!0,Xt=!0}function Ar(){var e=er;er=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=cr.slice(0),r=t.length;r;)t[--r]()}function xr(e){return new lr(zt,!1,e)}function Sr(e,t){var r=ir;return function(){var n=wr(),o=ir;try{return Br(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{Br(o,!1),n&&_r()}}}$e(lr.prototype,{then:ur,_then:function(e,t){yr(this,new dr(null,null,e,t,ir))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?r(e):xr(e))):this.then(null,(e=>e&&e.name===t?r(e):xr(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),xr(t))))},stack:{get:function(){if(this._stack)return this._stack;try{Gt=!0;var e=gr(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{Gt=!1}}},timeout:function(e,t){return e<1/0?new lr(((r,n)=>{var o=setTimeout((()=>n(new Rt.Timeout(t))),e);this.then(r,n).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&ze(lr.prototype,Symbol.toStringTag,"Dexie.Promise"),or.env=Nr(),$e(lr,{all:function(){var e=pt.apply(null,arguments).map(Tr);return new lr((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach(((o,i)=>lr.resolve(o).then((r=>{e[i]=r,--n||t(e)}),r)))}))},resolve:e=>{if(e instanceof lr)return e;if(e&&"function"==typeof e.then)return new lr(((t,r)=>{e.then(t,r)}));var t=new lr(zt,!0,e);return br(t,rr),t},reject:xr,race:function(){var e=pt.apply(null,arguments).map(Tr);return new lr(((t,r)=>{e.map((e=>lr.resolve(e).then(t,r)))}))},PSD:{get:()=>ir,set:e=>ir=e},totalEchoes:{get:()=>Or},newPSD:Ir,usePSD:Ur,scheduler:{get:()=>Qt,set:e=>{Qt=e}},rejectionMapper:{get:()=>nr,set:e=>{nr=e}},follow:(e,t)=>new lr(((r,n)=>Ir(((t,r)=>{var n=ir;n.unhandleds=[],n.onunhandled=r,n.finalize=Dt((function(){!function(e){cr.push((function t(){e(),cr.splice(cr.indexOf(t),1)})),++sr,Qt((()=>{0==--sr&&Ar()}),[])}((()=>{0===this.unhandleds.length?t():r(this.unhandleds[0])}))}),n.finalize),e()}),t,r,n)))}),Zt&&(Zt.allSettled&&ze(lr,"allSettled",(function(){const e=pt.apply(null,arguments).map(Tr);return new lr((t=>{0===e.length&&t([]);let r=e.length;const n=new Array(r);e.forEach(((e,o)=>lr.resolve(e).then((e=>n[o]={status:"fulfilled",value:e}),(e=>n[o]={status:"rejected",reason:e})).then((()=>--r||t(n)))))}))})),Zt.any&&"undefined"!=typeof AggregateError&&ze(lr,"any",(function(){const e=pt.apply(null,arguments).map(Tr);return new lr(((t,r)=>{0===e.length&&r(new AggregateError([]));let n=e.length;const o=new Array(n);e.forEach(((e,i)=>lr.resolve(e).then((e=>t(e)),(e=>{o[i]=e,--n||r(new AggregateError(o))}))))}))})));const kr={awaits:0,echoes:0,id:0};var Pr=0,Fr=[],Er=0,Or=0,Rr=0;function Ir(e,t,r,n){var o=ir,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++Rr;var a=or.env;i.env=Ht?{Promise:lr,PromiseProp:{value:lr,configurable:!0,writable:!0},all:lr.all,race:lr.race,allSettled:lr.allSettled,any:lr.any,resolve:lr.resolve,reject:lr.reject,nthen:zr(a.nthen,i),gthen:zr(a.gthen,i)}:{},t&&De(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=Ur(i,e,r,n);return 0===i.ref&&i.finalize(),s}function jr(){return kr.id||(kr.id=++Pr),++kr.awaits,kr.echoes+=100,kr.id}function Cr(){return!!kr.awaits&&(0==--kr.awaits&&(kr.id=0),kr.echoes=100*kr.awaits,!0)}function Tr(e){return kr.echoes&&e&&e.constructor===Zt?(jr(),e.then((e=>(Cr(),e)),(e=>(Cr(),Lr(e))))):e}function Mr(e){++Or,kr.echoes&&0!=--kr.echoes||(kr.echoes=kr.id=0),Fr.push(ir),Br(e,!0)}function Dr(){var e=Fr[Fr.length-1];Fr.pop(),Br(e,!1)}function Br(e,t){var r=ir;if((t?!kr.echoes||Er++&&e===ir:!Er||--Er&&e===ir)||$r(t?Mr.bind(null,e):Dr),e!==ir&&(ir=e,r===or&&(or.env=Nr()),Ht)){var n=or.env.Promise,o=e.env;Lt.then=o.nthen,n.prototype.then=o.gthen,(r.global||e.global)&&(Object.defineProperty(Ce,"Promise",o.PromiseProp),n.all=o.all,n.race=o.race,n.resolve=o.resolve,n.reject=o.reject,o.allSettled&&(n.allSettled=o.allSettled),o.any&&(n.any=o.any))}}function Nr(){var e=Ce.Promise;return Ht?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(Ce,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Lt.then,gthen:e.prototype.then}:{}}function Ur(e,t,r,n,o){var i=ir;try{return Br(e,!0),t(r,n,o)}finally{Br(i,!1)}}function $r(e){Wt.call(qt,e)}function Kr(e,t,r,n){return"function"!=typeof e?e:function(){var o=ir;r&&jr(),Br(t,!0);try{return e.apply(this,arguments)}finally{Br(o,!1),n&&$r(Cr)}}}function zr(e,t){return function(r,n){return e.call(this,Kr(r,t),Kr(n,t))}}function qr(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,o={promise:t,reason:e};if(Ce.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),De(n,o)):Ce.CustomEvent&&De(n=new CustomEvent("unhandledrejection",{detail:o}),o),n&&Ce.dispatchEvent&&(dispatchEvent(n),!Ce.PromiseRejectionEvent&&Ce.onunhandledrejection))try{Ce.onunhandledrejection(n)}catch(e){}yt&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+Wt).indexOf("[native code]")&&(jr=Cr=Ct);var Lr=lr.reject;function Vr(e,t,r,n){if(e.idbdb&&(e._state.openComplete||ir.letThrough||e._vip)){var o=e._createTransaction(t,r,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===Et.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Vr(e,t,r,n)))):Lr(o)}return o._promise(t,((e,t)=>Ir((()=>(ir.trans=o,n(e,t,o)))))).then((e=>o._completion.then((()=>e))))}if(e._state.openComplete)return Lr(new Rt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Lr(new Rt.DatabaseClosed);e.open().catch(Ct)}return e._state.dbReadyPromise.then((()=>Vr(e,t,r,n)))}const Wr=String.fromCharCode(65535),Zr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Hr=[],Gr="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Jr=Gr,Qr=Gr,Yr=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Xr(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const en={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tn(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=at(t))[e],t)}class rn{_trans(e,t,r){const n=this._tx||ir.trans,o=this.name;function i(e,r,n){if(!n.schema[o])throw new Rt.NotFound("Table "+o+" not part of transaction");return t(n.idbtrans,n)}const a=wr();try{return n&&n.db===this.db?n===ir.trans?n._promise(e,i,r):Ir((()=>n._promise(e,i,r)),{trans:n,transless:ir.transless||ir}):Vr(this.db,e,[this.name],i)}finally{a&&_r()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(Me(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=Te(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(r&&this.db._maxKey!==Wr)return this.where(r.name).equals(r.keyPath.map((t=>e[t])));!r&&yt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:n}=this.schema,o=this.db._deps.indexedDB;function i(e,t){try{return 0===o.cmp(e,t)}catch(e){return!1}}const[a,s]=t.reduce((([t,r],o)=>{const a=n[o],s=e[o];return[t||a,t||!a?Xr(r,a&&a.multi?e=>{const t=Ye(e,o);return Me(t)&&t.some((e=>i(s,e)))}:e=>i(s,Ye(e,o))):r]}),[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(s):r?this.filter(s):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Me(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const r=Object.create(e.prototype);for(var n in t)if(Ue(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){De(this,e)}))}add(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let o=e;return n&&r&&(o=tn(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[o]}))).then((e=>e.numFailures?lr.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{Xe(e,n,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||Me(e))return this.where(":id").equals(e).modify(t);{const r=Ye(e,this.schema.primKey.keyPath);if(void 0===r)return Lr(new Rt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?Te(t).forEach((r=>{Xe(e,r,t[r])})):t(e,{value:e,primKey:r})}catch(e){}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let o=e;return n&&r&&(o=tn(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[o],keys:null!=t?[t]:null}))).then((e=>e.numFailures?lr.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{Xe(e,n,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?lr.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:en}))).then((e=>e.numFailures?lr.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,r){const n=Array.isArray(t)?t:void 0,o=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:i}=this.schema.primKey;if(i&&n)throw new Rt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new Rt.InvalidArgument("Arguments objects and keys must have the same length");const a=e.length;let s=i&&r?e.map(tn(i)):e;return this.core.mutate({trans:t,type:"add",keys:n,values:s,wantResults:o}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return o?t:r;throw new Ft(`${this.name}.bulkAdd(): ${e} of ${a} operations failed`,n)}))}))}bulkPut(e,t,r){const n=Array.isArray(t)?t:void 0,o=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:i}=this.schema.primKey;if(i&&n)throw new Rt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new Rt.InvalidArgument("Arguments objects and keys must have the same length");const a=e.length;let s=i&&r?e.map(tn(i)):e;return this.core.mutate({trans:t,type:"put",keys:n,values:s,wantResults:o}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return o?t:r;throw new Ft(`${this.name}.bulkPut(): ${e} of ${a} operations failed`,n)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:r,failures:n})=>{if(0===e)return r;throw new Ft(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,n)}))}}function nn(e){var t={},r=function(r,n){if(n){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[r].subscribe.apply(null,i),e}if("string"==typeof r)return t[r]};r.addEventType=i;for(var n=1,o=arguments.length;n<o;++n)i(arguments[n]);return r;function i(e,n,o){if("object"==typeof e)return a(e);n||(n=$t),o||(o=Ct);var i={subscribers:[],fire:o,subscribe:function(e){-1===i.subscribers.indexOf(e)&&(i.subscribers.push(e),i.fire=n(i.fire,e))},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e})),i.fire=i.subscribers.reduce(n,o)}};return t[e]=r[e]=i,i}function a(e){Te(e).forEach((function(t){var r=e[t];if(Me(r))i(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new Rt.InvalidArgument("Invalid event config");var n=i(t,Tt,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){Je((function(){e.apply(null,t)}))}))}))}}))}}function on(e,t){return qe(t).from({prototype:e}),t}function an(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function sn(e,t){e.filter=Xr(e.filter,t)}function cn(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>Xr(n(),t()):t,e.justLimit=r&&!n}function ln(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new Rt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function un(e,t,r){const n=ln(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function dn(e,t,r,n){const o=e.replayFilter?Xr(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},a=(e,r,n)=>{if(!o||o(r,n,(e=>r.stop(e)),(e=>r.fail(e)))){var a=r.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),Ue(i,s)||(i[s]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(a,r),hn(un(e,n,r),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return hn(un(e,n,r),Xr(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function hn(e,t,r,n){var o=Sr(n?(e,t,o)=>r(n(e),t,o):r);return e.then((e=>{if(e)return e.start((()=>{var r=()=>e.continue();t&&!t(e,(e=>r=e),(t=>{e.stop(t),r=Ct}),(t=>{e.fail(t),r=Ct}))||o(e.value,e,(e=>r=e)),r()}))}))}function pn(e,t){try{const r=fn(e),n=fn(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const r=e.length,n=t.length,o=r<n?r:n;for(let r=0;r<o;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return r===n?0:r<n?-1:1}(yn(e),yn(t));case"Array":return function(e,t){const r=e.length,n=t.length,o=r<n?r:n;for(let r=0;r<o;++r){const n=pn(e[r],t[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(e,t)}}catch(e){}return NaN}function fn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const r=lt(e);return"ArrayBuffer"===r?"binary":r}function yn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class mn{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Lr.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Lr.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Xr(t.algorithm,e)}_iterate(e,t){return dn(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&De(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((r=>dn(t,e,r,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,r=t.table.core;if(an(t,!0))return r.count({trans:e,query:{index:ln(t,r.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var n=0;return dn(t,(()=>(++n,!1)),e,r).then((()=>n))})).then(e)}sortBy(e,t){const r=e.split(".").reverse(),n=r[0],o=r.length-1;function i(e,t){return t?i(e[r[t]],t-1):e[n]}var a="next"===this._ctx.dir?1:-1;function s(e,t){var r=i(e,o),n=i(t,o);return r<n?-a:r>n?a:0}return this.toArray((function(e){return e.sort(s)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&an(t,!0)&&t.limit>0){const{valueMapper:r}=t,n=ln(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:n,range:t.range}}).then((({result:e})=>r?e.map(r):e))}{const r=[];return dn(t,(e=>r.push(e)),e,t.table.core).then((()=>r))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,an(t)?cn(t,(()=>{var t=e;return(e,r)=>0===t||(1===t?(--t,!1):(r((()=>{e.advance(t),t=0})),!1))})):cn(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),cn(this._ctx,(()=>{var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this}until(e,t){return sn(this._ctx,(function(r,n,o){return!e(r.value)||(n(o),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return sn(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=Xr(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&an(t,!0)&&t.limit>0)return this._read((e=>{var r=ln(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return sn(this._ctx,(function(e){var t=e.primaryKey.toString(),n=Ue(r,t);return r[t]=!0,!n})),this}modify(e){var t=this._ctx;return this._write((r=>{var n;if("function"==typeof e)n=e;else{var o=Te(e),i=o.length;n=function(t){for(var r=!1,n=0;n<i;++n){var a=o[n],s=e[a];Ye(t,a)!==s&&(Xe(t,a,s),r=!0)}return r}}const a=t.table.core,{outbound:s,extractKey:c}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,u=[];let d=0;const h=[],p=(e,t)=>{const{failures:r,numFailures:n}=t;d+=e-n;for(let e of Te(r))u.push(r[e])};return this.clone().primaryKeys().then((o=>{const i=u=>{const d=Math.min(l,o.length-u);return a.getMany({trans:r,keys:o.slice(u,u+d),cache:"immutable"}).then((h=>{const f=[],y=[],m=s?[]:null,g=[];for(let e=0;e<d;++e){const t=h[e],r={value:at(t),primKey:o[u+e]};!1!==n.call(r,r.value,r)&&(null==r.value?g.push(o[u+e]):s||0===pn(c(t),c(r.value))?(y.push(r.value),s&&m.push(o[u+e])):(g.push(o[u+e]),f.push(r.value)))}const b=an(t)&&t.limit===1/0&&("function"!=typeof e||e===gn)&&{index:t.index,range:t.range};return Promise.resolve(f.length>0&&a.mutate({trans:r,type:"add",values:f}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);p(f.length,e)}))).then((()=>(y.length>0||b&&"object"==typeof e)&&a.mutate({trans:r,type:"put",keys:m,values:y,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>p(y.length,e))))).then((()=>(g.length>0||b&&e===gn)&&a.mutate({trans:r,type:"delete",keys:g,criteria:b}).then((e=>p(g.length,e))))).then((()=>o.length>u+d&&i(u+l)))}))};return i(0).then((()=>{if(u.length>0)throw new Pt("Error modifying one or more objects",u,d,h);return o.length}))}))}))}delete(){var e=this._ctx,t=e.range;return an(e)&&(e.isPrimKey&&!Qr||3===t.type)?this._write((r=>{const{primaryKey:n}=e.table.core.schema,o=t;return e.table.core.count({trans:r,query:{index:n,range:o}}).then((t=>e.table.core.mutate({trans:r,type:"deleteRange",range:o}).then((({failures:e,lastResult:r,results:n,numFailures:o})=>{if(o)throw new Pt("Could not delete some values",Object.keys(e).map((t=>e[t])),t-o);return t-o}))))})):this.modify(gn)}}const gn=(e,t)=>t.value=null;function bn(e,t){return e<t?-1:e===t?0:1}function vn(e,t){return e>t?-1:e===t?0:1}function wn(e,t,r){var n=e instanceof Pn?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function _n(e){return new e.Collection(e,(()=>kn(""))).limit(0)}function An(e,t,r,n,o,i){for(var a=Math.min(e.length,n.length),s=-1,c=0;c<a;++c){var l=t[c];if(l!==n[c])return o(e[c],r[c])<0?e.substr(0,c)+r[c]+r.substr(c+1):o(e[c],n[c])<0?e.substr(0,c)+n[c]+r.substr(c+1):s>=0?e.substr(0,s)+t[s]+r.substr(s+1):null;o(e[c],l)<0&&(s=c)}return a<n.length&&"next"===i?e+r.substr(e.length):a<e.length&&"prev"===i?e.substr(0,r.length):s<0?null:e.substr(0,s)+n[s]+r.substr(s+1)}function xn(e,t,r,n){var o,i,a,s,c,l,u,d=r.length;if(!r.every((e=>"string"==typeof e)))return wn(e,"String expected.");function h(e){o=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),a="next"===e?bn:vn;var t=r.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));s=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),l=e,u="next"===e?"":n}h("next");var p=new e.Collection(e,(()=>Sn(s[0],c[d-1]+n)));p._ondirectionchange=function(e){h(e)};var f=0;return p._addAlgorithm((function(e,r,n){var o=e.key;if("string"!=typeof o)return!1;var h=i(o);if(t(h,c,f))return!0;for(var p=null,y=f;y<d;++y){var m=An(o,h,s[y],c[y],a,l);null===m&&null===p?f=y+1:(null===p||a(p,m)>0)&&(p=m)}return r(null!==p?function(){e.continue(p+u)}:n),!1})),p}function Sn(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function kn(e){return{type:1,lower:e,upper:e}}class Pn{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?_n(this):new this.Collection(this,(()=>Sn(e,t,!r,!n)))}catch(e){return wn(this,Zr)}}equals(e){return null==e?wn(this,Zr):new this.Collection(this,(()=>kn(e)))}above(e){return null==e?wn(this,Zr):new this.Collection(this,(()=>Sn(e,void 0,!0)))}aboveOrEqual(e){return null==e?wn(this,Zr):new this.Collection(this,(()=>Sn(e,void 0,!1)))}below(e){return null==e?wn(this,Zr):new this.Collection(this,(()=>Sn(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?wn(this,Zr):new this.Collection(this,(()=>Sn(void 0,e)))}startsWith(e){return"string"!=typeof e?wn(this,"String expected."):this.between(e,e+Wr,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):xn(this,((e,t)=>0===e.indexOf(t[0])),[e],Wr)}equalsIgnoreCase(e){return xn(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=pt.apply(ht,arguments);return 0===e.length?_n(this):xn(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=pt.apply(ht,arguments);return 0===e.length?_n(this):xn(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,Wr)}anyOf(){const e=pt.apply(ht,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return wn(this,Zr)}if(0===e.length)return _n(this);const r=new this.Collection(this,(()=>Sn(e[0],e[e.length-1])));r._ondirectionchange=r=>{t="next"===r?this._ascending:this._descending,e.sort(t)};let n=0;return r._addAlgorithm(((r,o,i)=>{const a=r.key;for(;t(a,e[n])>0;)if(++n,n===e.length)return o(i),!1;return 0===t(a,e[n])||(o((()=>{r.continue(e[n])})),!1)})),r}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=pt.apply(ht,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return wn(this,Zr)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,n=this._ascending,o=this._descending,i=this._min,a=this._max;if(0===e.length)return _n(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&n(e[0],e[1])<=0)))return wn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Rt.InvalidArgument);const s=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let l,u=n;function d(e,t){return u(e[0],t[0])}try{l=e.reduce((function(e,t){let n=0,o=e.length;for(;n<o;++n){const o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=i(o[0],t[0]),o[1]=a(o[1],t[1]);break}}return n===o&&e.push(t),e}),[]),l.sort(d)}catch(e){return wn(this,Zr)}let h=0;const p=c?e=>n(e,l[h][1])>0:e=>n(e,l[h][1])>=0,f=s?e=>o(e,l[h][0])>0:e=>o(e,l[h][0])>=0;let y=p;const m=new this.Collection(this,(()=>Sn(l[0][0],l[l.length-1][1],!s,!c)));return m._ondirectionchange=e=>{"next"===e?(y=p,u=n):(y=f,u=o),l.sort(d)},m._addAlgorithm(((e,t,r)=>{for(var o=e.key;y(o);)if(++h,h===l.length)return t(r),!1;return!!function(e){return!p(e)&&!f(e)}(o)||(0===this._cmp(o,l[h][1])||0===this._cmp(o,l[h][0])||t((()=>{u===n?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),m}startsWithAnyOf(){const e=pt.apply(ht,arguments);return e.every((e=>"string"==typeof e))?0===e.length?_n(this):this.inAnyRange(e.map((e=>[e,e+Wr]))):wn(this,"startsWithAnyOf() only works with strings")}}function Fn(e){return Sr((function(t){return En(t),e(t.target.error),!1}))}function En(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const On=nn(null,"storagemutated");class Rn{_lock(){return Ge(!ir.global),++this._reculock,1!==this._reculock||ir.global||(ir.lockOwnerFor=this),this}_unlock(){if(Ge(!ir.global),0==--this._reculock)for(ir.global||(ir.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ur(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&ir.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(Ge(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new Rt.DatabaseClosed(r);case"MissingAPIError":throw new Rt.MissingAPI(r.message,r);default:throw new Rt.OpenFailed(r)}if(!this.active)throw new Rt.TransactionInactive;return Ge(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Sr((t=>{En(t),this._reject(e.error)})),e.onabort=Sr((t=>{En(t),this.active&&this._reject(new Rt.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Sr((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&On.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,r){if("readwrite"===e&&"readwrite"!==this.mode)return Lr(new Rt.ReadOnly("Transaction is readonly"));if(!this.active)return Lr(new Rt.TransactionInactive);if(this._locked())return new lr(((n,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(n,o)},ir])}));if(r)return Ir((()=>{var e=new lr(((e,r)=>{this._lock();const n=t(e,r,this);n&&n.then&&n.then(e,r)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var n=new lr(((e,r)=>{var n=t(e,r,this);n&&n.then&&n.then(e,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=lr.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>r));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new lr(((e,n)=>{r.then((r=>t._waitingQueue.push(Sr(e.bind(null,r)))),(e=>t._waitingQueue.push(Sr(n.bind(null,e))))).finally((()=>{t._waitingFor===o&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Rt.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(Ue(t,e))return t[e];const r=this.schema[e];if(!r)throw new Rt.NotFound("Table "+e+" not part of transaction");const n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n}}function In(e,t,r,n,o,i,a){return{name:e,keyPath:t,unique:r,multi:n,auto:o,compound:i,src:(r&&!a?"&":"")+(n?"*":"")+(o?"++":"")+jn(t)}}function jn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Cn(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Qe(r,(e=>[e.name,e]))}}let Tn=e=>{try{return e.only([[]]),Tn=()=>[[]],[[]]}catch(e){return Tn=()=>Wr,Wr}};function Mn(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>Ye(t,e)}(e):t=>Ye(t,e)}function Dn(e){return[].slice.call(e)}let Bn=0;function Nn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function Un(e,t,r){function n(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:o,upperOpen:i}=e;return void 0===r?void 0===n?null:t.upperBound(n,!!i):void 0===n?t.lowerBound(r,!!o):t.bound(r,n,!!o,!!i)}const{schema:o,hasGetAll:i}=function(e,t){const r=Dn(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:r}=e,n=Me(t),o=null==t,i={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:Mn(t)},indexes:Dn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:r,multiEntry:n,keyPath:o}=e,a={name:t,compound:Me(o),keyPath:o,unique:r,multiEntry:n,extractKey:Mn(o)};return i[Nn(o)]=a,a})),getIndexByKeyPath:e=>i[Nn(e)]};return i[":id"]=a.primaryKey,null!=t&&(i[Nn(t)]=a.primaryKey),a}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),a=o.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:r,keys:o,values:i,range:a}){return new Promise(((s,c)=>{s=Sr(s);const l=e.objectStore(t),u=null==l.keyPath,d="put"===r||"add"===r;if(!d&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:h}=o||i||{length:1};if(o&&i&&o.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return s({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const f=[],y=[];let m=0;const g=e=>{++m,En(e)};if("deleteRange"===r){if(4===a.type)return s({numFailures:m,failures:y,results:[],lastResult:void 0});3===a.type?f.push(p=l.clear()):f.push(p=l.delete(n(a)))}else{const[e,t]=d?u?[i,o]:[i,null]:[o,null];if(d)for(let n=0;n<h;++n)f.push(p=t&&void 0!==t[n]?l[r](e[n],t[n]):l[r](e[n])),p.onerror=g;else for(let t=0;t<h;++t)f.push(p=l[r](e[t])),p.onerror=g}const b=e=>{const t=e.target.result;f.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),s({numFailures:m,failures:y,results:"delete"===r?o:f.map((e=>e.result)),lastResult:t})};p.onerror=e=>{g(e),b(e)},p.onsuccess=b}))},getMany:({trans:e,keys:r})=>new Promise(((n,o)=>{n=Sr(n);const i=e.objectStore(t),a=r.length,s=new Array(a);let c,l=0,u=0;const d=e=>{const t=e.target;s[t._pos]=t.result,++u===l&&n(s)},h=Fn(o);for(let e=0;e<a;++e)null!=r[e]&&(c=i.get(r[e]),c._pos=e,c.onsuccess=d,c.onerror=h,++l);0===l&&n(s)})),get:({trans:e,key:r})=>new Promise(((n,o)=>{n=Sr(n);const i=e.objectStore(t).get(r);i.onsuccess=e=>n(e.target.result),i.onerror=Fn(o)})),query:function(e){return r=>new Promise(((o,i)=>{o=Sr(o);const{trans:a,values:s,limit:c,query:l}=r,u=c===1/0?void 0:c,{index:d,range:h}=l,p=a.objectStore(t),f=d.isPrimaryKey?p:p.index(d.name),y=n(h);if(0===c)return o({result:[]});if(e){const e=s?f.getAll(y,u):f.getAllKeys(y,u);e.onsuccess=e=>o({result:e.target.result}),e.onerror=Fn(i)}else{let e=0;const t=s||!("openKeyCursor"in f)?f.openCursor(y):f.openKeyCursor(y),r=[];t.onsuccess=n=>{const i=t.result;return i?(r.push(s?i.value:i.primaryKey),++e===c?o({result:r}):void i.continue()):o({result:r})},t.onerror=Fn(i)}}))}(i),openCursor:function({trans:e,values:r,query:o,reverse:i,unique:a}){return new Promise(((s,c)=>{s=Sr(s);const{index:l,range:u}=o,d=e.objectStore(t),h=l.isPrimaryKey?d:d.index(l.name),p=i?a?"prevunique":"prev":a?"nextunique":"next",f=r||!("openKeyCursor"in h)?h.openCursor(n(u),p):h.openKeyCursor(n(u),p);f.onerror=Fn(c),f.onsuccess=Sr((t=>{const r=f.result;if(!r)return void s(null);r.___id=++Bn,r.done=!1;const n=r.continue.bind(r);let o=r.continuePrimaryKey;o&&(o=o.bind(r));const i=r.advance.bind(r),a=()=>{throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=Sr(c),r.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},r.start=e=>{const t=new Promise(((e,t)=>{e=Sr(e),f.onerror=Fn(t),r.fail=t,r.stop=t=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=a,e(t)}})),s=()=>{if(f.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return f.onsuccess=Sr((e=>{f.onsuccess=s,s()})),r.continue=n,r.continuePrimaryKey=o,r.advance=i,s(),t},s(r)}),c)}))},count({query:e,trans:r}){const{index:o,range:i}=e;return new Promise(((e,a)=>{const s=r.objectStore(t),c=o.isPrimaryKey?s:s.index(o.name),l=n(i),u=l?c.count(l):c.count();u.onsuccess=Sr((t=>e(t.target.result))),u.onerror=Fn(a)}))}}}(e))),s={};return a.forEach((e=>s[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!s[e])throw new Error(`Table '${e}' not found`);return s[e]},MIN_KEY:-1/0,MAX_KEY:Tn(t),schema:o}}function $n({_novip:e},t){const r=t.db,n=function(e,t,{IDBKeyRange:r,indexedDB:n},o){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(Un(t,r,o),e.dbcore);return{dbcore:i}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach((t=>{const r=t.name;e.core.schema.tables.some((e=>e.name===r))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function Kn({_novip:e},t,r,n){r.forEach((r=>{const o=n[r];t.forEach((t=>{const n=Ve(t,r);(!n||"value"in n&&void 0===n.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?ze(t,r,{get(){return this.table(r)},set(e){Ke(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,o))}))}))}function zn({_novip:e},t){t.forEach((t=>{for(let r in t)t[r]instanceof e.Table&&delete t[r]}))}function qn(e,t){return e._cfg.version-t._cfg.version}function Ln(e,t,r,n){const o=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,o);i.create(r),i._completion.catch(n);const a=i._reject.bind(i),s=ir.transless||ir;Ir((()=>{ir.trans=i,ir.transless=s,0===t?(Te(o).forEach((e=>{Wn(r,e,o[e].primKey,o[e].indexes)})),$n(e,r),lr.follow((()=>e.on.populate.fire(i))).catch(a)):function({_novip:e},t,r,n){const o=[],i=e._versions;let a=e._dbSchema=Hn(0,e.idbdb,n),s=!1;return i.filter((e=>e._cfg.version>=t)).forEach((i=>{o.push((()=>{const o=a,c=i._cfg.dbschema;Gn(e,o,n),Gn(e,c,n),a=e._dbSchema=c;const l=Vn(o,c);l.add.forEach((e=>{Wn(n,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((e=>{if(e.recreate)throw new Rt.Upgrade("Not yet support for changing primary key");{const t=n.objectStore(e.name);e.add.forEach((e=>Zn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Zn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const u=i._cfg.contentUpgrade;if(u&&i._cfg.version>t){$n(e,n),r._memoizedTables={},s=!0;let t=et(c);l.del.forEach((e=>{t[e]=o[e]})),zn(e,[e.Transaction.prototype]),Kn(e,[e.Transaction.prototype],Te(t),t),r.schema=t;const i=ft(u);let a;i&&jr();const d=lr.follow((()=>{if(a=u(r),a&&i){var e=Cr.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?lr.resolve(a):d.then((()=>a))}})),o.push((t=>{s&&Jr||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((r=>null==e[r]&&t.db.deleteObjectStore(r)))}(i._cfg.dbschema,t),zn(e,[e.Transaction.prototype]),Kn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),function e(){return o.length?lr.resolve(o.shift()(r.idbtrans)).then(e):lr.resolve()}().then((()=>{var e,t;t=n,Te(e=a).forEach((r=>{t.db.objectStoreNames.contains(r)||Wn(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,i,r).catch(a)}))}function Vn(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const o=e[n],i=t[n];if(o){const e={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto&&!Gr)e.recreate=!0,r.change.push(e);else{const t=o.idxByName,n=i.idxByName;let a;for(a in t)n[a]||e.del.push(a);for(a in n){const r=t[a],o=n[a];r?r.src!==o.src&&e.change.push(o):e.add.push(o)}(e.del.length>0||e.add.length>0||e.change.length>0)&&r.change.push(e)}}else r.add.push([n,i])}return r}function Wn(e,t,r,n){const o=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((e=>Zn(o,e))),o}function Zn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Hn(e,t,r){const n={};return Ze(t.objectStoreNames,0).forEach((e=>{const t=r.objectStore(e);let o=t.keyPath;const i=In(jn(o),o||"",!1,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),a=[];for(let e=0;e<t.indexNames.length;++e){const r=t.index(t.indexNames[e]);o=r.keyPath;var s=In(r.name,o,!!r.unique,!!r.multiEntry,!1,o&&"string"!=typeof o,!1);a.push(s)}n[e]=Cn(e,i,a)})),n}function Gn({_novip:e},t,r){const n=r.db.objectStoreNames;for(let o=0;o<n.length;++o){const i=n[o],a=r.objectStore(i);e._hasGetAll="getAll"in a;for(let e=0;e<a.indexNames.length;++e){const r=a.indexNames[e],n=a.index(r).keyPath,o="string"==typeof n?n:"["+Ze(n).join("+")+"]";if(t[i]){const e=t[i].idxByName[o];e&&(e.name=r,delete t[i].idxByName[o],t[i].idxByName[r]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Ce.WorkerGlobalScope&&Ce instanceof Ce.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Jn{_parseStoresSpec(e,t){Te(e).forEach((r=>{if(null!==e[r]){var n=e[r].split(",").map(((e,t)=>{const r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return In(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Me(n),0===t)})),o=n.shift();if(o.multi)throw new Rt.Schema("Primary key cannot be multi-valued");n.forEach((e=>{if(e.auto)throw new Rt.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Rt.Schema("Index must have a name and cannot be an empty string")})),t[r]=Cn(r,o,n)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?De(this._cfg.storesSource,e):e;const r=t._versions,n={};let o={};return r.forEach((e=>{De(n,e._cfg.storesSource),o=e._cfg.dbschema={},e._parseStoresSpec(n,o)})),t._dbSchema=o,zn(t,[t._allTables,t,t.Transaction.prototype]),Kn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Te(o),o),t._storeNames=Te(o),this}upgrade(e){return this._cfg.contentUpgrade=Kt(this._cfg.contentUpgrade||Ct,e),this}}function Qn(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new vo("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Yn(e){return e&&"function"==typeof e.databases}function Xn(e){return Ir((function(){return ir.letThrough=!0,e()}))}function eo(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function to(e){var t=t=>e.next(t),r=o(t),n=o((t=>e.throw(t)));function o(e){return t=>{var o=e(t),i=o.value;return o.done?i:i&&"function"==typeof i.then?i.then(r,n):Me(i)?Promise.all(i).then(r,n):r(i)}}return o(t)()}function ro(e,t,r){var n=arguments.length;if(n<2)throw new Rt.InvalidArgument("Too few arguments");for(var o=new Array(n-1);--n;)o[n-1]=arguments[n];return r=o.pop(),[e,rt(o),r]}function no(e,t,r,n,o){return lr.resolve().then((()=>{const i=ir.transless||ir,a=e._createTransaction(t,r,e._dbSchema,n),s={trans:a,transless:i};if(n)a.idbtrans=n.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(n){return n.name===Et.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>no(e,t,r,null,o)))):Lr(n)}const c=ft(o);let l;c&&jr();const u=lr.follow((()=>{if(l=o.call(a,a),l)if(c){var e=Cr.bind(null,null);l.then(e,e)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=to(l))}),s);return(l&&"function"==typeof l.then?lr.resolve(l).then((e=>a.active?e:Lr(new Rt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>l))).then((e=>(n&&a._resolve(),a._completion.then((()=>e))))).catch((e=>(a._reject(e),Lr(e))))}))}function oo(e,t,r){const n=Me(e)?e.slice():[e];for(let e=0;e<r;++e)n.push(t);return n}const io={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,o={},i=[];function a(e,t,r){const n=Nn(e),s=o[n]=o[n]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,u={...r,isVirtual:l,keyTail:t,keyLength:c,extractKey:Mn(e),unique:!l&&r.unique};return s.push(u),u.isPrimaryKey||i.push(u),c>1&&a(2===c?e[0]:e.slice(0,c-1),t+1,r),s.sort(((e,t)=>e.keyTail-t.keyTail)),u}const s=a(n.primaryKey.keyPath,0,n.primaryKey);o[":id"]=[s];for(const e of n.indexes)a(e.keyPath,0,e);function c(t){const r=t.query.index;return r.isVirtual?{...t,query:{index:r,range:(n=t.query.range,o=r.keyTail,{type:1===n.type?2:n.type,lower:oo(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,o),lowerOpen:!0,upper:oo(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,o),upperOpen:!0})}}:t;var n,o}const l={...r,schema:{...n,primaryKey:s,indexes:i,getIndexByKeyPath:function(e){const t=o[Nn(e)];return t&&t[0]}},count:e=>r.count(c(e)),query:e=>r.query(c(e)),openCursor(t){const{keyTail:n,isVirtual:o,keyLength:i}=t.query.index;return o?r.openCursor(c(t)).then((r=>r&&function(r){const o=Object.create(r,{continue:{value:function(o){null!=o?r.continue(oo(o,t.reverse?e.MAX_KEY:e.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(t,o){r.continuePrimaryKey(oo(t,e.MAX_KEY,n),o)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const e=r.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>r.value}});return o}(r))):r.openCursor(t)}};return l}}}};function ao(e,t,r,n){return r=r||{},n=n||"",Te(e).forEach((o=>{if(Ue(t,o)){var i=e[o],a=t[o];if("object"==typeof i&&"object"==typeof a&&i&&a){const e=lt(i);e!==lt(a)?r[n+o]=t[o]:"Object"===e?ao(i,a,r,n+o+"."):i!==a&&(r[n+o]=t[o])}else i!==a&&(r[n+o]=t[o])}else r[n+o]=void 0})),Te(t).forEach((o=>{Ue(e,o)||(r[n+o]=t[o])})),r}const so={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema,o={...r,mutate(e){const o=ir.trans,{deleting:i,creating:a,updating:s}=o.table(t).hook;switch(e.type){case"add":if(a.fire===Ct)break;return o._promise("readwrite",(()=>c(e)),!0);case"put":if(a.fire===Ct&&s.fire===Ct)break;return o._promise("readwrite",(()=>c(e)),!0);case"delete":if(i.fire===Ct)break;return o._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(i.fire===Ct)break;return o._promise("readwrite",(()=>function(e){return l(e.trans,e.range,1e4)}(e)),!0)}return r.mutate(e);function c(e){const t=ir.trans,o=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(n,e);if(!o)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:o}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,r){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,e,o).then((c=>{const l=o.map(((r,o)=>{const l=c[o],u={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(u,r,l,t);else if("add"===e.type||void 0===l){const i=a.fire.call(u,r,e.values[o],t);null==r&&null!=i&&(r=i,e.keys[o]=r,n.outbound||Xe(e.values[o],n.keyPath,r))}else{const n=ao(l,e.values[o]),i=s.fire.call(u,n,r,l,t);if(i){const t=e.values[o];Object.keys(i).forEach((e=>{Ue(t,e)?t[e]=i[e]:Xe(t,e,i[e])}))}}return u}));return r.mutate(e).then((({failures:t,results:r,numFailures:n,lastResult:i})=>{for(let n=0;n<o.length;++n){const i=r?r[n]:o[n],a=l[n];null==i?a.onerror&&a.onerror(t[n]):a.onsuccess&&a.onsuccess("put"===e.type&&c[n]?e.values[n]:i)}return{failures:t,results:r,numFailures:n,lastResult:i}})).catch((e=>(l.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function l(e,t,o){return r.query({trans:e,values:!1,query:{index:n,range:t},limit:o}).then((({result:r})=>c({type:"delete",keys:r,trans:e}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<o?{failures:[],numFailures:0,lastResult:void 0}:l(e,{...t,lower:r[r.length-1],lowerOpen:!0},o)))))}}};return o}})};function co(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;const n=[];for(let o=0,i=0;o<t.keys.length&&i<e.length;++o)0===pn(t.keys[o],e[i])&&(n.push(r?at(t.values[o]):t.values[o]),++i);return n.length===e.length?n:null}catch(e){return null}}const lo={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:e=>{if(!e.cache)return r.getMany(e);const t=co(e.keys,e.trans._cache,"clone"===e.cache);return t?lr.resolve(t):r.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?at(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),r.mutate(e))}}})};function uo(e){return!("from"in e)}const ho=function(e,t){if(!this){const t=new ho;return e&&"d"in e&&De(t,e),t}De(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function po(e,t,r){const n=pn(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(uo(e))return De(e,{from:t,to:r,d:1});const o=e.l,i=e.r;if(pn(r,e.from)<0)return o?po(o,t,r):e.l={from:t,to:r,d:1,l:null,r:null},mo(e);if(pn(t,e.to)>0)return i?po(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},mo(e);pn(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),pn(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const a=!e.r;o&&!e.l&&fo(e,o),i&&a&&fo(e,i)}function fo(e,t){uo(t)||function e(t,{from:r,to:n,l:o,r:i}){po(t,r,n),o&&e(t,o),i&&e(t,i)}(e,t)}function yo(e){let t=uo(e)?null:{s:0,n:e};return{next(e){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&pn(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||pn(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function mo(e){var t,r;const n=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),o=n>1?"r":n<-1?"l":"";if(o){const t="r"===o?"l":"r",r={...e},n=e[o];e.from=n.from,e.to=n.to,e[o]=n[o],r[o]=n[t],e[t]=r,r.d=go(r)}e.d=go(e)}function go({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}$e(ho.prototype,{add(e){return fo(this,e),this},addKey(e){return po(this,e,e),this},addKeys(e){return e.forEach((e=>po(this,e,e))),this},[ut](){return yo(this)}});const bo={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new ho(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const o=e.table(n),{schema:i}=o,{primaryKey:a}=i,{extractKey:s,outbound:c}=a,l={...o,mutate:e=>{const a=e.trans,s=a.mutatedParts||(a.mutatedParts={}),c=e=>{const r=`idb://${t}/${n}/${e}`;return s[r]||(s[r]=new ho)},l=c(""),u=c(":dels"),{type:d}=e;let[h,p]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const f=e.trans._cache;return o.mutate(e).then((e=>{if(Me(h)){"delete"!==d&&(h=e.results),l.addKeys(h);const t=co(h,f);t||"add"===d||u.addKeys(h),(t||p)&&function(e,t,r,n){t.indexes.forEach((function(t){const o=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&Me(e)?e.forEach((e=>o.addKey(e))):o.addKey(e);(r||n).forEach(((e,t)=>{const o=r&&i(r[t]),s=n&&i(n[t]);0!==pn(o,s)&&(null!=o&&a(o),null!=s&&a(s))}))}))}(c,i,t,p)}else if(h){const e={from:h.lower,to:h.upper};u.add(e),l.add(e)}else l.add(r),u.add(r),i.indexes.forEach((e=>c(e.name).add(r)));return e}))}},u=({query:{index:t,range:r}})=>{var n,o;return[t,new ho(null!==(n=r.lower)&&void 0!==n?n:e.MIN_KEY,null!==(o=r.upper)&&void 0!==o?o:e.MAX_KEY)]},d={get:e=>[a,new ho(e.key)],getMany:e=>[a,(new ho).addKeys(e.keys)],count:u,query:u,openCursor:u};return Te(d).forEach((e=>{l[e]=function(i){const{subscr:a}=ir;if(a){const l=e=>{const r=`idb://${t}/${n}/${e}`;return a[r]||(a[r]=new ho)},u=l(""),h=l(":dels"),[p,f]=d[e](i);if(l(p.name||"").add(f),!p.isPrimaryKey){if("count"!==e){const t="query"===e&&c&&i.values&&o.query({...i,values:!1});return o[e].apply(this,arguments).then((r=>{if("query"===e){if(c&&i.values)return t.then((({result:e})=>(u.addKeys(e),r)));const e=i.values?r.result.map(s):r.result;i.values?u.addKeys(e):h.addKeys(e)}else if("openCursor"===e){const e=r,t=i.values;return e&&Object.create(e,{key:{get:()=>(h.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return h.addKey(t),t}},value:{get:()=>(t&&u.addKey(e.primaryKey),e.value)}})}return r}))}h.add(r)}}return o[e].apply(this,arguments)}})),l}}}};class vo{constructor(e,t){this._middlewares={},this.verno=0;const r=vo.dependencies;this._options=t={addons:vo.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:n}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ct,dbReadyPromise:null,cancelOpen:Ct,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new lr((e=>{o.dbReadyResolve=e})),o.openCanceller=new lr(((e,t)=>{o.cancelOpen=t})),this._state=o,this.name=e,this.on=nn(this,"populate","blocked","versionchange","close",{ready:[Kt,Ct]}),this.on.ready.subscribe=He(this.on.ready.subscribe,(e=>(t,r)=>{vo.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||lr.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);const n=this;r||e((function e(){n.on.ready.unsubscribe(t),n.on.ready.unsubscribe(e)}))}}))})),this.Collection=(i=this,on(mn.prototype,(function(e,t){this.db=i;let r=en,n=null;if(t)try{r=t()}catch(e){n=e}const o=e._ctx,a=o.table,s=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:o.or,valueMapper:s!==Tt?s:null}}))),this.Table=function(e){return on(rn.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:nn(null,{creating:[Bt,Ct],reading:[Mt,Tt],updating:[Ut,Ct],deleting:[Nt,Ct]})}))}(this),this.Transaction=function(e){return on(Rn.prototype,(function(t,r,n,o,i){this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=nn(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new lr(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),Lr(e)}))}))}(this),this.Version=function(e){return on(Jn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return on(Pn.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};const o=e._deps.indexedDB;if(!o)throw new Rt.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(e,t)=>o.cmp(t,e),this._max=(e,t)=>o.cmp(e,t)>0?e:t,this._min=(e,t)=>o.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=Tn(t.IDBKeyRange),this._createTransaction=(e,t,r,n)=>new this.Transaction(e,t,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=e=>{this.on("blocked").fire(e),Hr.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(io),this.use(so),this.use(bo),this.use(lo),this.vip=Object.create(this,{_vip:{value:!0}}),n.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new Rt.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Rt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter((t=>t._cfg.version===e))[0];return r||(r=new this.Version(e),t.push(r),t.sort(qn),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||ir.letThrough||this._vip)?e():new lr(((e,t)=>{if(this._state.openComplete)return t(new Rt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new Rt.DatabaseClosed);this.open().catch(Ct)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:r,name:n}){n&&this.unuse({stack:e,name:n});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:t,level:null==r?10:r,name:n}),o.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>r?e.create!==r:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?Lr(t.dbOpenError):e));yt&&(t.openCanceller._stackHolder=vt()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function o(){if(t.openCanceller!==n)throw new Rt.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,a=null,s=!1;return lr.race([n,("undefined"==typeof navigator?lr.resolve():eo()).then((()=>new lr(((n,i)=>{if(o(),!r)throw new Rt.MissingAPI;const c=e.name,l=t.autoSchema?r.open(c):r.open(c,Math.round(10*e.verno));if(!l)throw new Rt.MissingAPI;l.onerror=Fn(i),l.onblocked=Sr(e._fireOnBlocked),l.onupgradeneeded=Sr((n=>{if(a=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=En,a.abort(),l.result.close();const e=r.deleteDatabase(c);e.onsuccess=e.onerror=Sr((()=>{i(new Rt.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{a.onerror=Fn(i);var o=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;s=o<1,e._novip.idbdb=l.result,Ln(e,o/10,a,i)}}),i),l.onsuccess=Sr((()=>{a=null;const r=e._novip.idbdb=l.result,o=Ze(r.objectStoreNames);if(o.length>0)try{const n=r.transaction(1===(i=o).length?i[0]:i,"readonly");t.autoSchema?function({_novip:e},t,r){e.verno=t.version/10;const n=e._dbSchema=Hn(0,t,r);e._storeNames=Ze(t.objectStoreNames,0),Kn(e,[e._allTables],Te(n),n)}(e,r,n):(Gn(e,e._dbSchema,n),function(e,t){const r=Vn(Hn(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some((e=>e.add.length||e.change.length)))}(e,n)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),$n(e,n)}catch(e){}var i;Hr.push(e),r.onversionchange=Sr((r=>{t.vcFired=!0,e.on("versionchange").fire(r)})),r.onclose=Sr((t=>{e.on("close").fire(t)})),s&&function({indexedDB:e,IDBKeyRange:t},r){!Yn(e)&&"__dbnames"!==r&&Qn(e,t).put({name:r}).catch(Ct)}(e._deps,c),n()}),i)}))))]).then((()=>(o(),t.onReadyBeingFired=[],lr.resolve(Xn((()=>e.on.ready.fire(e.vip)))).then((function r(){if(t.onReadyBeingFired.length>0){let n=t.onReadyBeingFired.reduce(Kt,Ct);return t.onReadyBeingFired=[],lr.resolve(Xn((()=>n(e.vip)))).then(r)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((r=>{t.dbOpenError=r;try{a&&a.abort()}catch(e){}return n===t.openCanceller&&e._close(),Lr(r)})).finally((()=>{t.openComplete=!0,i()}))}(this)}_close(){const e=this._state,t=Hr.indexOf(this);if(t>=0&&Hr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new lr((t=>{e.dbReadyResolve=t})),e.openCanceller=new lr(((t,r)=>{e.cancelOpen=r}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Rt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new lr(((r,n)=>{const o=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Sr((()=>{!function({indexedDB:e,IDBKeyRange:t},r){!Yn(e)&&"__dbnames"!==r&&Qn(e,t).delete(r).catch(Ct)}(this._deps,this.name),r()})),e.onerror=Fn(n),e.onblocked=this._fireOnBlocked};if(e)throw new Rt.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(o):o()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Te(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=ro.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let n=ir.trans;n&&n.db===this&&-1===e.indexOf("!")||(n=null);const o=-1!==e.indexOf("?");let i,a;e=e.replace("!","").replace("?","");try{if(a=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)i="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new Rt.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(n){if("readonly"===n.mode&&"readwrite"===i){if(!o)throw new Rt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&a.forEach((e=>{if(n&&-1===n.storeNames.indexOf(e)){if(!o)throw new Rt.SubTransaction("Table "+e+" not included in parent transaction.");n=null}})),o&&n&&!n.active&&(n=null)}}catch(e){return n?n._promise(null,((t,r)=>{r(e)})):Lr(e)}const s=no.bind(null,this,i,a,n,r);return n?n._promise(i,s,"lock"):ir.trans?Ur(ir.transless,(()=>this._whenReady(s))):this._whenReady(s)}table(e){if(!Ue(this._allTables,e))throw new Rt.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const wo="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class _o{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})}[wo](){return this}}function Ao(e,t){return Te(t).forEach((r=>{fo(e[r]||(e[r]=new ho),t[r])})),e}function xo(e){return new _o((t=>{const r=ft(e);let n=!1,o={},i={};const a={get closed(){return n},unsubscribe:()=>{n=!0,On.storagemutated.unsubscribe(u)}};t.start&&t.start(a);let s=!1,c=!1;function l(){return Te(i).some((e=>o[e]&&function(e,t){const r=yo(t);let n=r.next();if(n.done)return!1;let o=n.value;const i=yo(e);let a=i.next(o.from),s=a.value;for(;!n.done&&!a.done;){if(pn(s.from,o.to)<=0&&pn(s.to,o.from)>=0)return!0;pn(o.from,s.from)<0?o=(n=r.next(s.from)).value:s=(a=i.next(o.from)).value}return!1}(o[e],i[e])))}const u=e=>{Ao(o,e),l()&&d()},d=()=>{if(s||n)return;o={};const h={},p=function(t){r&&jr();const n=()=>Ir(e,{subscr:t,trans:null}),o=ir.trans?Ur(ir.transless,n):n();return r&&o.then(Cr,Cr),o}(h);c||(On("storagemutated",u),c=!0),s=!0,Promise.resolve(p).then((e=>{s=!1,n||(l()?d():(o={},i=h,t.next&&t.next(e)))}),(e=>{s=!1,t.error&&t.error(e),a.unsubscribe()}))};return d(),a}))}let So;try{So={indexedDB:Ce.indexedDB||Ce.mozIndexedDB||Ce.webkitIndexedDB||Ce.msIndexedDB,IDBKeyRange:Ce.IDBKeyRange||Ce.webkitIDBKeyRange}}catch(Ce){So={indexedDB:null,IDBKeyRange:null}}const ko=vo;function Po(e){let t=Fo;try{Fo=!0,On.storagemutated.fire(e)}finally{Fo=t}}$e(ko,{...jt,delete:e=>new ko(e,{addons:[]}).delete(),exists:e=>new ko(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Yn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):Qn(e,t).toCollection().primaryKeys()}(ko.dependencies).then(e)}catch(e){return Lr(new Rt.MissingAPI)}},defineClass:()=>function(e){De(this,e)},ignoreTransaction:e=>ir.trans?Ur(ir.transless,e):e(),vip:Xn,async:function(e){return function(){try{var t=to(e.apply(this,arguments));return t&&"function"==typeof t.then?t:lr.resolve(t)}catch(e){return Lr(e)}}},spawn:function(e,t,r){try{var n=to(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:lr.resolve(n)}catch(e){return Lr(e)}},currentTransaction:{get:()=>ir.trans||null},waitFor:function(e,t){const r=lr.resolve("function"==typeof e?ko.ignoreTransaction(e):e).timeout(t||6e4);return ir.trans?ir.trans.waitFor(r):r},Promise:lr,debug:{get:()=>yt,set:e=>{mt(e,"dexie"===e?()=>!0:Yr)}},derive:qe,extend:De,props:$e,override:He,Events:nn,on:On,liveQuery:xo,extendObservabilitySet:Ao,getByKeyPath:Ye,setByKeyPath:Xe,delByKeyPath:function(e,t){"string"==typeof t?Xe(e,t,void 0):"length"in t&&[].map.call(t,(function(t){Xe(e,t,void 0)}))},shallowClone:et,deepClone:at,getObjectDiff:ao,cmp:pn,asap:Je,minKey:-1/0,addons:[],connections:Hr,errnames:Et,dependencies:So,semVer:"3.2.3",version:"3.2.3".split(".").map((e=>parseInt(e))).reduce(((e,t,r)=>e+t/Math.pow(10,2*r)))}),ko.maxKey=Tn(ko.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(On("storagemutated",(e=>{if(!Fo){let t;Gr?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Fo=!0,dispatchEvent(t),Fo=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Fo||Po(e)})));let Fo=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),On("storagemutated",(t=>{Fo||e.postMessage(t)})),e.onmessage=e=>{e.data&&Po(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){On("storagemutated",(e=>{try{Fo||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Po(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Po(e.changedParts)}))}lr.rejectionMapper=function(e,t){if(!e||e instanceof St||e instanceof TypeError||e instanceof SyntaxError||!e.name||!It[e.name])return e;var r=new It[e.name](t||e.message,e);return"stack"in e&&ze(r,"stack",{get:function(){return this.inner.stack}}),r},mt(yt,Yr);class Eo extends vo{constructor(){super("CopyHistoryDatabase"),this.version(1).stores({copyHistoryItems:"++index,id,timestamp"}),this.version(2).stores({copyHistoryItems:"++index,id,timestamp"}).upgrade((e=>e.table("copyHistoryItems").toCollection().modify((e=>{const t={text:e.text,textImage:e.textImage,start:e.start,end:e.end,originalStart:e.originalStart,originalEnd:e.originalEnd,track:e.track};if(e.subtitle=t,delete e.text,delete e.textImage,delete e.start,delete e.end,delete e.originalStart,delete e.originalEnd,delete e.track,e.videoFileName||e.audioFileName){const t={name:e.videoFileName||e.audioFileName,blobUrl:"",playbackRate:e.filePlaybackRate,audioTrack:e.audioTrack};e.file=t,delete e.videoFileName,delete e.audioFileName,delete e.filePlaybackRate,delete e.audioTrack}}))))}}class Oo{constructor(e){this._db=new Eo,this._limit=e}set limit(e){this._limit=e}async clear(){await this._db.copyHistoryItems.clear()}async fetch(e){if(e<=0)return[];const t=await await this._db.copyHistoryItems.reverse().limit(e).toArray();return t.reverse(),t}liveFetch(e,t){const r=xo((()=>this.fetch(e))).subscribe(t);return()=>r.unsubscribe()}async save(e){if(this._limit<=0)return;const t={id:e.id,timestamp:e.timestamp,subtitle:e.subtitle,surroundingSubtitles:e.surroundingSubtitles,subtitleFileName:e.subtitleFileName,url:e.url,image:e.image,audio:e.audio,file:e.file,mediaTimestamp:e.mediaTimestamp},r=await this._db.copyHistoryItems.where("id").equals(e.id).primaryKeys();r.length>0&&(t.index=r[0]);const n=await this._db.copyHistoryItems.put(t);await this._prune(n)}async _prune(e){if(await this._db.copyHistoryItems.count()>this._limit){const t=await this._db.copyHistoryItems.where("index").belowOrEqual(e-this._limit).primaryKeys();t.length>0&&await this._db.copyHistoryItems.bulkDelete(t)}}async delete(e){const t=await this._db.copyHistoryItems.where("id").equals(e).primaryKeys();await this._db.copyHistoryItems.bulkDelete(t)}}const Ro=navigator.userAgent.toLowerCase().includes("android")??navigator.userAgentData?.mobile??!1,Io="lastUpdateAlertVersion";chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});const jo=new V(new Y);chrome.runtime.onInstalled.addListener((async e=>{if(e.reason!==chrome.runtime.OnInstalledReason.INSTALL)return;const t=chrome.i18n.getUILanguage();(await(async()=>{const e=await te();return void 0===e?G:e.languages.map((e=>e.code))})()).includes(t)&&(await jo.set({language:t}),se(t)),Ro&&await jo.set({streamingTakeScreenshot:!1,subtitleSize:18,subtitlePositionOffset:25,topSubtitlePositionOffset:25,subtitlesWidth:100}),chrome.tabs.create({url:chrome.runtime.getURL("ftue-ui.html"),active:!0})})),chrome.runtime.onInstalled.addListener((async e=>{e.reason===chrome.runtime.OnInstalledReason.UPDATE&&(async()=>{(await chrome.storage.local.get(Io))[Io]!==chrome.runtime.getManifest().version&&await chrome.storage.local.set({shouldShowUpdateAlert:!0})})()})),chrome.runtime.onStartup.addListener((async()=>{se(await jo.getSingle("language"))}));const Co=new class{constructor(e){this._onNoSyncedElementsCallbacks=[],this._onSyncedElementCallbacks=[],this._onAsbplayerInstanceCallbacks=[],this._settings=e,chrome.tabs.onRemoved.addListener(((e,t)=>{this._videoElements()})),chrome.tabs.onUpdated.addListener(((e,t)=>{"loading"===t.status&&void 0===t.url?(this._videoElements((t=>{let r=!1;for(const[n,o]of Object.entries(t))o.tab.id===e&&(delete t[n],r=!0);return r})),this._asbplayers((t=>{let r=!1;for(const[n,o]of Object.entries(t))o.tab?.id===e&&(delete t[n],r=!0);return r}))):this._videoElements()}))}async _fetchVideoElementState(){return(await chrome.storage.session.get("tabRegistryVideoElements")).tabRegistryVideoElements??{}}async _saveVideoElementState(e){await chrome.storage.session.set({tabRegistryVideoElements:e})}async _videoElements(e){const t=await chrome.tabs.query({}),r=await this._fetchVideoElementState(),n={...r};let o=!1;for(const e in r){const n=r[e],i=void 0===t.find((e=>e.id===n.tab.id&&e.url===n.tab.url));i&&(o=!0,delete r[e])}void 0!==e&&(o=e(r)||o),o&&await this._saveVideoElementState(r);const i=void 0!==Object.values(n).find((e=>e.synced)),a=void 0!==Object.values(r).find((e=>e.synced));if(this._onNoSyncedElementsCallbacks.length>0&&i&&!a)for(const e of this._onNoSyncedElementsCallbacks)e();else if(this._onSyncedElementCallbacks.length>0&&!i&&a)for(const e of this._onSyncedElementCallbacks)e();return r}async _fetchAsbplayerState(){return(await chrome.storage.session.get("tabRegistryAsbplayers")).tabRegistryAsbplayers??{}}async _saveAsbplayerState(e){await chrome.storage.session.set({tabRegistryAsbplayers:e})}async _asbplayers(e){const t=await chrome.tabs.query({}),r=await this._fetchAsbplayerState(),n={...r},o=Date.now();let i=!1;for(const e in r){const n=r[e],a=n.sidePanel&&o-n.timestamp>=5e3||void 0!==n.tab&&void 0===t.find((e=>e.id===n.tab?.id&&e.url===n.tab?.url));a&&(i=!0,delete r[e])}void 0!==e&&(i=e(r)||i);let a=!1;if(i&&(await this._saveAsbplayerState(r),a=Object.keys(r).some((e=>!(e in n)))),a)for(const e of this._onAsbplayerInstanceCallbacks)e();return r}async onAsbplayerHeartbeat(e,{id:t,videoPlayer:r,sidePanel:n,receivedTabs:o,loadedSubtitles:i,syncedVideoElement:a}){this._updateAsbplayers(e,t,r,n??!1,i??!1,o,a);try{const t={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!1}};e?.id?await chrome.tabs.sendMessage(e.id,t):await chrome.runtime.sendMessage(t)}catch(e){}}async onAsbplayerAckTabs(e,{id:t,videoPlayer:r,sidePanel:n,loadedSubtitles:o,receivedTabs:i,syncedVideoElement:a}){this._updateAsbplayers(e,t,r,n??!1,o??!1,i,a)}async _updateAsbplayers(e,t,r,n,o,i,a){const s=void 0===e||void 0===e.id?void 0:{id:e.id,title:e.title??"",url:e.url??"",faviconUrl:e.favIconUrl};await this._asbplayers((e=>(e[t]={tab:s,id:t,timestamp:Date.now(),receivedTabs:i,sidePanel:n,loadedSubtitles:o,videoPlayer:r,syncedVideoElement:a},!0)))}async activeVideoElements(){const e=await this._videoElements(),t=[];for(const r in e){const n=e[r];if(n.tab.id){const e={id:n.tab.id,title:n.tab.title,faviconUrl:n.tab.faviconUrl,src:n.src,subscribed:n.subscribed,synced:n.synced,syncedTimestamp:n.syncedTimestamp};t.push(e)}}return t}async _asbplayerInstances(){const e=await this._asbplayers(),t=[];for(const r of Object.values(e))t.push({id:r.id,tabId:r.tab?.id,sidePanel:r.sidePanel??!1,timestamp:r.timestamp,videoPlayer:r.videoPlayer});return t}async onVideoElementHeartbeat(e,t,{subscribed:r,synced:n,syncedTimestamp:o,loadedSubtitles:i}){if(void 0===e.id)return;const a=e.id;await this._videoElements((s=>(s[`${e.id}:${t}`]={tab:{id:a,title:e.title??"",url:e.url??"",faviconUrl:e.favIconUrl},src:t,subscribed:r,timestamp:Date.now(),synced:n,syncedTimestamp:o,loadedSubtitles:i},!0)))}async onVideoElementDisappeared(e,t){await this._videoElements((r=>{const n=`${e.id}:${t}`;return n in r&&(delete r[n],!0)}))}onNoSyncedElements(e){this._onNoSyncedElementsCallbacks.push(e)}onSyncedElement(e){this._onSyncedElementCallbacks.push(e)}onAsbplayerInstance(e){this._onAsbplayerInstanceCallbacks.push(e)}async publishTabsToAsbplayers(){const e={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!0}};await this.publishCommandToAsbplayers({commandFactory:t=>t.videoPlayer?void 0:e})}async publishCommandToAsbplayers({asbplayerId:e,commandFactory:t}){const r=await this._asbplayers();if(void 0!==e){if(e in r){const n=t(r[e]);void 0!==n&&await this._sendCommand(r[e],n)}}else for(const e in r){const n=r[e],o=t(n);void 0!==o&&await this._sendCommand(n,o)}}async _sendCommand(e,t){try{void 0!==e.tab?.id?await chrome.tabs.sendMessage(e.tab.id,t):e.sidePanel&&await chrome.runtime.sendMessage(t)}catch(e){}}async publishCommandToVideoElements(e){const t=await this._videoElements();for(const r in t){const n=t[r],o=n.tab.id;if(void 0!==o){const t=e(n);void 0!==t&&chrome.tabs.sendMessage(o,t)}}}async publishCommandToVideoElementTabs(e){const t=await this._videoElements(),r=[];for(const e of Object.values(t))void 0===r.find((t=>t.id===e.tab.id))&&r.push(e.tab);if(r.length>0)for(const t of r){const r=e(t);void 0!==r&&chrome.tabs.sendMessage(t.id,r)}}async findAsbplayer({filter:e,allowTabCreation:t}){let r=null;const n=Date.now();let o=null;const i=await this._asbplayers();let a=0;for(const t in i){const s=i[t];if(s.sidePanel||++a,void 0===e||e(s)){const e=n-s.timestamp;(null===o||e<o)&&(o=e,r=s.id)}}return r||(t?new Promise((async(t,r)=>{0===a&&await this._createNewTab(),this._anyAsbplayerTab(t,r,0,10,e)})):void 0)}async _createNewTab(){return new Promise((async(e,t)=>{const r=await chrome.tabs.query({active:!0}),n=r&&0!==r.length?r[0].index+1:void 0;chrome.tabs.create({active:!1,url:await this._settings.getSingle("streamingAppUrl"),index:n},e)}))}async _anyAsbplayerTab(e,t,r,n,o){if(r>=n)return void t(new Error("Could not find or create an asbplayer tab"));const i=await this._asbplayers();for(const t in i)if(void 0===o||o(i[t]))return void e(t);setTimeout((()=>this._anyAsbplayerTab(e,t,r+1,n,o)),1e3)}}(jo),To=new class{constructor(e,t){this._tabRegistry=e,this._delegate=t}onAudioBase64(e,t){this.currentRecordRequestId===t&&(this.audioBase64Resolve?.(e),this.audioBase64Resolve=void 0,this.audioBase64Promise=void 0,this.audioBase64Reject=void 0,this.currentRecordRequestId=void 0)}async startWithTimeout(e,t,r){const n=C();try{const o=await this._delegate.startWithTimeout(e,t,n,r);if(o.started)return this._notifyRecordingStarted(r),await this._prepareForAudioDataResponse(n);throw this._handleStartError(o,r)}finally{this._notifyRecordingFinished(r)}}async start(e){try{const t=C(),r=await this._delegate.start(t,e);if(!r.started)throw this._handleStartError(r,e);this._prepareForAudioDataResponse(t),this._notifyRecordingStarted(e)}catch(t){throw this._notifyRecordingFinished(e),t}}_handleStartError(e,{tabId:t,src:r}){const n=e.error.code,o=`Failed to start audio recording: "${e.error.message}"`;switch(n){case x.noActiveTabPermission:return void 0!==t&&this._requestActiveTab(t,r),new Error(o);case x.other:return this._notifyError(o,{tabId:t,src:r}),new Error(o);case x.drmProtected:return new T}}_requestActiveTab(e,t){const r={sender:"asbplayer-extension-to-video",message:{command:"request-active-tab-permission"},src:t};chrome.tabs.sendMessage(e,r)}async stop(e,t){if(void 0===this.audioBase64Promise){const e="Cannot stop because audio recording is not in progress";throw this._notifyError(e,t),this._notifyRecordingFinished(t),new Error(e)}const r=await this._delegate.stop(e,t);if(!r.stopped){if(r.error.code===S.timedAudioRecordingInProgress)throw new M;const e=`Failed to stop audio recording: ${r.error.message}`;throw this._notifyError(e,t),new Error(e)}return this._notifyRecordingFinished(t),await this.audioBase64Promise}_notifyRecordingStarted({tabId:e,src:t}){const r={sender:"asbplayer-extension-to-player",message:{command:"recording-started"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>e.sidePanel?r:void 0});const n={sender:"asbplayer-extension-to-video",message:{command:"recording-started"},src:t};chrome.tabs.sendMessage(e,n)}_notifyRecordingFinished({tabId:e,src:t}){const r={sender:"asbplayer-extension-to-player",message:{command:"recording-finished"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>e.sidePanel?r:void 0});const n={sender:"asbplayer-extension-to-video",message:{command:"recording-finished"},src:t};chrome.tabs.sendMessage(e,n)}_prepareForAudioDataResponse(e){return void 0!==this.audioBase64Promise&&(this.audioBase64Reject(new Error("New audio recording request received before the current one could finish")),this.audioBase64Resolve=void 0,this.audioBase64Reject=void 0,this.audioBase64Promise=void 0,this.currentRecordRequestId=void 0),this.audioBase64Promise=new Promise(((t,r)=>{this.audioBase64Resolve=t,this.audioBase64Reject=r,this.currentRecordRequestId=e})),this.audioBase64Promise}_notifyError(e,{tabId:t,src:r}){const n={sender:"asbplayer-extension-to-video",message:{command:"notify-error",message:e},src:r};chrome.tabs.sendMessage(t,n)}}(Co,new class{async _ensureOffscreenDocument(){0===(await chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT]})).length&&await chrome.offscreen.createDocument({url:"offscreen-audio-recorder.html",reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"Audio recording"})}_mediaStreamId(e){return new Promise(((t,r)=>{chrome.tabCapture.getMediaStreamId({targetTabId:e},(e=>t(e)))}))}async startWithTimeout(e,t,r,{tabId:n,src:o}){await this._ensureOffscreenDocument();const i={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio-with-timeout",timeout:e,encodeAsMp3:t,streamId:await this._mediaStreamId(n),requestId:r}};return await chrome.runtime.sendMessage(i)}async start(e,{tabId:t,src:r}){await this._ensureOffscreenDocument();const n={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio",streamId:await this._mediaStreamId(t),requestId:e}};return await chrome.runtime.sendMessage(n)}async stop(e){const t={sender:"asbplayer-extension-to-offscreen-document",message:{command:"stop-recording-audio",encodeAsMp3:e}};return await chrome.runtime.sendMessage(t)}}),Mo=new class{constructor(e){this._capturing=!1,this.settings=e}get lastImageBase64(){return this._lastImageBase64}capture(e,t,r,n){return this._capturing?Promise.reject(new Error("Already capturing visible tab")):(this._lastImageBase64=void 0,void 0!==this.imageBase64Resolve&&void 0!==this.imageBase64Reject&&void 0!==this.imageBase64Promise?(this._captureWithDelay(e,t,r,n,this.imageBase64Resolve,this.imageBase64Reject),this.imageBase64Promise):(this.imageBase64Promise=new Promise(((o,i)=>{this.imageBase64Resolve=o,this.imageBase64Reject=i,this._captureWithDelay(e,t,r,n,this.imageBase64Resolve,this.imageBase64Reject)})),this.imageBase64Promise))}_captureWithDelay(t,r,n,o,i,a){const s=setTimeout((()=>{this._capturing=!0,e(t).then((async e=>{try{if(this._capturing=!1,s!==this.lastCaptureTimeoutId)return;const n=await this._cropAndResize(e,t,r,o);if(s!==this.lastCaptureTimeoutId)return;this._lastImageBase64=n.substring(n.indexOf(",")+1),i(this._lastImageBase64)}catch(e){a(e)}})).catch(a).finally((()=>{this._capturing=!1,this.imageBase64Promise=void 0,this.imageBase64Resolve=void 0,this.imageBase64Reject=void 0,this.lastCaptureTimeoutId=void 0}))}),n);this.lastCaptureTimeoutId=s}_cropAndResize(e,t,r,n){return new Promise((async(o,i)=>{try{if(!await this.settings.getSingle("streamingCropScreenshot"))return void o(e);const i={sender:"asbplayer-extension-to-video",message:{command:"crop-and-resize",dataUrl:e,...n},src:r};o((await chrome.tabs.sendMessage(t,i)).dataUrl)}catch(e){i(e)}}))}}(jo),Do=new class{constructor(e){this._settingsProvider=e}async publish(e,t,r,n){const o=C(),a=this._saveCardToRepository(o,e);if(void 0!==r&&void 0!==n)try{t==i.showAnkiDialog?this._showAnkiDialog(e,o,n,r):t==i.updateLastCard?await this._updateLastCard(e,n,r):t===i.exportCard?await this._exportCard(e,n,r):t===i.none&&this._notifySaved(a,e,n,r)}catch(e){throw this._notifyError(e,n,r),e}}_notifySaved(e,t,r,n){e.then((e=>{if(e){const e={sender:"asbplayer-extension-to-video",message:{...t,command:"card-saved",cardName:t.subtitle.text||p(t.mediaTimestamp)},src:r};chrome.tabs.sendMessage(n,e)}}))}async _exportCard(e,t,r){const n=await this._settingsProvider.get(U),o=await Ie(e,n,"default"),i={sender:"asbplayer-extension-to-video",message:{...e,command:"card-exported",cardName:`${o}`},src:t};chrome.tabs.sendMessage(r,i)}async _updateLastCard(e,t,r){const n=await this._settingsProvider.get(U),o=await Ie(e,n,"updateLast"),i={sender:"asbplayer-extension-to-video",message:{...e,command:"card-updated",cardName:`${o}`},src:t};chrome.tabs.sendMessage(r,i)}_showAnkiDialog(e,t,r,n){const o={sender:"asbplayer-extension-to-video",message:{...e,id:t,command:"show-anki-ui"},src:r};chrome.tabs.sendMessage(n,o)}async _saveCardToRepository(e,t){try{const r=await this._settingsProvider.getSingle("miningHistoryStorageLimit");return new Oo(r).save({...t,id:t.id??e,timestamp:Date.now()}),!0}catch(e){return console.error(e),!1}}_notifyError(e,t,r){let n;n=e instanceof Error?e.message:"string"==typeof e?e:String(e);const o={sender:"asbplayer-extension-to-video",message:{command:"notify-error",message:n},src:t};chrome.tabs.sendMessage(r,o)}}(jo),Bo=[new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"heartbeat"}handle(e,t){const r=e;return t.tab&&this.tabRegistry.onVideoElementHeartbeat(t.tab,r.src,r.message),!1}}(Co),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settingsProvider=n}get sender(){return"asbplayer-video"}get command(){return"record-media-and-forward-subtitle"}async handle(e,t){const r=t.tab,n=e;await this._recordAndForward(n,t,r)}async _recordAndForward(e,r,o){const a=e.message.subtitle;let s,c,l,u,d=!1;if(e.message.record){const t=(a.end-a.start)/e.message.playbackRate+e.message.audioPaddingEnd;e.message.postMineAction!==i.showAnkiDialog&&(d=await this._settingsProvider.getSingle("preferMp3")),s=this._audioRecorder.startWithTimeout(t,d,{src:e.src,tabId:r.tab?.id})}if(e.message.screenshot){const{maxWidth:t,maxHeight:r,rect:n,frameId:i}=e.message;c=this._imageCapturer.capture(o.id,e.src,Math.min(a.end-a.start,e.message.imageDelay),{maxWidth:t,maxHeight:r,rect:n,frameId:i}),c.finally((()=>{const t={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:e.src};chrome.tabs.sendMessage(o.id,t)}))}if(s){const{audioPaddingStart:t,audioPaddingEnd:r,playbackRate:o}=e.message,i={base64:"",extension:d?"mp3":"webm",paddingStart:t,paddingEnd:r,playbackRate:o};try{const e=await s;u={...i,base64:e}}catch(e){if(!(e instanceof T))throw e;u={...i,error:n.drmProtected}}}if(c)try{await c,l={base64:this._imageCapturer.lastImageBase64,extension:"jpeg"}}catch(e){console.error(e),l={base64:"",extension:"jpeg",error:t.captureFailed}}const h={image:l,audio:u,...e.message};this._cardPublisher.publish(h,e.message.postMineAction,o.id,e.src)}}(To,Mo,Do,jo),new class{constructor(e,t,r){this._settingsProvider=e,this._audioRecorder=t,this._cardPublisher=r}get sender(){return"asbplayer-video"}get command(){return"rerecord-media"}async handle(e,t){const r=e,o={base64:"",extension:"webm",paddingStart:r.message.audioPaddingStart,paddingEnd:r.message.audioPaddingEnd,start:r.message.timestamp,end:r.message.timestamp+r.message.duration/r.message.playbackRate,playbackRate:r.message.playbackRate};let i;try{i={...o,base64:await this._audioRecorder.startWithTimeout(r.message.duration/r.message.playbackRate+r.message.audioPaddingEnd,!1,{src:r.src,tabId:t.tab?.id})}}catch(e){if(!(e instanceof T))throw e;i={...o,error:n.drmProtected}}this._cardPublisher.publish({audio:i,image:r.message.uiState.image,url:r.message.uiState.url,subtitle:r.message.uiState.subtitle,surroundingSubtitles:r.message.uiState.surroundingSubtitles,subtitleFileName:r.message.subtitleFileName,mediaTimestamp:r.message.timestamp},void 0,t.tab.id,r.src);const a={sender:"asbplayer-extension-to-video",message:{command:"show-anki-ui-after-rerecord",uiState:{...r.message.uiState,audio:i,lastAppliedTimestampIntervalToAudio:r.message.uiState.timestampInterval}},src:r.src};chrome.tabs.sendMessage(t.tab.id,a)}}(jo,To,Do),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settings=n}get sender(){return"asbplayer-video"}get command(){return"start-recording-media"}async handle(e,r){const o=e;let a,s;if(o.message.record)try{await this._audioRecorder.start({src:o.src,tabId:r.tab?.id})}catch(e){if(!(e instanceof T))throw e;a=e}if(o.message.screenshot){const e=o.message.record?o.message.imageDelay:0,{maxWidth:n,maxHeight:i,rect:a,frameId:c}=o.message;try{s={base64:await this._imageCapturer.capture(r.tab.id,o.src,e,{maxWidth:n,maxHeight:i,rect:a,frameId:c}),extension:"jpeg"}}catch(e){console.error(e),s={base64:"",extension:"jpeg",error:t.captureFailed}}finally{const e={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:o.src};chrome.tabs.sendMessage(r.tab.id,e)}}if(!o.message.record||void 0!==a){const e=o.message.mediaTimestamp,t={text:"",start:e,originalStart:e,end:e,originalEnd:e,track:0};let c=!1;o.message.postMineAction!==i.showAnkiDialog&&(c=await this._settings.getSingle("preferMp3"));const l=void 0===a?void 0:{base64:"",extension:c?"mp3":"webm",paddingStart:0,paddingEnd:0,start:e,end:e,playbackRate:1,error:n.drmProtected};this._cardPublisher.publish({subtitle:t,surroundingSubtitles:[],image:s,audio:l,url:o.message.url,subtitleFileName:o.message.subtitleFileName,mediaTimestamp:o.message.mediaTimestamp},o.message.postMineAction,r.tab.id,o.src)}}}(To,Mo,Do,jo),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settingsProvider=n}get sender(){return"asbplayer-video"}get command(){return"stop-recording-media"}async handle(e,r){const n=e,o=n.message.subtitle??{text:"",start:n.message.startTimestamp,end:n.message.endTimestamp,originalStart:n.message.startTimestamp,originalEnd:n.message.startTimestamp,track:0},a=n.message.surroundingSubtitles??function(e,t,r){const n=[e],o=e.start-e.originalStart;if(e.end<t){const r=Math.min(t,e.end+5e3);n.push({text:"",start:e.end,end:r,originalStart:e.end-o,originalEnd:r-o,track:e.track})}if(e.start>0){const t=Math.max(0,e.start-5e3);n.unshift({text:"",start:t,end:e.start,originalStart:t-o,originalEnd:e.start-o,track:e.track})}return n}(o,n.message.videoDuration);let s;if(n.message.screenshot)try{let e=this._imageCapturer.lastImageBase64;if(void 0===e){const{maxWidth:t,maxHeight:o,rect:i,frameId:a}=n.message;e=await this._imageCapturer.capture(r.tab.id,n.src,0,{maxWidth:t,maxHeight:o,rect:i,frameId:a})}s={base64:e,extension:"jpeg"}}catch(e){console.error(e),s={base64:"",extension:"jpeg",error:t.captureFailed}}try{let e=!1;n.message.postMineAction!==i.showAnkiDialog&&(e=await this._settingsProvider.getSingle("preferMp3"));const t={base64:await this._audioRecorder.stop(e,{tabId:r.tab.id,src:n.src}),extension:e?"mp3":"webm",paddingStart:0,paddingEnd:0,start:n.message.startTimestamp,end:n.message.endTimestamp,playbackRate:n.message.playbackRate};this._cardPublisher.publish({subtitle:o,surroundingSubtitles:a,image:s,audio:t,url:n.message.url,subtitleFileName:n.message.subtitleFileName,mediaTimestamp:n.message.startTimestamp},n.message.postMineAction,r.tab.id,n.src)}catch(e){if(!(e instanceof M))throw e}}}(To,Mo,Do,jo),new class{constructor(e,t){this._imageCapturer=e,this._cardPublisher=t}get sender(){return"asbplayer-video"}get command(){return"take-screenshot"}async handle(e,r){const n=r.tab,o=e,{maxWidth:i,maxHeight:a,rect:s,frameId:c}=o.message;let l,u;try{l={base64:await this._imageCapturer.capture(r.tab.id,o.src,0,{maxWidth:i,maxHeight:a,rect:s,frameId:c}),extension:"jpeg"}}catch(e){console.error(e),l={base64:"",extension:"jpeg",error:t.captureFailed}}o.message.ankiUiState&&(u=o.message.ankiUiState,u.image=l,this._cardPublisher.publish({audio:u.audio,image:u.image,file:u.file,url:u.url,subtitle:u.subtitle,surroundingSubtitles:u.surroundingSubtitles,subtitleFileName:o.message.subtitleFileName,mediaTimestamp:o.message.mediaTimestamp},void 0,n.id,o.src));const d={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken",ankiUiState:u},src:o.src};chrome.tabs.sendMessage(n.id,d)}}(Mo,Do),new class{constructor(e,t){this.settings=e,this.tabRegistry=t}get sender(){return["asbplayer-video","asbplayer-mobile-overlay-to-video"]}get command(){return"toggle-subtitles"}async handle(e,t){const r=await this.settings.getSingle("streamingDisplaySubtitles");await this.settings.set({streamingDisplaySubtitles:!r}),this.tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src})))}}(jo,Co),new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"sync"}async handle(e,t){try{const r=e;await this.tabRegistry.publishTabsToAsbplayers();const n=await this.tabRegistry.findAsbplayer({filter:e=>void 0!==e.receivedTabs&&void 0!==t.tab&&!e.sidePanel&&(r.message.withSyncedAsbplayerOnly?void 0!==e.syncedVideoElement&&e.syncedVideoElement.id===t.tab?.id&&e.syncedVideoElement.src===r.src:r.message.withAsbplayerId?e.id===r.message.withAsbplayerId:void 0!==e.receivedTabs.find((e=>e.id===t.tab.id&&e.src===r.src))),allowTabCreation:!r.message.withSyncedAsbplayerOnly}),o={sender:"asbplayer-extension-to-player",message:{command:"syncv2",subtitles:r.message.subtitles,flatten:r.message.flatten},src:r.src,tabId:t.tab.id};void 0!==n&&this.tabRegistry.publishCommandToAsbplayers({asbplayerId:n,commandFactory:()=>o})}catch(e){console.error(e)}}}(Co),new class{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab","asbplayer-popup"]}get command(){return"http-post"}handle(e,t,r){const n=e.message;if(this._validateBody(n.body))return fetch(n.url,{method:"POST",body:JSON.stringify(n.body)}).then((e=>e.json())).then((e=>r(e))).catch((e=>r({error:e.message}))),!0;r({error:"Invalid request"})}_validateBody(e){const t=Object.keys(e);for(const e of t)if(!D.includes(e))return!1;const r=e.version;if(void 0!==r&&"number"!=typeof r)return!1;const n=e.action;return!(void 0!==n&&!B.includes(n))}},new class{constructor(e){this._tabRegistry=e}get sender(){return["asbplayer-video-tab","asbplayerv2"]}get command(){return"toggle-side-panel"}handle(e,t){let r=!1;return this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>{if(e.sidePanel)return r=!0,{sender:"asbplayer-extension-to-player",message:{command:"close-side-panel"}}}}),r||chrome.windows.getLastFocused((e=>chrome.sidePanel.open({windowId:e.id}))),!1}}(Co),new class{get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"open-asbplayer-settings"}async handle(e,t){chrome.runtime.openOptionsPage()}},new class{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"copy-to-clipboard"}handle(e,t,r){const n=t.tab?.id;if(void 0===n)return;const o={sender:"asbplayer-extension-to-video",message:e.message};return chrome.tabs.sendMessage(n,o),!1}},new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"video-disappeared"}handle(e,t,r){if(void 0===t.tab)return;const n=e;return this._tabRegistry.onVideoElementDisappeared(t.tab,n.src),!1}}(Co),new class{get sender(){return"asbplayer-video"}get command(){return"requesting-active-tab-permission"}handle(e,t){const r=e;return void 0!==t.tab?.id&&(async(e,t,r)=>{if(r){const r=await(async e=>(await chrome.tabs.query({})).find((t=>t.id===e)))(e);void 0===r?await chrome.storage.session.remove(pe):await chrome.storage.session.set({[pe]:{tabId:e,src:t,url:r.url}})}else await chrome.storage.session.remove(pe)})(t.tab.id,r.src,r.message.requesting),!1}},new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"copy-subtitle"}handle(e,t){const r=e;return this._tabRegistry.publishCommandToVideoElements((e=>{if(e.src===r.src&&e.tab.id===r.tabId)return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:r.message.postMineAction,subtitle:r.message.subtitle,surroundingSubtitles:r.message.surroundingSubtitles},src:e.src}})),!1}}(Co),new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"load-subtitles"}handle(e,t){const r=e,n={sender:"asbplayer-extension-to-video",src:"src"in e?e.src:void 0,message:{command:"toggle-video-select",fromAsbplayerId:r.message.fromAsbplayerId}};let o=!1;return this._tabRegistry.publishCommandToVideoElementTabs((e=>{if(e.id===r.tabId)return o=!0,n})).then((()=>{o&&chrome.tabs.update(r.tabId,{active:!0})})),!1}}(Co),new class{get sender(){return"asbplayerv2"}get command(){return"request-subtitles"}handle(e,t,r){const{tabId:n,src:o}=e,i={sender:"asbplayer-extension-to-video",src:o,message:{command:"request-subtitles"}};return chrome.tabs.sendMessage(n,i).then((e=>{r(e)})),!0}},new class{get sender(){return"asbplayerv2"}get command(){return"request-copy-history"}handle(e,t,r){const n=e.message;return new Oo(n.count).fetch(n.count).then((e=>{r({copyHistoryItems:e})})),!0}},new class{constructor(e){this._settings=e}get sender(){return"asbplayerv2"}get command(){return"save-copy-history"}handle(e,t,r){const n=e.message;return this._settings.getSingle("miningHistoryStorageLimit").then((e=>new Oo(e))).then((e=>Promise.all(n.copyHistoryItems.map((t=>e.save(t)))).then((()=>{r({})})))),!0}}(jo),new class{constructor(e){this._settings=e}get sender(){return"asbplayerv2"}get command(){return"delete-copy-history"}handle(e,t,r){const n=e.message;return this._settings.getSingle("miningHistoryStorageLimit").then((e=>new Oo(e))).then((e=>Promise.all(n.ids.map((t=>e.delete(t)))).then((()=>{r({})})))),!0}}(jo),new class{constructor(e){this._settings=e}get sender(){return"asbplayerv2"}get command(){return"clear-copy-history"}handle(e,t,r){return this._settings.getSingle("miningHistoryStorageLimit").then((e=>new Oo(e))).then((e=>{e.clear().then((()=>{r({})}))})),!0}}(jo),new class{constructor(e){this._cardPublisher=e}get sender(){return"asbplayerv2"}get command(){return"publish-card"}handle(e,t){const r=e.message;return this._cardPublisher.publish(r),!1}}(Do),new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"ack-message"}handle(e,t,r){const n={sender:"asbplayer-extension-to-player",message:e.message};return this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>n}),!1}}(Co),new class{constructor(e){this._audioRecorder=e}get sender(){return["asbplayer-offscreen-document","asbplayer-video"]}get command(){return"audio-base64"}handle(e,t){const r=e;return this._audioRecorder.onAudioBase64(r.message.base64,r.message.requestId),!1}}(To),new class{get sender(){return"asbplayer-video"}get command(){return"update-mobile-overlay-model"}async handle(e,t){void 0!==t.tab?.id&&chrome.tabs.sendMessage(t.tab.id,{...e,sender:"asbplayer-video-to-mobile-overlay"})}},new class{constructor(e,t){this._tabRegistry=e,this._settingsProvider=t}get sender(){return["asbplayer-popup","asbplayer-settings","asbplayer-mobile-overlay","asbplayer-video","asbplayer-video-tab"]}get command(){return"settings-updated"}handle(e,t){return this._settingsProvider.get(["language","webSocketClientEnabled"]).then((({language:e,webSocketClientEnabled:t})=>{se(e),t?de(this._settingsProvider,this._tabRegistry):he()})),this._tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src}))),this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>({sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}})}),chrome.tabs.query({url:`${chrome.runtime.getURL("settings-ui.html")}`}).then((e=>{for(const t of e)void 0!==t.id&&chrome.tabs.sendMessage(t.id,{message:{command:"settings-updated"}})})),!1}}(Co,jo),new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return null}handle(e,t){const r=e;if(void 0!==t.tab?.id){const n={sender:"asbplayer-extension-to-player",message:e.message,tabId:t.tab.id,src:r.src};this.tabRegistry.publishCommandToAsbplayers({commandFactory:()=>n})}return!1}}(Co),new class{get sender(){return"asbplayer"}get command(){return null}handle(e,t){const r=e,n={sender:"asbplayer-extension-to-video",message:r.message,src:r.src};return chrome.tabs.sendMessage(r.tabId,n),!1}},new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"heartbeat"}handle(e,t){const r=e.message;return this.tabRegistry.onAsbplayerHeartbeat(t.tab,r),!1}}(Co),new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"ackTabs"}handle(e,t){const r=e.message;return this.tabRegistry.onAsbplayerAckTabs(t.tab,r),!1}}(Co),new class{constructor(e,t){this._tabRegistry=e,this._settingsProvider=t}get sender(){return"asbplayerv2"}get command(){return"settings-updated"}handle(e,t){const r=e;return this._settingsProvider.get(["language","webSocketClientEnabled"]).then((({language:e,webSocketClientEnabled:t})=>{se(e),t?de(this._settingsProvider,this._tabRegistry):he()})),this._tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src}))),this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>{if(void 0===r.asbplayerId||r.asbplayerId!==e.id)return{sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}}}}),!1}}(Co,jo),new class{get sender(){return"asbplayerv2"}get command(){return"open-extension-shortcuts"}handle(e,t){return chrome.tabs.create({active:!0,url:"chrome://extensions/shortcuts"}),!1}},new class{get sender(){return"asbplayerv2"}get command(){return"extension-commands"}handle(e,t,r){return chrome.commands.getAll((e=>{const t={};for(const r of e)r.name&&r.shortcut&&(t[r.name]=r.shortcut);r(t)})),!0}},new class{constructor(){}get sender(){return"asbplayerv2"}get command(){return null}handle(e,t){const r=e;if(r.tabId){const e={sender:"asbplayer-extension-to-video",message:r.message,src:r.src};chrome.tabs.sendMessage(r.tabId,e)}return!1}},new class{get sender(){return"asbplayer-foreground"}get command(){return"capture-visible-tab"}handle(t,r,n){if(void 0!==r.tab&&void 0!==r.tab.id)return e(r.tab.id).then((e=>{n(e)})),!0}},new class{get sender(){return"asbplayer-mobile-overlay-to-video"}get command(){return"request-mobile-overlay-model"}handle(e,t,r){if(void 0!==t.tab?.id)return chrome.tabs.sendMessage(t.tab.id,e).then((e=>r(e))),!0}},new class{get sender(){return"asbplayer-mobile-overlay"}get command(){return"current-tab"}handle(e,t,r){return r(t.tab?.id),!1}},new class{get sender(){return"asbplayer-mobile-overlay-to-video"}get command(){return null}handle(e,t,r){if(void 0!==t.tab?.id)return chrome.tabs.sendMessage(t.tab.id,e),!1}}];chrome.runtime.onMessage.addListener(((e,t,r)=>{for(const n of Bo)if(("string"==typeof n.sender&&n.sender===e.sender||"object"==typeof n.sender&&n.sender.includes(e.sender))&&(null===n.command||n.command===e.message.command)){if(!0===n.handle(e,t,r))return!0;break}})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus?.create({id:"load-subtitles",title:chrome.i18n.getMessage("contextMenuLoadSubtitles"),contexts:["page","video"]}),chrome.contextMenus?.create({id:"mine-subtitle",title:chrome.i18n.getMessage("contextMenuMineSubtitle"),contexts:["page","video"]})})),chrome.contextMenus?.onClicked.addListener((e=>{if("load-subtitles"===e.menuItemId){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};Co.publishCommandToVideoElementTabs((r=>{if(e.pageUrl===r.url)return t}))}else"mine-subtitle"===e.menuItemId&&Co.publishCommandToVideoElements((t=>{if(!(void 0!==e.srcUrl&&t.src!==e.srcUrl||void 0===e.srcUrl&&e.pageUrl!==t.tab.url))return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:i.showAnkiDialog},src:t.src}}))})),chrome.commands?.onCommand.addListener((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{const r=e=>{if(e.sidePanel)return!1;const r=e.tab;return!r||void 0!==t.find((e=>e.id===r.id))};switch(e){case"copy-subtitle":case"update-last-card":case"copy-subtitle-with-dialog":const n=function(e){switch(e){case"copy-subtitle":return i.none;case"copy-subtitle-with-dialog":return i.showAnkiDialog;case"update-last-card":return i.updateLastCard;default:throw new Error("Cannot determine post mine action for unknown command "+e)}}(e);Co.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:n},src:e.src}})),Co.publishCommandToAsbplayers({commandFactory:e=>{if(r(e))return{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle",postMineAction:n},asbplayerId:e.id}}});break;case"toggle-video-select":for(const e of t)if(void 0!==e.id){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};chrome.tabs.sendMessage(e.id,t)}break;case"take-screenshot":Co.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"take-screenshot"},src:e.src}})),Co.publishCommandToAsbplayers({commandFactory:e=>{if(r(e))return{sender:"asbplayer-extension-to-player",message:{command:"take-screenshot"},asbplayerId:e.id}}});break;case"toggle-recording":Co.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"toggle-recording"},src:e.src}})),Co.publishCommandToAsbplayers({commandFactory:e=>{if(r(e))return{sender:"asbplayer-extension-to-player",message:{command:"toggle-recording"},asbplayerId:e.id}}});break;default:throw new Error("Unknown command "+e)}}))}));const No=()=>{jo.getSingle("webSocketClientEnabled").then((e=>{e?de(jo,Co):he()}))};No(),Co.onAsbplayerInstance(No),Co.onSyncedElement(No);Ro||chrome.action.setPopup({popup:"popup-ui.html"}),chrome.action.onClicked.addListener((e=>{if(Ro){if(void 0!==e.id){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};chrome.tabs.sendMessage(e.id,t)}}else chrome.action.openPopup()}))})()})();
//# sourceMappingURL=background.js.map