(()=>{"use strict";var e={9612:(e,t,r)=>{r.d(t,{zt:()=>a});const a=e=>({id:n(e),...e}),n=e=>`${e.language}:${e.label}:${e.url}`}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=r(9612);let t,a,n,o;const i=window.fetch;window.fetch=(...e)=>{for(const r of e){const e="string"==typeof r?r:r instanceof Request?r.url:null;if(!e)continue;if(!a){const r=e.match(/X-Plex-Token=([^&]+)/i);r&&(t=new URL(e).origin,a=r[1])}let i=e.match(/library%2Fmetadata%2F(\d+)/i);i&&(n=i[1]),i=e.match(/ratingKey=(\d+)/i),i&&(n=i[1]);const s=e.match(/\/transcode\/universal\/.+?\?/i);s&&(o=e.replace(s[0],"/transcode/universal/subtitles?"))}return i(...e)},document.addEventListener("asbplayer-get-synced-data",(async()=>{const r={error:"",basename:"",subtitles:[]},o="Automatic detection does not work for Plex if you resume playing your previous session from the mini player. Try stopping the video and hitting play on the media directly.",i=new DOMParser;if(!t||!a)return r.error=`Could not get the Plex server URL or token. ${o}`,document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:r}));if(!n)return r.error=`Could not get the ratingKey for the Plex media. ${o}`,document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:r}));const s=await fetch(`${t}/library/metadata/${n}?X-Plex-Token=${a}`),l=await s.text(),c=i.parseFromString(l,"application/xml").querySelector("Video");if(!c)return r.error=`No metadata found for Plex video. ${o}: ${l}`,document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:r}));r.basename=c.getAttribute("title")??"Unknown";const d=[];c.querySelectorAll("Part").forEach((n=>{n.querySelectorAll('Stream[streamType="3"]').forEach((n=>{const o=n.getAttribute("key");o?d.push((0,e.zt)({label:n.getAttribute("extendedDisplayTitle")??"",language:n.getAttribute("language")??"",url:`${t}${o}?X-Plex-Token=${a}`,extension:n.getAttribute("codec")??""})):r.error="Automatic detection is only available for external subtitles on Plex. If none are available, try Plex's subtitle search or use your own."}))})),r.subtitles=d,document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:r}))}),!1)})()})();
//# sourceMappingURL=plex-page.js.map