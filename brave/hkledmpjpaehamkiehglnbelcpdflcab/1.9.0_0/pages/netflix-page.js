(()=>{"use strict";var e,t={9612:(e,t,n)=>{function a(e,t=1e4){return new Promise((async(n,a)=>{e()&&n(!0);const r=Date.now();let i=!1;for(;!i&&Date.now()<r+t;)await new Promise((t=>{setTimeout((()=>{i=e(),t()}),1e3)}));n(i)}))}n.d(t,{$l:()=>a,zt:()=>r});const r=e=>({id:i(e),...e}),i=e=>`${e.language}:${e.label}:${e.url}`}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,a),i.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=a(9612),setTimeout((()=>{const t="webvtt-lssdh-ios8",n=new RegExp("manifest|licensedManifest"),a=new Map;function r(){if("undefined"!=typeof netflix)return netflix?.appContext?.state?.playerApp?.getAPI?.()}function i(){return r()?.videoPlayer}function s(){const e=i();if(e){const t=e.getAllPlayerSessionIds?.()||[];if(0===t.length)return void console.error("No Netflix player session IDs");const n=t[t.length-1];return e.getVideoPlayerBySessionId?.(n)}console.error("Missing netflix global")}function o(e){if(e.isForcedNarrative||e.isNoneTrack||!e.cdnlist?.length||!e.ttDownloadables)return;const n=e.ttDownloadables[t];return n?.downloadUrls?n.downloadUrls[e.cdnlist.find((e=>n.downloadUrls[e.id]))?.id]:void 0}function d(e){if(e.isForcedNarrative||e.isNoneTrack||!e.ttDownloadables)return;const n=e.ttDownloadables[t];return n?.urls&&0!==n.urls.length?n.urls[0].url:"lazy"}async function l(e,t){if(t<=0)return`${e}`;const[n,a]=function(e){const t=r()?.getVideoMetadataByVideoId?.(e)?.getCurrentVideo?.(),n=t?.getTitle?.();if("string"!=typeof n)return[`${e}`,!0];let a=n;if(!0===t?.isEpisodic?.()){const e=`${t?.getSeason()?._season?.seq}`.padStart(2,"0"),n=`${t?.getEpisodeNumber?.()}`.padStart(2,"0"),r=t?.getEpisodeTitle?.();a+=` S${e}E${n} ${r}`}return[a,!1]}(e);return a?(await new Promise((e=>setTimeout(e,1e3))),await l(e,--t)):n}document.addEventListener("asbplayer-netflix-seek",(e=>{s()?.seek(e.detail)})),document.addEventListener("asbplayer-netflix-play",(()=>{s()?.play()})),document.addEventListener("asbplayer-netflix-pause",(()=>{s()?.pause()}));const c=(t,n)=>{if(!t.bcp47)return;const a="CLOSEDCAPTIONS"===t.rawTrackType,r=a?`${t.bcp47.toLowerCase()}-CC`:t.bcp47.toLowerCase(),i=`${t.bcp47} - ${t.displayName}${a?" [CC]":""}`;return(0,e.zt)({label:i,language:r,url:n.get(t.trackId)??"lazy",extension:"nfvtt"})},u=async()=>{const e={error:"",basename:"",subtitles:[]},t=s(),n=t?.getMovieId();if(!t||!n)return e.error="Netflix Player or Title Id not found...",e;e.basename=await l(n,5);const r=a.get(n)||new Map;return e.subtitles=t.getTimedTextTrackList().filter((e=>r.has(e.trackId))).map((e=>c(e,r))).filter((e=>void 0!==e)),e};document.addEventListener("asbplayer-get-synced-data",(async()=>{const e=await u();document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}))}),!1);const p=async t=>{const n=e=>{document.dispatchEvent(new CustomEvent("asbplayer-synced-language-data",{detail:{error:e??"Failed to fetch subtitles for requested language",basename:"",subtitles:[]}}))},r=s();if(void 0===r)return void n();const i=r.getTimedTextTrack();let o=!1;try{const i=t.detail,s=a.get(r.getMovieId())||new Map,d=r.getTimedTextTrackList()?.find((e=>c(e,s)?.language===i));if(void 0===d)return void n();const l=s.get(d.trackId);if(void 0!==l&&"lazy"!==l)return void document.dispatchEvent(new CustomEvent("asbplayer-synced-language-data",{detail:await u()}));if(await r.setTimedTextTrack(d),o=!0,!await(0,e.$l)((()=>{const e=s.get(d.trackId);return void 0!==e&&"lazy"!==e})))return void n();document.dispatchEvent(new CustomEvent("asbplayer-synced-language-data",{detail:await u()}))}catch(t){n(t instanceof Error?t.message:String(t))}finally{o&&void 0!==i&&await r.setTimedTextTrack(i)}};let f;document.addEventListener("asbplayer-get-synced-language-data",(async e=>{void 0===f?f=p(e):f.then((()=>p(e))),await f,f=void 0}),!1);const y=JSON.stringify;JSON.stringify=function(e){if("string"==typeof e?.url&&-1<e.url.search(n))for(let n of Object.values(e))n?.profiles?.unshift(t);return y.apply(this,arguments)};const g=JSON.parse;JSON.parse=function(){const e=g.apply(this,arguments);return e?.result?.movieId&&function(e){const t=e.timedtexttracks||[];for(const n of t){const t=o(n)??d(n);void 0!==t&&(a.has(e.movieId)||a.set(e.movieId,new Map),a.get(e.movieId).set(n.new_track_id,t))}}(e.result),e},Function.prototype.apply=new Proxy(Function.prototype.apply,{apply:function(e,t,n){if(n&&n[1]&&"string"==typeof n[1][0]){const e=n[1][0];if("preciseSeeking"===e||"preciseseeking"===e||"preciseseekingontwocoredevice"===e)return!0}return e.call(t,...n)}}),document.addEventListener("asbplayer-query-netflix",(async()=>{const t=await(0,e.$l)((()=>void 0!==i()),3e4);document.dispatchEvent(new CustomEvent("asbplayer-netflix-enabled",{detail:t}))}))}),0)})();
//# sourceMappingURL=netflix-page.js.map